import{c as w,d as E,s as i,i as n,t,a as p,b as d}from"./config.C_G0umPK.js";var a=[];for(var m=0;m<256;++m)a.push((m+256).toString(16).slice(1));function b(e,r=0){return(a[e[r+0]]+a[e[r+1]]+a[e[r+2]]+a[e[r+3]]+"-"+a[e[r+4]]+a[e[r+5]]+"-"+a[e[r+6]]+a[e[r+7]]+"-"+a[e[r+8]]+a[e[r+9]]+"-"+a[e[r+10]]+a[e[r+11]]+a[e[r+12]]+a[e[r+13]]+a[e[r+14]]+a[e[r+15]]).toLowerCase()}var u,f=new Uint8Array(16);function U(){if(!u&&(u=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!u))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return u(f)}var k=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto);const g={randomUUID:k};function $(e,r,l){if(g.randomUUID&&!r&&!e)return g.randomUUID();e=e||{};var o=e.random||(e.rng||U)();return o[6]=o[6]&15|64,o[8]=o[8]&63|128,b(o)}const _=w({url:p.tursoConnectionUrl,authToken:p.tursoAuthToken}),s=E(_),N=i("employees",{id:n("id").primaryKey(),firstName:t("first_name").notNull(),lastName:t("last_name").notNull(),email:t("email").notNull(),dni:t("dni").notNull(),entryTime:t("entry_time").notNull(),exitTime:t("exit_time").notNull(),hoursWorked:n("hours_worked").notNull(),xLite:t("x_lite").notNull()}),y=i("break_schedules",{id:n("id").primaryKey(),employeeId:n("employee_id").notNull(),day:t("day").notNull(),startTime:t("start_time").notNull(),endTime:t("end_time").notNull(),week:n("week").notNull(),month:n("month").notNull(),year:n("year").notNull()}),h=i("users",{id:n("id").primaryKey(),name:t("name").notNull(),responses:n("responses").notNull().default(0),nps:n("nps").notNull().default(0),csat:n("csat").notNull().default(0),rd:n("rd").notNull().default(0)});i("novedades",{id:n("id").primaryKey(),url:t("url").notNull(),title:t("title").notNull(),publishDate:t("publish_date").notNull()});const x=i("auth_users",{id:t("id").primaryKey(),email:t("email").notNull().unique(),password:t("password").notNull(),name:t("name").notNull()});async function D(){try{return await s.select().from(N).all()}catch(e){throw console.error("Error al obtener empleados:",e),new Error(`No se pudieron obtener los empleados: ${e instanceof Error?e.message:String(e)}`)}}async function I(e,r){try{await s.update(N).set({xLite:r}).where(d`id = ${e}`).run()}catch(l){throw console.error("Error al actualizar X LITE del empleado:",l),new Error(`No se pudo actualizar X LITE del empleado: ${l instanceof Error?l.message:String(l)}`)}}async function v(e,r,l){try{return await s.select().from(y).where(d`employee_id = ${e} AND month = ${r} AND year = ${l}`).all()}catch(o){throw console.error("Error al obtener horarios de break:",o),new Error(`No se pudieron obtener los horarios de break: ${o instanceof Error?o.message:String(o)}`)}}async function S(e){try{console.log("Intentando actualizar horario de break:",e),(await s.update(y).set({startTime:e.startTime,endTime:e.endTime}).where(d`
        employee_id = ${e.employeeId} AND
        day = ${e.day} AND
        week = ${e.week} AND
        month = ${e.month} AND
        year = ${e.year}
      `).run()).rowsAffected===0&&await s.insert(y).values(e).run(),console.log("Horario de break actualizado o insertado con éxito")}catch(r){throw console.error("Error detallado al actualizar horario de break:",r),new Error(`No se pudo actualizar el horario de break: ${r instanceof Error?r.message:String(r)}`)}}async function z(){try{return await s.select().from(h).all()}catch(e){throw console.error("Error al obtener usuarios:",e),new Error(`No se pudieron obtener los usuarios: ${e instanceof Error?e.message:String(e)}`)}}async function A(e){try{await s.update(h).set(e).where(d`id = ${e.id}`).run()}catch(r){throw console.error("Error al actualizar usuario:",r),new Error(`No se pudo actualizar el usuario: ${r instanceof Error?r.message:String(r)}`)}}async function K(e,r,l){try{console.log(`Intentando registrar usuario: ${e}`);const o=$();console.log(`ID generado: ${o}`);const c=await s.insert(x).values({id:o,email:e,password:r,name:l}).returning().all();return console.log("Resultado de la inserción:",c),c.length>0?(console.log("Usuario registrado exitosamente"),c[0]):(console.log("No se pudo registrar el usuario"),null)}catch(o){if(o instanceof Error){if(console.error("Error detallado al registrar usuario:",o.message),o.message.includes("UNIQUE constraint failed: auth_users.email"))throw console.log("Error: El correo electrónico ya está en uso"),new Error("El correo electrónico ya está en uso")}else console.error("Error desconocido al registrar usuario:",o);throw o}}export{v as a,S as b,z as c,A as d,D as g,K as r,I as u};
