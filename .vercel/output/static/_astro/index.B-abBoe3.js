import{a as Te,c as Me}from"./index.RYns6xqu.js";function Tt(s,e){for(var t=0;t<e.length;t++){const r=e[t];if(typeof r!="string"&&!Array.isArray(r)){for(const n in r)if(n!=="default"&&!(n in s)){const i=Object.getOwnPropertyDescriptor(r,n);i&&Object.defineProperty(s,n,i.get?i:{enumerable:!0,get:()=>r[n]})}}}return Object.freeze(Object.defineProperty(s,Symbol.toStringTag,{value:"Module"}))}var se={exports:{}};const Mt={},At=Object.freeze(Object.defineProperty({__proto__:null,default:Mt},Symbol.toStringTag,{value:"Module"})),R=Te(At);var ct={exports:{}},F={},ne={},De;function lt(){if(De)return ne;De=1,ne.parse=function(t,r){return new s(t,r).parse()};class s{constructor(r,n){this.source=r,this.transform=n||e,this.position=0,this.entries=[],this.recorded=[],this.dimension=0}isEof(){return this.position>=this.source.length}nextCharacter(){var r=this.source[this.position++];return r==="\\"?{value:this.source[this.position++],escaped:!0}:{value:r,escaped:!1}}record(r){this.recorded.push(r)}newEntry(r){var n;(this.recorded.length>0||r)&&(n=this.recorded.join(""),n==="NULL"&&!r&&(n=null),n!==null&&(n=this.transform(n)),this.entries.push(n),this.recorded=[])}consumeDimensions(){if(this.source[0]==="[")for(;!this.isEof();){var r=this.nextCharacter();if(r.value==="=")break}}parse(r){var n,i,o;for(this.consumeDimensions();!this.isEof();)if(n=this.nextCharacter(),n.value==="{"&&!o)this.dimension++,this.dimension>1&&(i=new s(this.source.substr(this.position-1),this.transform),this.entries.push(i.parse(!0)),this.position+=i.position-2);else if(n.value==="}"&&!o){if(this.dimension--,!this.dimension&&(this.newEntry(),r))return this.entries}else n.value==='"'&&!n.escaped?(o&&this.newEntry(!0),o=!o):n.value===","&&!o?this.newEntry():this.record(n.value);if(this.dimension!==0)throw new Error("array dimension not balanced");return this.entries}}function e(t){return t}return ne}var ie,Be;function ft(){if(Be)return ie;Be=1;var s=lt();return ie={create:function(e,t){return{parse:function(){return s.parse(e,t)}}}},ie}var ae,Le;function Rt(){if(Le)return ae;Le=1;var s=/(\d{1,})-(\d{2})-(\d{2}) (\d{2}):(\d{2}):(\d{2})(\.\d{1,})?.*?( BC)?$/,e=/^(\d{1,})-(\d{2})-(\d{2})( BC)?$/,t=/([Z+-])(\d{2})?:?(\d{2})?:?(\d{2})?/,r=/^-?infinity$/;ae=function(l){if(r.test(l))return Number(l.replace("i","I"));var a=s.exec(l);if(!a)return n(l)||null;var d=!!a[8],p=parseInt(a[1],10);d&&(p=o(p));var m=parseInt(a[2],10)-1,v=a[3],_=parseInt(a[4],10),g=parseInt(a[5],10),u=parseInt(a[6],10),y=a[7];y=y?1e3*parseFloat(y):0;var S,x=i(l);return x!=null?(S=new Date(Date.UTC(p,m,v,_,g,u,y)),c(p)&&S.setUTCFullYear(p),x!==0&&S.setTime(S.getTime()-x)):(S=new Date(p,m,v,_,g,u,y),c(p)&&S.setFullYear(p)),S};function n(h){var l=e.exec(h);if(l){var a=parseInt(l[1],10),d=!!l[4];d&&(a=o(a));var p=parseInt(l[2],10)-1,m=l[3],v=new Date(a,p,m);return c(a)&&v.setFullYear(a),v}}function i(h){if(h.endsWith("+00"))return 0;var l=t.exec(h.split(" ")[1]);if(l){var a=l[1];if(a==="Z")return 0;var d=a==="-"?-1:1,p=parseInt(l[2],10)*3600+parseInt(l[3]||0,10)*60+parseInt(l[4]||0,10);return p*d*1e3}}function o(h){return-(h-1)}function c(h){return h>=0&&h<100}return ae}var oe,Oe;function It(){if(Oe)return oe;Oe=1,oe=e;var s=Object.prototype.hasOwnProperty;function e(t){for(var r=1;r<arguments.length;r++){var n=arguments[r];for(var i in n)s.call(n,i)&&(t[i]=n[i])}return t}return oe}var ue,qe;function kt(){if(qe)return ue;qe=1;var s=It();ue=e;function e(g){if(!(this instanceof e))return new e(g);s(this,_(g))}var t=["seconds","minutes","hours","days","months","years"];e.prototype.toPostgres=function(){var g=t.filter(this.hasOwnProperty,this);return this.milliseconds&&g.indexOf("seconds")<0&&g.push("seconds"),g.length===0?"0":g.map(function(u){var y=this[u]||0;return u==="seconds"&&this.milliseconds&&(y=(y+this.milliseconds/1e3).toFixed(6).replace(/\.?0+$/,"")),y+" "+u},this).join(" ")};var r={years:"Y",months:"M",days:"D",hours:"H",minutes:"M",seconds:"S"},n=["years","months","days"],i=["hours","minutes","seconds"];e.prototype.toISOString=e.prototype.toISO=function(){var g=n.map(y,this).join(""),u=i.map(y,this).join("");return"P"+g+"T"+u;function y(S){var x=this[S]||0;return S==="seconds"&&this.milliseconds&&(x=(x+this.milliseconds/1e3).toFixed(6).replace(/0+$/,"")),x+r[S]}};var o="([+-]?\\d+)",c=o+"\\s+years?",h=o+"\\s+mons?",l=o+"\\s+days?",a="([+-])?([\\d]*):(\\d\\d):(\\d\\d)\\.?(\\d{1,6})?",d=new RegExp([c,h,l,a].map(function(g){return"("+g+")?"}).join("\\s*")),p={years:2,months:4,days:6,hours:9,minutes:10,seconds:11,milliseconds:12},m=["hours","minutes","seconds","milliseconds"];function v(g){var u=g+"000000".slice(g.length);return parseInt(u,10)/1e3}function _(g){if(!g)return{};var u=d.exec(g),y=u[8]==="-";return Object.keys(p).reduce(function(S,x){var w=p[x],E=u[w];return!E||(E=x==="milliseconds"?v(E):parseInt(E,10),!E)||(y&&~m.indexOf(x)&&(E*=-1),S[x]=E),S},{})}return ue}var he,Qe;function Dt(){return Qe||(Qe=1,he=function(e){if(/^\\x/.test(e))return new Buffer(e.substr(2),"hex");for(var t="",r=0;r<e.length;)if(e[r]!=="\\")t+=e[r],++r;else if(/[0-7]{3}/.test(e.substr(r+1,3)))t+=String.fromCharCode(parseInt(e.substr(r+1,3),8)),r+=4;else{for(var n=1;r+n<e.length&&e[r+n]==="\\";)n++;for(var i=0;i<Math.floor(n/2);++i)t+="\\";r+=Math.floor(n/2)*2}return new Buffer(t,"binary")}),he}var ce,Ne;function Bt(){if(Ne)return ce;Ne=1;var s=lt(),e=ft(),t=Rt(),r=kt(),n=Dt();function i(f){return function(C){return C===null?C:f(C)}}function o(f){return f===null?f:f==="TRUE"||f==="t"||f==="true"||f==="y"||f==="yes"||f==="on"||f==="1"}function c(f){return f?s.parse(f,o):null}function h(f){return parseInt(f,10)}function l(f){return f?s.parse(f,i(h)):null}function a(f){return f?s.parse(f,i(function(b){return y(b).trim()})):null}var d=function(f){if(!f)return null;var b=e.create(f,function(C){return C!==null&&(C=x(C)),C});return b.parse()},p=function(f){if(!f)return null;var b=e.create(f,function(C){return C!==null&&(C=parseFloat(C)),C});return b.parse()},m=function(f){if(!f)return null;var b=e.create(f);return b.parse()},v=function(f){if(!f)return null;var b=e.create(f,function(C){return C!==null&&(C=t(C)),C});return b.parse()},_=function(f){if(!f)return null;var b=e.create(f,function(C){return C!==null&&(C=r(C)),C});return b.parse()},g=function(f){return f?s.parse(f,i(n)):null},u=function(f){return parseInt(f,10)},y=function(f){var b=String(f);return/^\d+$/.test(b)?b:f},S=function(f){return f?s.parse(f,i(JSON.parse)):null},x=function(f){return f[0]!=="("?null:(f=f.substring(1,f.length-1).split(","),{x:parseFloat(f[0]),y:parseFloat(f[1])})},w=function(f){if(f[0]!=="<"&&f[1]!=="(")return null;for(var b="(",C="",I=!1,T=2;T<f.length-1;T++){if(I||(b+=f[T]),f[T]===")"){I=!0;continue}else if(!I)continue;f[T]!==","&&(C+=f[T])}var q=x(b);return q.radius=parseFloat(C),q},E=function(f){f(20,y),f(21,u),f(23,u),f(26,u),f(700,parseFloat),f(701,parseFloat),f(16,o),f(1082,t),f(1114,t),f(1184,t),f(600,x),f(651,m),f(718,w),f(1e3,c),f(1001,g),f(1005,l),f(1007,l),f(1028,l),f(1016,a),f(1017,d),f(1021,p),f(1022,p),f(1231,p),f(1014,m),f(1015,m),f(1008,m),f(1009,m),f(1040,m),f(1041,m),f(1115,v),f(1182,v),f(1185,v),f(1186,r),f(1187,_),f(17,n),f(114,JSON.parse.bind(JSON)),f(3802,JSON.parse.bind(JSON)),f(199,S),f(3807,S),f(3907,m),f(2951,m),f(791,m),f(1183,m),f(1270,m)};return ce={init:E},ce}var le,Fe;function Lt(){if(Fe)return le;Fe=1;var s=1e6;function e(t){var r=t.readInt32BE(0),n=t.readUInt32BE(4),i="";r<0&&(r=~r+(n===0),n=~n+1>>>0,i="-");var o="",c,h,l,a,d,p;{if(c=r%s,r=r/s>>>0,h=4294967296*c+n,n=h/s>>>0,l=""+(h-s*n),n===0&&r===0)return i+l+o;for(a="",d=6-l.length,p=0;p<d;p++)a+="0";o=a+l+o}{if(c=r%s,r=r/s>>>0,h=4294967296*c+n,n=h/s>>>0,l=""+(h-s*n),n===0&&r===0)return i+l+o;for(a="",d=6-l.length,p=0;p<d;p++)a+="0";o=a+l+o}{if(c=r%s,r=r/s>>>0,h=4294967296*c+n,n=h/s>>>0,l=""+(h-s*n),n===0&&r===0)return i+l+o;for(a="",d=6-l.length,p=0;p<d;p++)a+="0";o=a+l+o}return c=r%s,h=4294967296*c+n,l=""+h%s,i+l+o}return le=e,le}var fe,Ue;function Ot(){if(Ue)return fe;Ue=1;var s=Lt(),e=function(m,v,_,g,u){_=_||0,g=g||!1,u=u||function(I,T,q){return I*Math.pow(2,q)+T};var y=_>>3,S=function(I){return g?~I&255:I},x=255,w=8-_%8;v<w&&(x=255<<8-v&255,w=v),_&&(x=x>>_%8);var E=0;_%8+v>=8&&(E=u(0,S(m[y])&x,w));for(var f=v+_>>3,b=y+1;b<f;b++)E=u(E,S(m[b]),8);var C=(v+_)%8;return C>0&&(E=u(E,S(m[f])>>8-C,C)),E},t=function(m,v,_){var g=Math.pow(2,_-1)-1,u=e(m,1),y=e(m,_,1);if(y===0)return 0;var S=1,x=function(E,f,b){E===0&&(E=1);for(var C=1;C<=b;C++)S/=2,(f&1<<b-C)>0&&(E+=S);return E},w=e(m,v,_+1,!1,x);return y==Math.pow(2,_+1)-1?w===0?u===0?1/0:-1/0:NaN:(u===0?1:-1)*Math.pow(2,y-g)*w},r=function(m){return e(m,1)==1?-1*(e(m,15,1,!0)+1):e(m,15,1)},n=function(m){return e(m,1)==1?-1*(e(m,31,1,!0)+1):e(m,31,1)},i=function(m){return t(m,23,8)},o=function(m){return t(m,52,11)},c=function(m){var v=e(m,16,32);if(v==49152)return NaN;for(var _=Math.pow(1e4,e(m,16,16)),g=0,u=e(m,16),y=0;y<u;y++)g+=e(m,16,64+16*y)*_,_/=1e4;var S=Math.pow(10,e(m,16,48));return(v===0?1:-1)*Math.round(g*S)/S},h=function(m,v){var _=e(v,1),g=e(v,63,1),u=new Date((_===0?1:-1)*g/1e3+9466848e5);return m||u.setTime(u.getTime()+u.getTimezoneOffset()*6e4),u.usec=g%1e3,u.getMicroSeconds=function(){return this.usec},u.setMicroSeconds=function(y){this.usec=y},u.getUTCMicroSeconds=function(){return this.usec},u},l=function(m){var v=e(m,32);e(m,32,32);for(var _=e(m,32,64),g=96,u=[],y=0;y<v;y++)u[y]=e(m,32,g),g+=32,g+=32;var S=function(w){var E=e(m,32,g);if(g+=32,E==4294967295)return null;var f;if(w==23||w==20)return f=e(m,E*8,g),g+=E*8,f;if(w==25)return f=m.toString(this.encoding,g>>3,(g+=E<<3)>>3),f;console.log("ERROR: ElementType not implemented: "+w)},x=function(w,E){var f=[],b;if(w.length>1){var C=w.shift();for(b=0;b<C;b++)f[b]=x(w,E);w.unshift(C)}else for(b=0;b<w[0];b++)f[b]=S(E);return f};return x(u,_)},a=function(m){return m.toString("utf8")},d=function(m){return m===null?null:e(m,8)>0},p=function(m){m(20,s),m(21,r),m(23,n),m(26,n),m(1700,c),m(700,i),m(701,o),m(16,d),m(1114,h.bind(null,!1)),m(1184,h.bind(null,!0)),m(1e3,l),m(1007,l),m(1016,l),m(1008,l),m(1009,l),m(25,a)};return fe={init:p},fe}var de,je;function qt(){return je||(je=1,de={BOOL:16,BYTEA:17,CHAR:18,INT8:20,INT2:21,INT4:23,REGPROC:24,TEXT:25,OID:26,TID:27,XID:28,CID:29,JSON:114,XML:142,PG_NODE_TREE:194,SMGR:210,PATH:602,POLYGON:604,CIDR:650,FLOAT4:700,FLOAT8:701,ABSTIME:702,RELTIME:703,TINTERVAL:704,CIRCLE:718,MACADDR8:774,MONEY:790,MACADDR:829,INET:869,ACLITEM:1033,BPCHAR:1042,VARCHAR:1043,DATE:1082,TIME:1083,TIMESTAMP:1114,TIMESTAMPTZ:1184,INTERVAL:1186,TIMETZ:1266,BIT:1560,VARBIT:1562,NUMERIC:1700,REFCURSOR:1790,REGPROCEDURE:2202,REGOPER:2203,REGOPERATOR:2204,REGCLASS:2205,REGTYPE:2206,UUID:2950,TXID_SNAPSHOT:2970,PG_LSN:3220,PG_NDISTINCT:3361,PG_DEPENDENCIES:3402,TSVECTOR:3614,TSQUERY:3615,GTSVECTOR:3642,REGCONFIG:3734,REGDICTIONARY:3769,JSONB:3802,REGNAMESPACE:4089,REGROLE:4096}),de}var $e;function z(){if($e)return F;$e=1;var s=Bt(),e=Ot(),t=ft(),r=qt();F.getTypeParser=o,F.setTypeParser=c,F.arrayParser=t,F.builtins=r;var n={text:{},binary:{}};function i(h){return String(h)}function o(h,l){return l=l||"text",n[l]&&n[l][h]||i}function c(h,l,a){typeof l=="function"&&(a=l,l="text"),n[l][h]=a}return s.init(function(h,l){n.text[h]=l}),e.init(function(h,l){n.binary[h]=l}),F}(function(s){var e={};s.exports={host:"localhost",user:process.platform==="win32"?e.USERNAME:e.USER,database:void 0,password:null,connectionString:void 0,port:5432,rows:0,binary:!1,max:10,idleTimeoutMillis:3e4,client_encoding:"",ssl:!1,application_name:void 0,fallback_application_name:void 0,options:void 0,parseInputDatesAsUTC:!1,statement_timeout:!1,lock_timeout:!1,idle_in_transaction_session_timeout:!1,query_timeout:!1,connect_timeout:0,keepalives:1,keepalives_idle:0};var t=z(),r=t.getTypeParser(20,"text"),n=t.getTypeParser(1016,"text");s.exports.__defineSetter__("parseInt8",function(i){t.setTypeParser(20,"text",i?t.getTypeParser(23,"text"):r),t.setTypeParser(1016,"text",i?t.getTypeParser(1007,"text"):n)})})(ct);var K=ct.exports;const Qt=K;function Nt(s){var e=s.replace(/\\/g,"\\\\").replace(/"/g,'\\"');return'"'+e+'"'}function dt(s){for(var e="{",t=0;t<s.length;t++)if(t>0&&(e=e+","),s[t]===null||typeof s[t]>"u")e=e+"NULL";else if(Array.isArray(s[t]))e=e+dt(s[t]);else if(ArrayBuffer.isView(s[t])){var r=s[t];if(!(r instanceof Buffer)){var n=Buffer.from(r.buffer,r.byteOffset,r.byteLength);n.length===r.byteLength?r=n:r=n.slice(r.byteOffset,r.byteOffset+r.byteLength)}e+="\\\\x"+r.toString("hex")}else e+=Nt(H(s[t]));return e=e+"}",e}var H=function(s,e){if(s==null)return null;if(s instanceof Buffer)return s;if(ArrayBuffer.isView(s)){var t=Buffer.from(s.buffer,s.byteOffset,s.byteLength);return t.length===s.byteLength?t:t.slice(s.byteOffset,s.byteOffset+s.byteLength)}return s instanceof Date?Qt.parseInputDatesAsUTC?jt(s):Ut(s):Array.isArray(s)?dt(s):typeof s=="object"?Ft(s,e):s.toString()};function Ft(s,e){if(s&&typeof s.toPostgres=="function"){if(e=e||[],e.indexOf(s)!==-1)throw new Error('circular reference detected while preparing "'+s+'" for query');return e.push(s),H(s.toPostgres(H),e)}return JSON.stringify(s)}function D(s,e){for(s=""+s;s.length<e;)s="0"+s;return s}function Ut(s){var e=-s.getTimezoneOffset(),t=s.getFullYear(),r=t<1;r&&(t=Math.abs(t)+1);var n=D(t,4)+"-"+D(s.getMonth()+1,2)+"-"+D(s.getDate(),2)+"T"+D(s.getHours(),2)+":"+D(s.getMinutes(),2)+":"+D(s.getSeconds(),2)+"."+D(s.getMilliseconds(),3);return e<0?(n+="-",e*=-1):n+="+",n+=D(Math.floor(e/60),2)+":"+D(e%60,2),r&&(n+=" BC"),n}function jt(s){var e=s.getUTCFullYear(),t=e<1;t&&(e=Math.abs(e)+1);var r=D(e,4)+"-"+D(s.getUTCMonth()+1,2)+"-"+D(s.getUTCDate(),2)+"T"+D(s.getUTCHours(),2)+":"+D(s.getUTCMinutes(),2)+":"+D(s.getUTCSeconds(),2)+"."+D(s.getUTCMilliseconds(),3);return r+="+00:00",t&&(r+=" BC"),r}function $t(s,e,t){return s=typeof s=="string"?{text:s}:s,e&&(typeof e=="function"?s.callback=e:s.values=e),t&&(s.callback=t),s}const Gt=function(s){return'"'+s.replace(/"/g,'""')+'"'},Ht=function(s){for(var e=!1,t="'",r=0;r<s.length;r++){var n=s[r];n==="'"?t+=n+n:n==="\\"?(t+=n+n,e=!0):t+=n}return t+="'",e===!0&&(t=" E"+t),t};var V={prepareValue:function(e){return H(e)},normalizeQueryConfig:$t,escapeIdentifier:Gt,escapeLiteral:Ht},Ce={exports:{}},pe,Ge;function Wt(){if(Ge)return pe;Ge=1;const s=R;function e(o){return s.createHash("md5").update(o,"utf-8").digest("hex")}function t(o,c,h){var l=e(c+o),a=e(Buffer.concat([Buffer.from(l),h]));return"md5"+a}function r(o){return s.createHash("sha256").update(o).digest()}function n(o,c){return s.createHmac("sha256",o).update(c).digest()}async function i(o,c,h){return s.pbkdf2Sync(o,c,h,32,"sha256")}return pe={postgresMd5PasswordHash:t,randomBytes:s.randomBytes,deriveKey:i,sha256:r,hmacSha256:n,md5:e},pe}var me,He;function zt(){if(He)return me;He=1;const s=R;me={postgresMd5PasswordHash:o,randomBytes:n,deriveKey:l,sha256:c,hmacSha256:h,md5:i};const e=s.webcrypto||globalThis.crypto,t=e.subtle,r=new TextEncoder;function n(a){return e.getRandomValues(Buffer.alloc(a))}async function i(a){try{return s.createHash("md5").update(a,"utf-8").digest("hex")}catch{const p=typeof a=="string"?r.encode(a):a,m=await t.digest("MD5",p);return Array.from(new Uint8Array(m)).map(v=>v.toString(16).padStart(2,"0")).join("")}}async function o(a,d,p){var m=await i(d+a),v=await i(Buffer.concat([Buffer.from(m),p]));return"md5"+v}async function c(a){return await t.digest("SHA-256",a)}async function h(a,d){const p=await t.importKey("raw",a,{name:"HMAC",hash:"SHA-256"},!1,["sign"]);return await t.sign("HMAC",p,r.encode(d))}async function l(a,d,p){const m=await t.importKey("raw",r.encode(a),"PBKDF2",!1,["deriveBits"]),v={name:"PBKDF2",hash:"SHA-256",salt:d,iterations:p};return await t.deriveBits(v,m,32*8,["deriveBits"])}return me}const Kt=parseInt(process.versions&&process.versions.node&&process.versions.node.split(".")[0])<15;Kt?Ce.exports=Wt():Ce.exports=zt();var pt=Ce.exports;const Q=pt;function Vt(s){if(s.indexOf("SCRAM-SHA-256")===-1)throw new Error("SASL: Only mechanism SCRAM-SHA-256 is currently supported");const e=Q.randomBytes(18).toString("base64");return{mechanism:"SCRAM-SHA-256",clientNonce:e,response:"n,,n=*,r="+e,message:"SASLInitialResponse"}}async function Yt(s,e,t){if(s.message!=="SASLInitialResponse")throw new Error("SASL: Last message was not SASLInitialResponse");if(typeof e!="string")throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: client password must be a string");if(e==="")throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: client password must be a non-empty string");if(typeof t!="string")throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: serverData must be a string");const r=Xt(t);if(r.nonce.startsWith(s.clientNonce)){if(r.nonce.length===s.clientNonce.length)throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: server nonce is too short")}else throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: server nonce does not start with client nonce");var n="n=*,r="+s.clientNonce,i="r="+r.nonce+",s="+r.salt+",i="+r.iteration,o="c=biws,r="+r.nonce,c=n+","+i+","+o,h=Buffer.from(r.salt,"base64"),l=await Q.deriveKey(e,h,r.iteration),a=await Q.hmacSha256(l,"Client Key"),d=await Q.sha256(a),p=await Q.hmacSha256(d,c),m=tr(Buffer.from(a),Buffer.from(p)).toString("base64"),v=await Q.hmacSha256(l,"Server Key"),_=await Q.hmacSha256(v,c);s.message="SASLResponse",s.serverSignature=Buffer.from(_).toString("base64"),s.response=o+",p="+m}function Zt(s,e){if(s.message!=="SASLResponse")throw new Error("SASL: Last message was not SASLResponse");if(typeof e!="string")throw new Error("SASL: SCRAM-SERVER-FINAL-MESSAGE: serverData must be a string");const{serverSignature:t}=er(e);if(t!==s.serverSignature)throw new Error("SASL: SCRAM-SERVER-FINAL-MESSAGE: server signature does not match")}function Jt(s){if(typeof s!="string")throw new TypeError("SASL: text must be a string");return s.split("").map((e,t)=>s.charCodeAt(t)).every(e=>e>=33&&e<=43||e>=45&&e<=126)}function mt(s){return/^(?:[a-zA-Z0-9+/]{4})*(?:[a-zA-Z0-9+/]{2}==|[a-zA-Z0-9+/]{3}=)?$/.test(s)}function yt(s){if(typeof s!="string")throw new TypeError("SASL: attribute pairs text must be a string");return new Map(s.split(",").map(e=>{if(!/^.=/.test(e))throw new Error("SASL: Invalid attribute pair entry");const t=e[0],r=e.substring(2);return[t,r]}))}function Xt(s){const e=yt(s),t=e.get("r");if(t){if(!Jt(t))throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: nonce must only contain printable characters")}else throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: nonce missing");const r=e.get("s");if(r){if(!mt(r))throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: salt must be base64")}else throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: salt missing");const n=e.get("i");if(n){if(!/^[1-9][0-9]*$/.test(n))throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: invalid iteration count")}else throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: iteration missing");const i=parseInt(n,10);return{nonce:t,salt:r,iteration:i}}function er(s){const t=yt(s).get("v");if(t){if(!mt(t))throw new Error("SASL: SCRAM-SERVER-FINAL-MESSAGE: server signature must be base64")}else throw new Error("SASL: SCRAM-SERVER-FINAL-MESSAGE: server signature is missing");return{serverSignature:t}}function tr(s,e){if(!Buffer.isBuffer(s))throw new TypeError("first argument must be a Buffer");if(!Buffer.isBuffer(e))throw new TypeError("second argument must be a Buffer");if(s.length!==e.length)throw new Error("Buffer lengths must match");if(s.length===0)throw new Error("Buffers cannot be empty");return Buffer.from(s.map((t,r)=>s[r]^e[r]))}var rr={startSession:Vt,continueSession:Yt,finalizeSession:Zt},sr=z();function Y(s){this._types=s||sr,this.text={},this.binary={}}Y.prototype.getOverrides=function(s){switch(s){case"text":return this.text;case"binary":return this.binary;default:return{}}};Y.prototype.setTypeParser=function(s,e,t){typeof e=="function"&&(t=e,e="text"),this.getOverrides(e)[s]=t};Y.prototype.getTypeParser=function(s,e){return e=e||"text",this.getOverrides(e)[s]||this._types.getTypeParser(s,e)};var vt=Y;function Pe(s){if(s.charAt(0)==="/"){const c=s.split(" ");return{host:c[0],database:c[1]}}const e={};let t,r=!1;/ |%[^a-f0-9]|%[a-f0-9][^a-f0-9]/i.test(s)&&(s=encodeURI(s).replace(/\%25(\d\d)/g,"%$1"));try{t=new URL(s,"postgres://base")}catch{t=new URL(s.replace("@/","@___DUMMY___/"),"postgres://base"),r=!0}for(const c of t.searchParams.entries())e[c[0]]=c[1];if(e.user=e.user||decodeURIComponent(t.username),e.password=e.password||decodeURIComponent(t.password),t.protocol=="socket:")return e.host=decodeURI(t.pathname),e.database=t.searchParams.get("db"),e.client_encoding=t.searchParams.get("encoding"),e;const n=r?"":t.hostname;e.host?n&&/^%2f/i.test(n)&&(t.pathname=n+t.pathname):e.host=decodeURIComponent(n),e.port||(e.port=t.port);const i=t.pathname.slice(1)||null;e.database=i?decodeURI(i):null,(e.ssl==="true"||e.ssl==="1")&&(e.ssl=!0),e.ssl==="0"&&(e.ssl=!1),(e.sslcert||e.sslkey||e.sslrootcert||e.sslmode)&&(e.ssl={});const o=e.sslcert||e.sslkey||e.sslrootcert?R:null;switch(e.sslcert&&(e.ssl.cert=o.readFileSync(e.sslcert).toString()),e.sslkey&&(e.ssl.key=o.readFileSync(e.sslkey).toString()),e.sslrootcert&&(e.ssl.ca=o.readFileSync(e.sslrootcert).toString()),e.sslmode){case"disable":{e.ssl=!1;break}case"prefer":case"require":case"verify-ca":case"verify-full":break;case"no-verify":{e.ssl.rejectUnauthorized=!1;break}}return e}var nr=Pe;Pe.parse=Pe;var W={},ir=R,gt=K,We=nr.parse,B=function(s,e,t){return t===void 0?t=W["PG"+s.toUpperCase()]:t===!1||(t=W[t]),e[s]||t||gt[s]},ar=function(){switch(W.PGSSLMODE){case"disable":return!1;case"prefer":case"require":case"verify-ca":case"verify-full":return!0;case"no-verify":return{rejectUnauthorized:!1}}return gt.ssl},U=function(s){return"'"+(""+s).replace(/\\/g,"\\\\").replace(/'/g,"\\'")+"'"},L=function(s,e,t){var r=e[t];r!=null&&s.push(t+"="+U(r))};let or=class{constructor(e){e=typeof e=="string"?We(e):e||{},e.connectionString&&(e=Object.assign({},e,We(e.connectionString))),this.user=B("user",e),this.database=B("database",e),this.database===void 0&&(this.database=this.user),this.port=parseInt(B("port",e),10),this.host=B("host",e),Object.defineProperty(this,"password",{configurable:!0,enumerable:!1,writable:!0,value:B("password",e)}),this.binary=B("binary",e),this.options=B("options",e),this.ssl=typeof e.ssl>"u"?ar():e.ssl,typeof this.ssl=="string"&&this.ssl==="true"&&(this.ssl=!0),this.ssl==="no-verify"&&(this.ssl={rejectUnauthorized:!1}),this.ssl&&this.ssl.key&&Object.defineProperty(this.ssl,"key",{enumerable:!1}),this.client_encoding=B("client_encoding",e),this.replication=B("replication",e),this.isDomainSocket=!(this.host||"").indexOf("/"),this.application_name=B("application_name",e,"PGAPPNAME"),this.fallback_application_name=B("fallback_application_name",e,!1),this.statement_timeout=B("statement_timeout",e,!1),this.lock_timeout=B("lock_timeout",e,!1),this.idle_in_transaction_session_timeout=B("idle_in_transaction_session_timeout",e,!1),this.query_timeout=B("query_timeout",e,!1),e.connectionTimeoutMillis===void 0?this.connect_timeout=W.PGCONNECT_TIMEOUT||0:this.connect_timeout=Math.floor(e.connectionTimeoutMillis/1e3),e.keepAlive===!1?this.keepalives=0:e.keepAlive===!0&&(this.keepalives=1),typeof e.keepAliveInitialDelayMillis=="number"&&(this.keepalives_idle=Math.floor(e.keepAliveInitialDelayMillis/1e3))}getLibpqConnectionString(e){var t=[];L(t,this,"user"),L(t,this,"password"),L(t,this,"port"),L(t,this,"application_name"),L(t,this,"fallback_application_name"),L(t,this,"connect_timeout"),L(t,this,"options");var r=typeof this.ssl=="object"?this.ssl:this.ssl?{sslmode:this.ssl}:{};if(L(t,r,"sslmode"),L(t,r,"sslca"),L(t,r,"sslkey"),L(t,r,"sslcert"),L(t,r,"sslrootcert"),this.database&&t.push("dbname="+U(this.database)),this.replication&&t.push("replication="+U(this.replication)),this.host&&t.push("host="+U(this.host)),this.isDomainSocket)return e(null,t.join(" "));this.client_encoding&&t.push("client_encoding="+U(this.client_encoding)),ir.lookup(this.host,function(n,i){return n?e(n,null):(t.push("hostaddr="+U(i)),e(null,t.join(" ")))})}};var _t=or,ur=z(),ze=/^([A-Za-z]+)(?: (\d+))?(?: (\d+))?/;let hr=class{constructor(e,t){this.command=null,this.rowCount=null,this.oid=null,this.rows=[],this.fields=[],this._parsers=void 0,this._types=t,this.RowCtor=null,this.rowAsArray=e==="array",this.rowAsArray&&(this.parseRow=this._parseRowAsArray),this._prebuiltEmptyResultObject=null}addCommandComplete(e){var t;e.text?t=ze.exec(e.text):t=ze.exec(e.command),t&&(this.command=t[1],t[3]?(this.oid=parseInt(t[2],10),this.rowCount=parseInt(t[3],10)):t[2]&&(this.rowCount=parseInt(t[2],10)))}_parseRowAsArray(e){for(var t=new Array(e.length),r=0,n=e.length;r<n;r++){var i=e[r];i!==null?t[r]=this._parsers[r](i):t[r]=null}return t}parseRow(e){for(var t={...this._prebuiltEmptyResultObject},r=0,n=e.length;r<n;r++){var i=e[r],o=this.fields[r].name;i!==null?t[o]=this._parsers[r](i):t[o]=null}return t}addRow(e){this.rows.push(e)}addFields(e){this.fields=e,this.fields.length&&(this._parsers=new Array(e.length));for(var t={},r=0;r<e.length;r++){var n=e[r];t[n.name]=null,this._types?this._parsers[r]=this._types.getTypeParser(n.dataTypeID,n.format||"text"):this._parsers[r]=ur.getTypeParser(n.dataTypeID,n.format||"text")}this._prebuiltEmptyResultObject={...t}}};var cr=hr;const{EventEmitter:lr}=R,Ke=cr,Ve=V;let fr=class extends lr{constructor(e,t,r){super(),e=Ve.normalizeQueryConfig(e,t,r),this.text=e.text,this.values=e.values,this.rows=e.rows,this.types=e.types,this.name=e.name,this.queryMode=e.queryMode,this.binary=e.binary,this.portal=e.portal||"",this.callback=e.callback,this._rowMode=e.rowMode,process.domain&&e.callback&&(this.callback=process.domain.bind(e.callback)),this._result=new Ke(this._rowMode,this.types),this._results=this._result,this._canceledDueToError=!1}requiresPreparation(){return this.queryMode==="extended"||this.name||this.rows?!0:!this.text||!this.values?!1:this.values.length>0}_checkForMultirow(){this._result.command&&(Array.isArray(this._results)||(this._results=[this._result]),this._result=new Ke(this._rowMode,this.types),this._results.push(this._result))}handleRowDescription(e){this._checkForMultirow(),this._result.addFields(e.fields),this._accumulateRows=this.callback||!this.listeners("row").length}handleDataRow(e){let t;if(!this._canceledDueToError){try{t=this._result.parseRow(e.fields)}catch(r){this._canceledDueToError=r;return}this.emit("row",t,this._result),this._accumulateRows&&this._result.addRow(t)}}handleCommandComplete(e,t){this._checkForMultirow(),this._result.addCommandComplete(e),this.rows&&t.sync()}handleEmptyQuery(e){this.rows&&e.sync()}handleError(e,t){if(this._canceledDueToError&&(e=this._canceledDueToError,this._canceledDueToError=!1),this.callback)return this.callback(e);this.emit("error",e)}handleReadyForQuery(e){if(this._canceledDueToError)return this.handleError(this._canceledDueToError,e);if(this.callback)try{this.callback(null,this._results)}catch(t){process.nextTick(()=>{throw t})}this.emit("end",this._results)}submit(e){if(typeof this.text!="string"&&typeof this.name!="string")return new Error("A query must have either text or a name. Supplying neither is unsupported.");const t=e.parsedStatements[this.name];return this.text&&t&&this.text!==t?new Error(`Prepared statements must be unique - '${this.name}' was used for a different statement`):this.values&&!Array.isArray(this.values)?new Error("Query values must be an array"):(this.requiresPreparation()?this.prepare(e):e.query(this.text),null)}hasBeenParsed(e){return this.name&&e.parsedStatements[this.name]}handlePortalSuspended(e){this._getRows(e,this.rows)}_getRows(e,t){e.execute({portal:this.portal,rows:t}),t?e.flush():e.sync()}prepare(e){this.hasBeenParsed(e)||e.parse({text:this.text,name:this.name,types:this.types});try{e.bind({portal:this.portal,statement:this.name,values:this.values,binary:this.binary,valueMapper:Ve.prepareValue})}catch(t){this.handleError(t,e);return}e.describe({type:"P",name:this.portal||""}),this._getRows(e,this.rows)}handleCopyInResponse(e){e.sendCopyFail("No source stream defined")}handleCopyData(e,t){}};var dr=fr,Ae={},P={};Object.defineProperty(P,"__esModule",{value:!0});P.NoticeMessage=P.DataRowMessage=P.CommandCompleteMessage=P.ReadyForQueryMessage=P.NotificationResponseMessage=P.BackendKeyDataMessage=P.AuthenticationMD5Password=P.ParameterStatusMessage=P.ParameterDescriptionMessage=P.RowDescriptionMessage=P.Field=P.CopyResponse=P.CopyDataMessage=P.DatabaseError=P.copyDone=P.emptyQuery=P.replicationStart=P.portalSuspended=P.noData=P.closeComplete=P.bindComplete=P.parseComplete=void 0;P.parseComplete={name:"parseComplete",length:5};P.bindComplete={name:"bindComplete",length:5};P.closeComplete={name:"closeComplete",length:5};P.noData={name:"noData",length:5};P.portalSuspended={name:"portalSuspended",length:5};P.replicationStart={name:"replicationStart",length:4};P.emptyQuery={name:"emptyQuery",length:4};P.copyDone={name:"copyDone",length:4};class pr extends Error{constructor(e,t,r){super(e),this.length=t,this.name=r}}P.DatabaseError=pr;class mr{constructor(e,t){this.length=e,this.chunk=t,this.name="copyData"}}P.CopyDataMessage=mr;class yr{constructor(e,t,r,n){this.length=e,this.name=t,this.binary=r,this.columnTypes=new Array(n)}}P.CopyResponse=yr;class vr{constructor(e,t,r,n,i,o,c){this.name=e,this.tableID=t,this.columnID=r,this.dataTypeID=n,this.dataTypeSize=i,this.dataTypeModifier=o,this.format=c}}P.Field=vr;class gr{constructor(e,t){this.length=e,this.fieldCount=t,this.name="rowDescription",this.fields=new Array(this.fieldCount)}}P.RowDescriptionMessage=gr;class _r{constructor(e,t){this.length=e,this.parameterCount=t,this.name="parameterDescription",this.dataTypeIDs=new Array(this.parameterCount)}}P.ParameterDescriptionMessage=_r;class wr{constructor(e,t,r){this.length=e,this.parameterName=t,this.parameterValue=r,this.name="parameterStatus"}}P.ParameterStatusMessage=wr;class Sr{constructor(e,t){this.length=e,this.salt=t,this.name="authenticationMD5Password"}}P.AuthenticationMD5Password=Sr;class Er{constructor(e,t,r){this.length=e,this.processID=t,this.secretKey=r,this.name="backendKeyData"}}P.BackendKeyDataMessage=Er;class br{constructor(e,t,r,n){this.length=e,this.processId=t,this.channel=r,this.payload=n,this.name="notification"}}P.NotificationResponseMessage=br;class Cr{constructor(e,t){this.length=e,this.status=t,this.name="readyForQuery"}}P.ReadyForQueryMessage=Cr;class Pr{constructor(e,t){this.length=e,this.text=t,this.name="commandComplete"}}P.CommandCompleteMessage=Pr;class xr{constructor(e,t){this.length=e,this.fields=t,this.name="dataRow",this.fieldCount=t.length}}P.DataRowMessage=xr;class Tr{constructor(e,t){this.length=e,this.message=t,this.name="notice"}}P.NoticeMessage=Tr;var Z={},J={};Object.defineProperty(J,"__esModule",{value:!0});J.Writer=void 0;class Mr{constructor(e=256){this.size=e,this.offset=5,this.headerPosition=0,this.buffer=Buffer.allocUnsafe(e)}ensure(e){var t=this.buffer.length-this.offset;if(t<e){var r=this.buffer,n=r.length+(r.length>>1)+e;this.buffer=Buffer.allocUnsafe(n),r.copy(this.buffer)}}addInt32(e){return this.ensure(4),this.buffer[this.offset++]=e>>>24&255,this.buffer[this.offset++]=e>>>16&255,this.buffer[this.offset++]=e>>>8&255,this.buffer[this.offset++]=e>>>0&255,this}addInt16(e){return this.ensure(2),this.buffer[this.offset++]=e>>>8&255,this.buffer[this.offset++]=e>>>0&255,this}addCString(e){if(!e)this.ensure(1);else{var t=Buffer.byteLength(e);this.ensure(t+1),this.buffer.write(e,this.offset,"utf-8"),this.offset+=t}return this.buffer[this.offset++]=0,this}addString(e=""){var t=Buffer.byteLength(e);return this.ensure(t),this.buffer.write(e,this.offset),this.offset+=t,this}add(e){return this.ensure(e.length),e.copy(this.buffer,this.offset),this.offset+=e.length,this}join(e){if(e){this.buffer[this.headerPosition]=e;const t=this.offset-(this.headerPosition+1);this.buffer.writeInt32BE(t,this.headerPosition+1)}return this.buffer.slice(e?0:5,this.offset)}flush(e){var t=this.join(e);return this.offset=5,this.headerPosition=0,this.buffer=Buffer.allocUnsafe(this.size),t}}J.Writer=Mr;Object.defineProperty(Z,"__esModule",{value:!0});Z.serialize=void 0;const Re=J,A=new Re.Writer,Ar=s=>{A.addInt16(3).addInt16(0);for(const r of Object.keys(s))A.addCString(r).addCString(s[r]);A.addCString("client_encoding").addCString("UTF8");var e=A.addCString("").flush(),t=e.length+4;return new Re.Writer().addInt32(t).add(e).flush()},Rr=()=>{const s=Buffer.allocUnsafe(8);return s.writeInt32BE(8,0),s.writeInt32BE(80877103,4),s},Ir=s=>A.addCString(s).flush(112),kr=function(s,e){return A.addCString(s).addInt32(Buffer.byteLength(e)).addString(e),A.flush(112)},Dr=function(s){return A.addString(s).flush(112)},Br=s=>A.addCString(s).flush(81),wt=[],Lr=s=>{const e=s.name||"";e.length>63&&(console.error("Warning! Postgres only supports 63 characters for query names."),console.error("You supplied %s (%s)",e,e.length),console.error("This can cause conflicts and silent errors executing queries"));const t=s.types||wt;for(var r=t.length,n=A.addCString(e).addCString(s.text).addInt16(r),i=0;i<r;i++)n.addInt32(t[i]);return A.flush(80)},j=new Re.Writer,Or=function(s,e){for(let t=0;t<s.length;t++){const r=e?e(s[t],t):s[t];r==null?(A.addInt16(0),j.addInt32(-1)):r instanceof Buffer?(A.addInt16(1),j.addInt32(r.length),j.add(r)):(A.addInt16(0),j.addInt32(Buffer.byteLength(r)),j.addString(r))}},qr=(s={})=>{const e=s.portal||"",t=s.statement||"",r=s.binary||!1,n=s.values||wt,i=n.length;return A.addCString(e).addCString(t),A.addInt16(i),Or(n,s.valueMapper),A.addInt16(i),A.add(j.flush()),A.addInt16(r?1:0),A.flush(66)},Qr=Buffer.from([69,0,0,0,9,0,0,0,0,0]),Nr=s=>{if(!s||!s.portal&&!s.rows)return Qr;const e=s.portal||"",t=s.rows||0,r=Buffer.byteLength(e),n=4+r+1+4,i=Buffer.allocUnsafe(1+n);return i[0]=69,i.writeInt32BE(n,1),i.write(e,5,"utf-8"),i[r+5]=0,i.writeUInt32BE(t,i.length-4),i},Fr=(s,e)=>{const t=Buffer.allocUnsafe(16);return t.writeInt32BE(16,0),t.writeInt16BE(1234,4),t.writeInt16BE(5678,6),t.writeInt32BE(s,8),t.writeInt32BE(e,12),t},Ie=(s,e)=>{const r=4+Buffer.byteLength(e)+1,n=Buffer.allocUnsafe(1+r);return n[0]=s,n.writeInt32BE(r,1),n.write(e,5,"utf-8"),n[r]=0,n},Ur=A.addCString("P").flush(68),jr=A.addCString("S").flush(68),$r=s=>s.name?Ie(68,`${s.type}${s.name||""}`):s.type==="P"?Ur:jr,Gr=s=>{const e=`${s.type}${s.name||""}`;return Ie(67,e)},Hr=s=>A.add(s).flush(100),Wr=s=>Ie(102,s),X=s=>Buffer.from([s,0,0,0,4]),zr=X(72),Kr=X(83),Vr=X(88),Yr=X(99),Zr={startup:Ar,password:Ir,requestSsl:Rr,sendSASLInitialResponseMessage:kr,sendSCRAMClientFinalMessage:Dr,query:Br,parse:Lr,bind:qr,execute:Nr,describe:$r,close:Gr,flush:()=>zr,sync:()=>Kr,end:()=>Vr,copyData:Hr,copyDone:()=>Yr,copyFail:Wr,cancel:Fr};Z.serialize=Zr;var ee={},te={};Object.defineProperty(te,"__esModule",{value:!0});te.BufferReader=void 0;const Jr=Buffer.allocUnsafe(0);class Xr{constructor(e=0){this.offset=e,this.buffer=Jr,this.encoding="utf-8"}setBuffer(e,t){this.offset=e,this.buffer=t}int16(){const e=this.buffer.readInt16BE(this.offset);return this.offset+=2,e}byte(){const e=this.buffer[this.offset];return this.offset++,e}int32(){const e=this.buffer.readInt32BE(this.offset);return this.offset+=4,e}string(e){const t=this.buffer.toString(this.encoding,this.offset,this.offset+e);return this.offset+=e,t}cstring(){const e=this.offset;let t=e;for(;this.buffer[t++]!==0;);return this.offset=t,this.buffer.toString(this.encoding,e,t-1)}bytes(e){const t=this.buffer.slice(this.offset,this.offset+e);return this.offset+=e,t}}te.BufferReader=Xr;Object.defineProperty(ee,"__esModule",{value:!0});ee.Parser=void 0;const M=P,es=te,xe=1,ts=4,Ye=xe+ts,Ze=Buffer.allocUnsafe(0);class rs{constructor(e){if(this.buffer=Ze,this.bufferLength=0,this.bufferOffset=0,this.reader=new es.BufferReader,e?.mode==="binary")throw new Error("Binary mode not supported yet");this.mode=e?.mode||"text"}parse(e,t){this.mergeBuffer(e);const r=this.bufferOffset+this.bufferLength;let n=this.bufferOffset;for(;n+Ye<=r;){const i=this.buffer[n],o=this.buffer.readUInt32BE(n+xe),c=xe+o;if(c+n<=r){const h=this.handlePacket(n+Ye,i,o,this.buffer);t(h),n+=c}else break}n===r?(this.buffer=Ze,this.bufferLength=0,this.bufferOffset=0):(this.bufferLength=r-n,this.bufferOffset=n)}mergeBuffer(e){if(this.bufferLength>0){const t=this.bufferLength+e.byteLength;if(t+this.bufferOffset>this.buffer.byteLength){let n;if(t<=this.buffer.byteLength&&this.bufferOffset>=this.bufferLength)n=this.buffer;else{let i=this.buffer.byteLength*2;for(;t>=i;)i*=2;n=Buffer.allocUnsafe(i)}this.buffer.copy(n,0,this.bufferOffset,this.bufferOffset+this.bufferLength),this.buffer=n,this.bufferOffset=0}e.copy(this.buffer,this.bufferOffset+this.bufferLength),this.bufferLength=t}else this.buffer=e,this.bufferOffset=0,this.bufferLength=e.byteLength}handlePacket(e,t,r,n){switch(t){case 50:return M.bindComplete;case 49:return M.parseComplete;case 51:return M.closeComplete;case 110:return M.noData;case 115:return M.portalSuspended;case 99:return M.copyDone;case 87:return M.replicationStart;case 73:return M.emptyQuery;case 68:return this.parseDataRowMessage(e,r,n);case 67:return this.parseCommandCompleteMessage(e,r,n);case 90:return this.parseReadyForQueryMessage(e,r,n);case 65:return this.parseNotificationMessage(e,r,n);case 82:return this.parseAuthenticationResponse(e,r,n);case 83:return this.parseParameterStatusMessage(e,r,n);case 75:return this.parseBackendKeyData(e,r,n);case 69:return this.parseErrorMessage(e,r,n,"error");case 78:return this.parseErrorMessage(e,r,n,"notice");case 84:return this.parseRowDescriptionMessage(e,r,n);case 116:return this.parseParameterDescriptionMessage(e,r,n);case 71:return this.parseCopyInMessage(e,r,n);case 72:return this.parseCopyOutMessage(e,r,n);case 100:return this.parseCopyData(e,r,n);default:return new M.DatabaseError("received invalid response: "+t.toString(16),r,"error")}}parseReadyForQueryMessage(e,t,r){this.reader.setBuffer(e,r);const n=this.reader.string(1);return new M.ReadyForQueryMessage(t,n)}parseCommandCompleteMessage(e,t,r){this.reader.setBuffer(e,r);const n=this.reader.cstring();return new M.CommandCompleteMessage(t,n)}parseCopyData(e,t,r){const n=r.slice(e,e+(t-4));return new M.CopyDataMessage(t,n)}parseCopyInMessage(e,t,r){return this.parseCopyMessage(e,t,r,"copyInResponse")}parseCopyOutMessage(e,t,r){return this.parseCopyMessage(e,t,r,"copyOutResponse")}parseCopyMessage(e,t,r,n){this.reader.setBuffer(e,r);const i=this.reader.byte()!==0,o=this.reader.int16(),c=new M.CopyResponse(t,n,i,o);for(let h=0;h<o;h++)c.columnTypes[h]=this.reader.int16();return c}parseNotificationMessage(e,t,r){this.reader.setBuffer(e,r);const n=this.reader.int32(),i=this.reader.cstring(),o=this.reader.cstring();return new M.NotificationResponseMessage(t,n,i,o)}parseRowDescriptionMessage(e,t,r){this.reader.setBuffer(e,r);const n=this.reader.int16(),i=new M.RowDescriptionMessage(t,n);for(let o=0;o<n;o++)i.fields[o]=this.parseField();return i}parseField(){const e=this.reader.cstring(),t=this.reader.int32(),r=this.reader.int16(),n=this.reader.int32(),i=this.reader.int16(),o=this.reader.int32(),c=this.reader.int16()===0?"text":"binary";return new M.Field(e,t,r,n,i,o,c)}parseParameterDescriptionMessage(e,t,r){this.reader.setBuffer(e,r);const n=this.reader.int16(),i=new M.ParameterDescriptionMessage(t,n);for(let o=0;o<n;o++)i.dataTypeIDs[o]=this.reader.int32();return i}parseDataRowMessage(e,t,r){this.reader.setBuffer(e,r);const n=this.reader.int16(),i=new Array(n);for(let o=0;o<n;o++){const c=this.reader.int32();i[o]=c===-1?null:this.reader.string(c)}return new M.DataRowMessage(t,i)}parseParameterStatusMessage(e,t,r){this.reader.setBuffer(e,r);const n=this.reader.cstring(),i=this.reader.cstring();return new M.ParameterStatusMessage(t,n,i)}parseBackendKeyData(e,t,r){this.reader.setBuffer(e,r);const n=this.reader.int32(),i=this.reader.int32();return new M.BackendKeyDataMessage(t,n,i)}parseAuthenticationResponse(e,t,r){this.reader.setBuffer(e,r);const n=this.reader.int32(),i={name:"authenticationOk",length:t};switch(n){case 0:break;case 3:i.length===8&&(i.name="authenticationCleartextPassword");break;case 5:if(i.length===12){i.name="authenticationMD5Password";const c=this.reader.bytes(4);return new M.AuthenticationMD5Password(t,c)}break;case 10:i.name="authenticationSASL",i.mechanisms=[];let o;do o=this.reader.cstring(),o&&i.mechanisms.push(o);while(o);break;case 11:i.name="authenticationSASLContinue",i.data=this.reader.string(t-8);break;case 12:i.name="authenticationSASLFinal",i.data=this.reader.string(t-8);break;default:throw new Error("Unknown authenticationOk message type "+n)}return i}parseErrorMessage(e,t,r,n){this.reader.setBuffer(e,r);const i={};let o=this.reader.string(1);for(;o!=="\0";)i[o]=this.reader.cstring(),o=this.reader.string(1);const c=i.M,h=n==="notice"?new M.NoticeMessage(t,c):new M.DatabaseError(c,t,n);return h.severity=i.S,h.code=i.C,h.detail=i.D,h.hint=i.H,h.position=i.P,h.internalPosition=i.p,h.internalQuery=i.q,h.where=i.W,h.schema=i.s,h.table=i.t,h.column=i.c,h.dataType=i.d,h.constraint=i.n,h.file=i.F,h.line=i.L,h.routine=i.R,h}}ee.Parser=rs;(function(s){Object.defineProperty(s,"__esModule",{value:!0}),s.DatabaseError=s.serialize=s.parse=void 0;const e=P;Object.defineProperty(s,"DatabaseError",{enumerable:!0,get:function(){return e.DatabaseError}});const t=Z;Object.defineProperty(s,"serialize",{enumerable:!0,get:function(){return t.serialize}});const r=ee;function n(i,o){const c=new r.Parser;return i.on("data",h=>c.parse(h,o)),new Promise(h=>i.on("end",()=>h()))}s.parse=n})(Ae);var ke={};const ss={},ns=Object.freeze(Object.defineProperty({__proto__:null,default:ss},Symbol.toStringTag,{value:"Module"})),is=Te(ns);ke.getStream=function(e){const t=R;if(typeof t.Socket=="function")return new t.Socket;{const{CloudflareSocket:r}=is;return new r(e)}};ke.getSecureStream=function(e){var t=R;return t.connect?t.connect(e):(e.socket.startTls(e),e.socket)};var as=R.EventEmitter;const{parse:os,serialize:k}=Ae,{getStream:us,getSecureStream:hs}=ke,cs=k.flush(),ls=k.sync(),fs=k.end();let ds=class extends as{constructor(e){super(),e=e||{},this.stream=e.stream||us(e.ssl),typeof this.stream=="function"&&(this.stream=this.stream(e)),this._keepAlive=e.keepAlive,this._keepAliveInitialDelayMillis=e.keepAliveInitialDelayMillis,this.lastBuffer=!1,this.parsedStatements={},this.ssl=e.ssl||!1,this._ending=!1,this._emitMessage=!1;var t=this;this.on("newListener",function(r){r==="message"&&(t._emitMessage=!0)})}connect(e,t){var r=this;this._connecting=!0,this.stream.setNoDelay(!0),this.stream.connect(e,t),this.stream.once("connect",function(){r._keepAlive&&r.stream.setKeepAlive(!0,r._keepAliveInitialDelayMillis),r.emit("connect")});const n=function(i){r._ending&&(i.code==="ECONNRESET"||i.code==="EPIPE")||r.emit("error",i)};if(this.stream.on("error",n),this.stream.on("close",function(){r.emit("end")}),!this.ssl)return this.attachListeners(this.stream);this.stream.once("data",function(i){var o=i.toString("utf8");switch(o){case"S":break;case"N":return r.stream.end(),r.emit("error",new Error("The server does not support SSL connections"));default:return r.stream.end(),r.emit("error",new Error("There was an error establishing an SSL connection"))}const c={socket:r.stream};r.ssl!==!0&&(Object.assign(c,r.ssl),"key"in r.ssl&&(c.key=r.ssl.key));var h=R;h.isIP&&h.isIP(t)===0&&(c.servername=t);try{r.stream=hs(c)}catch(l){return r.emit("error",l)}r.attachListeners(r.stream),r.stream.on("error",n),r.emit("sslconnect")})}attachListeners(e){os(e,t=>{var r=t.name==="error"?"errorMessage":t.name;this._emitMessage&&this.emit("message",t),this.emit(r,t)})}requestSsl(){this.stream.write(k.requestSsl())}startup(e){this.stream.write(k.startup(e))}cancel(e,t){this._send(k.cancel(e,t))}password(e){this._send(k.password(e))}sendSASLInitialResponseMessage(e,t){this._send(k.sendSASLInitialResponseMessage(e,t))}sendSCRAMClientFinalMessage(e){this._send(k.sendSCRAMClientFinalMessage(e))}_send(e){return this.stream.writable?this.stream.write(e):!1}query(e){this._send(k.query(e))}parse(e){this._send(k.parse(e))}bind(e){this._send(k.bind(e))}execute(e){this._send(k.execute(e))}flush(){this.stream.writable&&this.stream.write(cs)}sync(){this._ending=!0,this._send(ls)}ref(){this.stream.ref()}unref(){this.stream.unref()}end(){if(this._ending=!0,!this._connecting||!this.stream.writable){this.stream.end();return}return this.stream.write(fs,()=>{this.stream.end()})}close(e){this._send(k.close(e))}describe(e){this._send(k.describe(e))}sendCopyFromChunk(e){this._send(k.copyData(e))}endCopyFrom(){this._send(k.copyDone())}sendCopyFail(e){this._send(k.copyFail(e))}};var St=ds,$={exports:{}},ye={exports:{}},ve={},G={exports:{}};/*! safe-buffer. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> */var Je;function ps(){return Je||(Je=1,function(s,e){var t=R,r=t.Buffer;function n(o,c){for(var h in o)c[h]=o[h]}r.from&&r.alloc&&r.allocUnsafe&&r.allocUnsafeSlow?s.exports=t:(n(t,e),e.Buffer=i);function i(o,c,h){return r(o,c,h)}i.prototype=Object.create(r.prototype),n(r,i),i.from=function(o,c,h){if(typeof o=="number")throw new TypeError("Argument must not be a number");return r(o,c,h)},i.alloc=function(o,c,h){if(typeof o!="number")throw new TypeError("Argument must be a number");var l=r(o);return c!==void 0?typeof h=="string"?l.fill(c,h):l.fill(c):l.fill(0),l},i.allocUnsafe=function(o){if(typeof o!="number")throw new TypeError("Argument must be a number");return r(o)},i.allocUnsafeSlow=function(o){if(typeof o!="number")throw new TypeError("Argument must be a number");return t.SlowBuffer(o)}}(G,G.exports)),G.exports}var Xe;function ms(){if(Xe)return ve;Xe=1;var s=ps().Buffer,e=s.isEncoding||function(u){switch(u=""+u,u&&u.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}};function t(u){if(!u)return"utf8";for(var y;;)switch(u){case"utf8":case"utf-8":return"utf8";case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return"utf16le";case"latin1":case"binary":return"latin1";case"base64":case"ascii":case"hex":return u;default:if(y)return;u=(""+u).toLowerCase(),y=!0}}function r(u){var y=t(u);if(typeof y!="string"&&(s.isEncoding===e||!e(u)))throw new Error("Unknown encoding: "+u);return y||u}ve.StringDecoder=n;function n(u){this.encoding=r(u);var y;switch(this.encoding){case"utf16le":this.text=d,this.end=p,y=4;break;case"utf8":this.fillLast=h,y=4;break;case"base64":this.text=m,this.end=v,y=3;break;default:this.write=_,this.end=g;return}this.lastNeed=0,this.lastTotal=0,this.lastChar=s.allocUnsafe(y)}n.prototype.write=function(u){if(u.length===0)return"";var y,S;if(this.lastNeed){if(y=this.fillLast(u),y===void 0)return"";S=this.lastNeed,this.lastNeed=0}else S=0;return S<u.length?y?y+this.text(u,S):this.text(u,S):y||""},n.prototype.end=a,n.prototype.text=l,n.prototype.fillLast=function(u){if(this.lastNeed<=u.length)return u.copy(this.lastChar,this.lastTotal-this.lastNeed,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);u.copy(this.lastChar,this.lastTotal-this.lastNeed,0,u.length),this.lastNeed-=u.length};function i(u){return u<=127?0:u>>5===6?2:u>>4===14?3:u>>3===30?4:u>>6===2?-1:-2}function o(u,y,S){var x=y.length-1;if(x<S)return 0;var w=i(y[x]);return w>=0?(w>0&&(u.lastNeed=w-1),w):--x<S||w===-2?0:(w=i(y[x]),w>=0?(w>0&&(u.lastNeed=w-2),w):--x<S||w===-2?0:(w=i(y[x]),w>=0?(w>0&&(w===2?w=0:u.lastNeed=w-3),w):0))}function c(u,y,S){if((y[0]&192)!==128)return u.lastNeed=0,"�";if(u.lastNeed>1&&y.length>1){if((y[1]&192)!==128)return u.lastNeed=1,"�";if(u.lastNeed>2&&y.length>2&&(y[2]&192)!==128)return u.lastNeed=2,"�"}}function h(u){var y=this.lastTotal-this.lastNeed,S=c(this,u);if(S!==void 0)return S;if(this.lastNeed<=u.length)return u.copy(this.lastChar,y,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);u.copy(this.lastChar,y,0,u.length),this.lastNeed-=u.length}function l(u,y){var S=o(this,u,y);if(!this.lastNeed)return u.toString("utf8",y);this.lastTotal=S;var x=u.length-(S-this.lastNeed);return u.copy(this.lastChar,0,x),u.toString("utf8",y,x)}function a(u){var y=u&&u.length?this.write(u):"";return this.lastNeed?y+"�":y}function d(u,y){if((u.length-y)%2===0){var S=u.toString("utf16le",y);if(S){var x=S.charCodeAt(S.length-1);if(x>=55296&&x<=56319)return this.lastNeed=2,this.lastTotal=4,this.lastChar[0]=u[u.length-2],this.lastChar[1]=u[u.length-1],S.slice(0,-1)}return S}return this.lastNeed=1,this.lastTotal=2,this.lastChar[0]=u[u.length-1],u.toString("utf16le",y,u.length-1)}function p(u){var y=u&&u.length?this.write(u):"";if(this.lastNeed){var S=this.lastTotal-this.lastNeed;return y+this.lastChar.toString("utf16le",0,S)}return y}function m(u,y){var S=(u.length-y)%3;return S===0?u.toString("base64",y):(this.lastNeed=3-S,this.lastTotal=3,S===1?this.lastChar[0]=u[u.length-1]:(this.lastChar[0]=u[u.length-2],this.lastChar[1]=u[u.length-1]),u.toString("base64",y,u.length-S))}function v(u){var y=u&&u.length?this.write(u):"";return this.lastNeed?y+this.lastChar.toString("base64",0,3-this.lastNeed):y}function _(u){return u.toString(this.encoding)}function g(u){return u&&u.length?this.write(u):""}return ve}var ge,et;function ys(){if(et)return ge;et=1;const{Transform:s}=R,{StringDecoder:e}=ms(),t=Symbol("last"),r=Symbol("decoder");function n(l,a,d){let p;if(this.overflow){if(p=this[r].write(l).split(this.matcher),p.length===1)return d();p.shift(),this.overflow=!1}else this[t]+=this[r].write(l),p=this[t].split(this.matcher);this[t]=p.pop();for(let m=0;m<p.length;m++)try{o(this,this.mapper(p[m]))}catch(v){return d(v)}if(this.overflow=this[t].length>this.maxLength,this.overflow&&!this.skipOverflow){d(new Error("maximum buffer reached"));return}d()}function i(l){if(this[t]+=this[r].end(),this[t])try{o(this,this.mapper(this[t]))}catch(a){return l(a)}l()}function o(l,a){a!==void 0&&l.push(a)}function c(l){return l}function h(l,a,d){switch(l=l||/\r?\n/,a=a||c,d=d||{},arguments.length){case 1:typeof l=="function"?(a=l,l=/\r?\n/):typeof l=="object"&&!(l instanceof RegExp)&&!l[Symbol.split]&&(d=l,l=/\r?\n/);break;case 2:typeof l=="function"?(d=a,a=l,l=/\r?\n/):typeof a=="object"&&(d=a,a=c)}d=Object.assign({},d),d.autoDestroy=!0,d.transform=n,d.flush=i,d.readableObjectMode=!0;const p=new s(d);return p[t]="",p[r]=new e("utf8"),p.matcher=l,p.mapper=a,p.maxLength=d.maxLength,p.skipOverflow=d.skipOverflow||!1,p.overflow=!1,p._destroy=function(m,v){this._writableState.errorEmitted=!1,v(m)},p}return ge=h,ge}var tt;function vs(){return tt||(tt=1,function(s){var e={},t=R,r=R.Stream,n=ys(),i=R,o=5432,c=process.platform==="win32",h=process.stderr,l=56,a=7,d=61440,p=32768;function m(w){return(w&d)==p}var v=["host","port","database","user","password"],_=v.length,g=v[_-1];function u(){var w=h instanceof r&&h.writable===!0;if(w){var E=Array.prototype.slice.call(arguments).concat(`
`);h.write(i.format.apply(i,E))}}Object.defineProperty(s.exports,"isWin",{get:function(){return c},set:function(w){c=w}}),s.exports.warnTo=function(w){var E=h;return h=w,E},s.exports.getFileName=function(w){var E=w||e,f=E.PGPASSFILE||(c?t.join(E.APPDATA||"./","postgresql","pgpass.conf"):t.join(E.HOME||"./",".pgpass"));return f},s.exports.usePgPass=function(w,E){return Object.prototype.hasOwnProperty.call(e,"PGPASSWORD")?!1:c?!0:(E=E||"<unkn>",m(w.mode)?w.mode&(l|a)?(u('WARNING: password file "%s" has group or world access; permissions should be u=rw (0600) or less',E),!1):!0:(u('WARNING: password file "%s" is not a plain file',E),!1))};var y=s.exports.match=function(w,E){return v.slice(0,-1).reduce(function(f,b,C){return C==1&&Number(w[b]||o)===Number(E[b])?f&&!0:f&&(E[b]==="*"||E[b]===w[b])},!0)};s.exports.getPassword=function(w,E,f){var b,C=E.pipe(n());function I(O){var N=S(O);N&&x(N)&&y(w,N)&&(b=N[g],C.end())}var T=function(){E.destroy(),f(b)},q=function(O){E.destroy(),u("WARNING: error on reading file: %s",O),f(void 0)};E.on("error",q),C.on("data",I).on("end",T).on("error",q)};var S=s.exports.parseLine=function(w){if(w.length<11||w.match(/^\s+#/))return null;for(var E="",f="",b=0,C=0,I={},T=!1,q=function(N,Pt,xt){var re=w.substring(Pt,xt);Object.hasOwnProperty.call(e,"PGPASS_NO_DEESCAPE")||(re=re.replace(/\\([:\\])/g,"$1")),I[v[N]]=re},O=0;O<w.length-1;O+=1){if(E=w.charAt(O+1),f=w.charAt(O),T=b==_-1,T){q(b,C);break}O>=0&&E==":"&&f!=="\\"&&(q(b,C,O+1),C=O+2,b+=1)}return I=Object.keys(I).length===_?I:null,I},x=s.exports.isValidEntry=function(w){for(var E={0:function(T){return T.length>0},1:function(T){return T==="*"?!0:(T=Number(T),isFinite(T)&&T>0&&T<9007199254740992&&Math.floor(T)===T)},2:function(T){return T.length>0},3:function(T){return T.length>0},4:function(T){return T.length>0}},f=0;f<v.length;f+=1){var b=E[f],C=w[v[f]]||"",I=b(C);if(!I)return!1}return!0}}(ye)),ye.exports}var rt;function gs(){if(rt)return $.exports;rt=1;var s=R,e=vs();return $.exports=function(t,r){var n=e.getFileName();s.stat(n,function(i,o){if(i||!e.usePgPass(o,n))return r(void 0);var c=s.createReadStream(n);e.getPassword(t,c,r)})},$.exports.warnTo=e.warnTo,$.exports}var _s=R.EventEmitter,st=V,_e=rr,ws=vt,Ss=_t,Et=dr,Es=K,bs=St;const Cs=pt;class bt extends _s{constructor(e){super(),this.connectionParameters=new Ss(e),this.user=this.connectionParameters.user,this.database=this.connectionParameters.database,this.port=this.connectionParameters.port,this.host=this.connectionParameters.host,Object.defineProperty(this,"password",{configurable:!0,enumerable:!1,writable:!0,value:this.connectionParameters.password}),this.replication=this.connectionParameters.replication;var t=e||{};this._Promise=t.Promise||Me.Promise,this._types=new ws(t.types),this._ending=!1,this._ended=!1,this._connecting=!1,this._connected=!1,this._connectionError=!1,this._queryable=!0,this.connection=t.connection||new bs({stream:t.stream,ssl:this.connectionParameters.ssl,keepAlive:t.keepAlive||!1,keepAliveInitialDelayMillis:t.keepAliveInitialDelayMillis||0,encoding:this.connectionParameters.client_encoding||"utf8"}),this.queryQueue=[],this.binary=t.binary||Es.binary,this.processID=null,this.secretKey=null,this.ssl=this.connectionParameters.ssl||!1,this.ssl&&this.ssl.key&&Object.defineProperty(this.ssl,"key",{enumerable:!1}),this._connectionTimeoutMillis=t.connectionTimeoutMillis||0}_errorAllQueries(e){const t=r=>{process.nextTick(()=>{r.handleError(e,this.connection)})};this.activeQuery&&(t(this.activeQuery),this.activeQuery=null),this.queryQueue.forEach(t),this.queryQueue.length=0}_connect(e){var t=this,r=this.connection;if(this._connectionCallback=e,this._connecting||this._connected){const n=new Error("Client has already been connected. You cannot reuse a client.");process.nextTick(()=>{e(n)});return}this._connecting=!0,this.connectionTimeoutHandle,this._connectionTimeoutMillis>0&&(this.connectionTimeoutHandle=setTimeout(()=>{r._ending=!0,r.stream.destroy(new Error("timeout expired"))},this._connectionTimeoutMillis)),this.host&&this.host.indexOf("/")===0?r.connect(this.host+"/.s.PGSQL."+this.port):r.connect(this.port,this.host),r.on("connect",function(){t.ssl?r.requestSsl():r.startup(t.getStartupConf())}),r.on("sslconnect",function(){r.startup(t.getStartupConf())}),this._attachListeners(r),r.once("end",()=>{const n=this._ending?new Error("Connection terminated"):new Error("Connection terminated unexpectedly");clearTimeout(this.connectionTimeoutHandle),this._errorAllQueries(n),this._ended=!0,this._ending||(this._connecting&&!this._connectionError?this._connectionCallback?this._connectionCallback(n):this._handleErrorEvent(n):this._connectionError||this._handleErrorEvent(n)),process.nextTick(()=>{this.emit("end")})})}connect(e){if(e){this._connect(e);return}return new this._Promise((t,r)=>{this._connect(n=>{n?r(n):t()})})}_attachListeners(e){e.on("authenticationCleartextPassword",this._handleAuthCleartextPassword.bind(this)),e.on("authenticationMD5Password",this._handleAuthMD5Password.bind(this)),e.on("authenticationSASL",this._handleAuthSASL.bind(this)),e.on("authenticationSASLContinue",this._handleAuthSASLContinue.bind(this)),e.on("authenticationSASLFinal",this._handleAuthSASLFinal.bind(this)),e.on("backendKeyData",this._handleBackendKeyData.bind(this)),e.on("error",this._handleErrorEvent.bind(this)),e.on("errorMessage",this._handleErrorMessage.bind(this)),e.on("readyForQuery",this._handleReadyForQuery.bind(this)),e.on("notice",this._handleNotice.bind(this)),e.on("rowDescription",this._handleRowDescription.bind(this)),e.on("dataRow",this._handleDataRow.bind(this)),e.on("portalSuspended",this._handlePortalSuspended.bind(this)),e.on("emptyQuery",this._handleEmptyQuery.bind(this)),e.on("commandComplete",this._handleCommandComplete.bind(this)),e.on("parseComplete",this._handleParseComplete.bind(this)),e.on("copyInResponse",this._handleCopyInResponse.bind(this)),e.on("copyData",this._handleCopyData.bind(this)),e.on("notification",this._handleNotification.bind(this))}_checkPgPass(e){const t=this.connection;if(typeof this.password=="function")this._Promise.resolve().then(()=>this.password()).then(r=>{if(r!==void 0){if(typeof r!="string"){t.emit("error",new TypeError("Password must be a string"));return}this.connectionParameters.password=this.password=r}else this.connectionParameters.password=this.password=null;e()}).catch(r=>{t.emit("error",r)});else if(this.password!==null)e();else try{gs()(this.connectionParameters,n=>{n!==void 0&&(this.connectionParameters.password=this.password=n),e()})}catch(r){this.emit("error",r)}}_handleAuthCleartextPassword(e){this._checkPgPass(()=>{this.connection.password(this.password)})}_handleAuthMD5Password(e){this._checkPgPass(async()=>{try{const t=await Cs.postgresMd5PasswordHash(this.user,this.password,e.salt);this.connection.password(t)}catch(t){this.emit("error",t)}})}_handleAuthSASL(e){this._checkPgPass(()=>{try{this.saslSession=_e.startSession(e.mechanisms),this.connection.sendSASLInitialResponseMessage(this.saslSession.mechanism,this.saslSession.response)}catch(t){this.connection.emit("error",t)}})}async _handleAuthSASLContinue(e){try{await _e.continueSession(this.saslSession,this.password,e.data),this.connection.sendSCRAMClientFinalMessage(this.saslSession.response)}catch(t){this.connection.emit("error",t)}}_handleAuthSASLFinal(e){try{_e.finalizeSession(this.saslSession,e.data),this.saslSession=null}catch(t){this.connection.emit("error",t)}}_handleBackendKeyData(e){this.processID=e.processID,this.secretKey=e.secretKey}_handleReadyForQuery(e){this._connecting&&(this._connecting=!1,this._connected=!0,clearTimeout(this.connectionTimeoutHandle),this._connectionCallback&&(this._connectionCallback(null,this),this._connectionCallback=null),this.emit("connect"));const{activeQuery:t}=this;this.activeQuery=null,this.readyForQuery=!0,t&&t.handleReadyForQuery(this.connection),this._pulseQueryQueue()}_handleErrorWhileConnecting(e){if(!this._connectionError){if(this._connectionError=!0,clearTimeout(this.connectionTimeoutHandle),this._connectionCallback)return this._connectionCallback(e);this.emit("error",e)}}_handleErrorEvent(e){if(this._connecting)return this._handleErrorWhileConnecting(e);this._queryable=!1,this._errorAllQueries(e),this.emit("error",e)}_handleErrorMessage(e){if(this._connecting)return this._handleErrorWhileConnecting(e);const t=this.activeQuery;if(!t){this._handleErrorEvent(e);return}this.activeQuery=null,t.handleError(e,this.connection)}_handleRowDescription(e){this.activeQuery.handleRowDescription(e)}_handleDataRow(e){this.activeQuery.handleDataRow(e)}_handlePortalSuspended(e){this.activeQuery.handlePortalSuspended(this.connection)}_handleEmptyQuery(e){this.activeQuery.handleEmptyQuery(this.connection)}_handleCommandComplete(e){this.activeQuery.handleCommandComplete(e,this.connection)}_handleParseComplete(e){this.activeQuery.name&&(this.connection.parsedStatements[this.activeQuery.name]=this.activeQuery.text)}_handleCopyInResponse(e){this.activeQuery.handleCopyInResponse(this.connection)}_handleCopyData(e){this.activeQuery.handleCopyData(e,this.connection)}_handleNotification(e){this.emit("notification",e)}_handleNotice(e){this.emit("notice",e)}getStartupConf(){var e=this.connectionParameters,t={user:e.user,database:e.database},r=e.application_name||e.fallback_application_name;return r&&(t.application_name=r),e.replication&&(t.replication=""+e.replication),e.statement_timeout&&(t.statement_timeout=String(parseInt(e.statement_timeout,10))),e.lock_timeout&&(t.lock_timeout=String(parseInt(e.lock_timeout,10))),e.idle_in_transaction_session_timeout&&(t.idle_in_transaction_session_timeout=String(parseInt(e.idle_in_transaction_session_timeout,10))),e.options&&(t.options=e.options),t}cancel(e,t){if(e.activeQuery===t){var r=this.connection;this.host&&this.host.indexOf("/")===0?r.connect(this.host+"/.s.PGSQL."+this.port):r.connect(this.port,this.host),r.on("connect",function(){r.cancel(e.processID,e.secretKey)})}else e.queryQueue.indexOf(t)!==-1&&e.queryQueue.splice(e.queryQueue.indexOf(t),1)}setTypeParser(e,t,r){return this._types.setTypeParser(e,t,r)}getTypeParser(e,t){return this._types.getTypeParser(e,t)}escapeIdentifier(e){return st.escapeIdentifier(e)}escapeLiteral(e){return st.escapeLiteral(e)}_pulseQueryQueue(){if(this.readyForQuery===!0)if(this.activeQuery=this.queryQueue.shift(),this.activeQuery){this.readyForQuery=!1,this.hasExecuted=!0;const e=this.activeQuery.submit(this.connection);e&&process.nextTick(()=>{this.activeQuery.handleError(e,this.connection),this.readyForQuery=!0,this._pulseQueryQueue()})}else this.hasExecuted&&(this.activeQuery=null,this.emit("drain"))}query(e,t,r){var n,i,o,c,h;if(e==null)throw new TypeError("Client was passed a null or undefined query");return typeof e.submit=="function"?(o=e.query_timeout||this.connectionParameters.query_timeout,i=n=e,typeof t=="function"&&(n.callback=n.callback||t)):(o=this.connectionParameters.query_timeout,n=new Et(e,t,r),n.callback||(i=new this._Promise((l,a)=>{n.callback=(d,p)=>d?a(d):l(p)}).catch(l=>{throw Error.captureStackTrace(l),l}))),o&&(h=n.callback,c=setTimeout(()=>{var l=new Error("Query read timeout");process.nextTick(()=>{n.handleError(l,this.connection)}),h(l),n.callback=()=>{};var a=this.queryQueue.indexOf(n);a>-1&&this.queryQueue.splice(a,1),this._pulseQueryQueue()},o),n.callback=(l,a)=>{clearTimeout(c),h(l,a)}),this.binary&&!n.binary&&(n.binary=!0),n._result&&!n._result._types&&(n._result._types=this._types),this._queryable?this._ending?(process.nextTick(()=>{n.handleError(new Error("Client was closed and is not queryable"),this.connection)}),i):(this.queryQueue.push(n),this._pulseQueryQueue(),i):(process.nextTick(()=>{n.handleError(new Error("Client has encountered a connection error and is not queryable"),this.connection)}),i)}ref(){this.connection.ref()}unref(){this.connection.unref()}end(e){if(this._ending=!0,!this.connection._connecting||this._ended)if(e)e();else return this._Promise.resolve();if(this.activeQuery||!this._queryable?this.connection.stream.destroy():this.connection.end(),e)this.connection.once("end",e);else return new this._Promise(t=>{this.connection.once("end",t)})}}bt.Query=Et;var Ps=bt,we,nt;function xs(){if(nt)return we;nt=1;const s=R.EventEmitter,e=function(){},t=(l,a)=>{const d=l.findIndex(a);return d===-1?void 0:l.splice(d,1)[0]};class r{constructor(a,d,p){this.client=a,this.idleListener=d,this.timeoutId=p}}class n{constructor(a){this.callback=a}}function i(){throw new Error("Release called on client which has already been released to the pool.")}function o(l,a){if(a)return{callback:a,result:void 0};let d,p;const m=function(_,g){_?d(_):p(g)},v=new l(function(_,g){p=_,d=g}).catch(_=>{throw Error.captureStackTrace(_),_});return{callback:m,result:v}}function c(l,a){return function d(p){p.client=a,a.removeListener("error",d),a.on("error",()=>{l.log("additional client error after disconnection due to error",p)}),l._remove(a),l.emit("error",p,a)}}class h extends s{constructor(a,d){super(),this.options=Object.assign({},a),a!=null&&"password"in a&&Object.defineProperty(this.options,"password",{configurable:!0,enumerable:!1,writable:!0,value:a.password}),a!=null&&a.ssl&&a.ssl.key&&Object.defineProperty(this.options.ssl,"key",{enumerable:!1}),this.options.max=this.options.max||this.options.poolSize||10,this.options.maxUses=this.options.maxUses||1/0,this.options.allowExitOnIdle=this.options.allowExitOnIdle||!1,this.options.maxLifetimeSeconds=this.options.maxLifetimeSeconds||0,this.log=this.options.log||function(){},this.Client=this.options.Client||d||Ct().Client,this.Promise=this.options.Promise||Me.Promise,typeof this.options.idleTimeoutMillis>"u"&&(this.options.idleTimeoutMillis=1e4),this._clients=[],this._idle=[],this._expired=new WeakSet,this._pendingQueue=[],this._endCallback=void 0,this.ending=!1,this.ended=!1}_isFull(){return this._clients.length>=this.options.max}_pulseQueue(){if(this.log("pulse queue"),this.ended){this.log("pulse queue ended");return}if(this.ending){this.log("pulse queue on ending"),this._idle.length&&this._idle.slice().map(d=>{this._remove(d.client)}),this._clients.length||(this.ended=!0,this._endCallback());return}if(!this._pendingQueue.length){this.log("no queued requests");return}if(!this._idle.length&&this._isFull())return;const a=this._pendingQueue.shift();if(this._idle.length){const d=this._idle.pop();clearTimeout(d.timeoutId);const p=d.client;p.ref&&p.ref();const m=d.idleListener;return this._acquireClient(p,a,m,!1)}if(!this._isFull())return this.newClient(a);throw new Error("unexpected condition")}_remove(a){const d=t(this._idle,p=>p.client===a);d!==void 0&&clearTimeout(d.timeoutId),this._clients=this._clients.filter(p=>p!==a),a.end(),this.emit("remove",a)}connect(a){if(this.ending){const m=new Error("Cannot use a pool after calling end on the pool");return a?a(m):this.Promise.reject(m)}const d=o(this.Promise,a),p=d.result;if(this._isFull()||this._idle.length){if(this._idle.length&&process.nextTick(()=>this._pulseQueue()),!this.options.connectionTimeoutMillis)return this._pendingQueue.push(new n(d.callback)),p;const m=(g,u,y)=>{clearTimeout(_),d.callback(g,u,y)},v=new n(m),_=setTimeout(()=>{t(this._pendingQueue,g=>g.callback===m),v.timedOut=!0,d.callback(new Error("timeout exceeded when trying to connect"))},this.options.connectionTimeoutMillis);return this._pendingQueue.push(v),p}return this.newClient(new n(d.callback)),p}newClient(a){const d=new this.Client(this.options);this._clients.push(d);const p=c(this,d);this.log("checking client timeout");let m,v=!1;this.options.connectionTimeoutMillis&&(m=setTimeout(()=>{this.log("ending client due to timeout"),v=!0,d.connection?d.connection.stream.destroy():d.end()},this.options.connectionTimeoutMillis)),this.log("connecting new client"),d.connect(_=>{if(m&&clearTimeout(m),d.on("error",p),_)this.log("client failed to connect",_),this._clients=this._clients.filter(g=>g!==d),v&&(_.message="Connection terminated due to connection timeout"),this._pulseQueue(),a.timedOut||a.callback(_,void 0,e);else{if(this.log("new client connected"),this.options.maxLifetimeSeconds!==0){const g=setTimeout(()=>{this.log("ending client due to expired lifetime"),this._expired.add(d),this._idle.findIndex(y=>y.client===d)!==-1&&this._acquireClient(d,new n((y,S,x)=>x()),p,!1)},this.options.maxLifetimeSeconds*1e3);g.unref(),d.once("end",()=>clearTimeout(g))}return this._acquireClient(d,a,p,!0)}})}_acquireClient(a,d,p,m){m&&this.emit("connect",a),this.emit("acquire",a),a.release=this._releaseOnce(a,p),a.removeListener("error",p),d.timedOut?m&&this.options.verify?this.options.verify(a,a.release):a.release():m&&this.options.verify?this.options.verify(a,v=>{if(v)return a.release(v),d.callback(v,void 0,e);d.callback(void 0,a,a.release)}):d.callback(void 0,a,a.release)}_releaseOnce(a,d){let p=!1;return m=>{p&&i(),p=!0,this._release(a,d,m)}}_release(a,d,p){if(a.on("error",d),a._poolUseCount=(a._poolUseCount||0)+1,this.emit("release",p,a),p||this.ending||!a._queryable||a._ending||a._poolUseCount>=this.options.maxUses){a._poolUseCount>=this.options.maxUses&&this.log("remove expended client"),this._remove(a),this._pulseQueue();return}if(this._expired.has(a)){this.log("remove expired client"),this._expired.delete(a),this._remove(a),this._pulseQueue();return}let v;this.options.idleTimeoutMillis&&(v=setTimeout(()=>{this.log("remove idle client"),this._remove(a)},this.options.idleTimeoutMillis),this.options.allowExitOnIdle&&v.unref()),this.options.allowExitOnIdle&&a.unref(),this._idle.push(new r(a,d,v)),this._pulseQueue()}query(a,d,p){if(typeof a=="function"){const v=o(this.Promise,a);return setImmediate(function(){return v.callback(new Error("Passing a function as the first parameter to pool.query is not supported"))}),v.result}typeof d=="function"&&(p=d,d=void 0);const m=o(this.Promise,p);return p=m.callback,this.connect((v,_)=>{if(v)return p(v);let g=!1;const u=y=>{g||(g=!0,_.release(y),p(y))};_.once("error",u),this.log("dispatching query");try{_.query(a,d,(y,S)=>{if(this.log("query dispatched"),_.removeListener("error",u),!g)return g=!0,_.release(y),y?p(y):p(void 0,S)})}catch(y){return _.release(y),p(y)}}),m.result}end(a){if(this.log("ending"),this.ending){const p=new Error("Called end on pool more than once");return a?a(p):this.Promise.reject(p)}this.ending=!0;const d=o(this.Promise,a);return this._endCallback=d.callback,this._pulseQueue(),d.result}get waitingCount(){return this._pendingQueue.length}get idleCount(){return this._idle.length}get expiredCount(){return this._clients.reduce((a,d)=>a+(this._expired.has(d)?1:0),0)}get totalCount(){return this._clients.length}}return we=h,we}var Se={exports:{}};const Ts={},Ms=Object.freeze(Object.defineProperty({__proto__:null,default:Ts},Symbol.toStringTag,{value:"Module"})),As=Te(Ms);var Ee={exports:{}},it;function Rs(){if(it)return Ee.exports;it=1;var s=R.EventEmitter,e=R,t=V,r=Ee.exports=function(i,o,c){s.call(this),i=t.normalizeQueryConfig(i,o,c),this.text=i.text,this.values=i.values,this.name=i.name,this.queryMode=i.queryMode,this.callback=i.callback,this.state="new",this._arrayMode=i.rowMode==="array",this._emitRowEvents=!1,this.on("newListener",function(h){h==="row"&&(this._emitRowEvents=!0)}.bind(this))};e.inherits(r,s);var n={sqlState:"code",statementPosition:"position",messagePrimary:"message",context:"where",schemaName:"schema",tableName:"table",columnName:"column",dataTypeName:"dataType",constraintName:"constraint",sourceFile:"file",sourceLine:"line",sourceFunction:"routine"};return r.prototype.handleError=function(i){var o=this.native.pq.resultErrorFields();if(o)for(var c in o){var h=n[c]||c;i[h]=o[c]}this.callback?this.callback(i):this.emit("error",i),this.state="error"},r.prototype.then=function(i,o){return this._getPromise().then(i,o)},r.prototype.catch=function(i){return this._getPromise().catch(i)},r.prototype._getPromise=function(){return this._promise?this._promise:(this._promise=new Promise(function(i,o){this._once("end",i),this._once("error",o)}.bind(this)),this._promise)},r.prototype.submit=function(i){this.state="running";var o=this;this.native=i.native,i.native.arrayMode=this._arrayMode;var c=function(a,d,p){if(i.native.arrayMode=!1,setImmediate(function(){o.emit("_done")}),a)return o.handleError(a);o._emitRowEvents&&(p.length>1?d.forEach((m,v)=>{m.forEach(_=>{o.emit("row",_,p[v])})}):d.forEach(function(m){o.emit("row",m,p)})),o.state="end",o.emit("end",p),o.callback&&o.callback(null,p)};if(process.domain&&(c=process.domain.bind(c)),this.name){this.name.length>63&&(console.error("Warning! Postgres only supports 63 characters for query names."),console.error("You supplied %s (%s)",this.name,this.name.length),console.error("This can cause conflicts and silent errors executing queries"));var h=(this.values||[]).map(t.prepareValue);if(i.namedQueries[this.name]){if(this.text&&i.namedQueries[this.name]!==this.text){const a=new Error(`Prepared statements must be unique - '${this.name}' was used for a different statement`);return c(a)}return i.native.execute(this.name,h,c)}return i.native.prepare(this.name,this.text,h.length,function(a){return a?c(a):(i.namedQueries[o.name]=o.text,o.native.execute(o.name,h,c))})}else if(this.values){if(!Array.isArray(this.values)){const a=new Error("Query values must be an array");return c(a)}var l=this.values.map(t.prepareValue);i.native.query(this.text,l,c)}else this.queryMode==="extended"?i.native.query(this.text,[],c):i.native.query(this.text,c)},Ee.exports}var at;function Is(){if(at)return Se.exports;at=1;var s;try{s=As}catch(c){throw c}var e=vt,t=R.EventEmitter,r=R,n=_t,i=Rs(),o=Se.exports=function(c){t.call(this),c=c||{},this._Promise=c.Promise||Me.Promise,this._types=new e(c.types),this.native=new s({types:this._types}),this._queryQueue=[],this._ending=!1,this._connecting=!1,this._connected=!1,this._queryable=!0;var h=this.connectionParameters=new n(c);c.nativeConnectionString&&(h.nativeConnectionString=c.nativeConnectionString),this.user=h.user,Object.defineProperty(this,"password",{configurable:!0,enumerable:!1,writable:!0,value:h.password}),this.database=h.database,this.host=h.host,this.port=h.port,this.namedQueries={}};return o.Query=i,r.inherits(o,t),o.prototype._errorAllQueries=function(c){const h=l=>{process.nextTick(()=>{l.native=this.native,l.handleError(c)})};this._hasActiveQuery()&&(h(this._activeQuery),this._activeQuery=null),this._queryQueue.forEach(h),this._queryQueue.length=0},o.prototype._connect=function(c){var h=this;if(this._connecting){process.nextTick(()=>c(new Error("Client has already been connected. You cannot reuse a client.")));return}this._connecting=!0,this.connectionParameters.getLibpqConnectionString(function(l,a){if(h.connectionParameters.nativeConnectionString&&(a=h.connectionParameters.nativeConnectionString),l)return c(l);h.native.connect(a,function(d){if(d)return h.native.end(),c(d);h._connected=!0,h.native.on("error",function(p){h._queryable=!1,h._errorAllQueries(p),h.emit("error",p)}),h.native.on("notification",function(p){h.emit("notification",{channel:p.relname,payload:p.extra})}),h.emit("connect"),h._pulseQueryQueue(!0),c()})})},o.prototype.connect=function(c){if(c){this._connect(c);return}return new this._Promise((h,l)=>{this._connect(a=>{a?l(a):h()})})},o.prototype.query=function(c,h,l){var a,d,p,m,v;if(c==null)throw new TypeError("Client was passed a null or undefined query");if(typeof c.submit=="function")p=c.query_timeout||this.connectionParameters.query_timeout,d=a=c,typeof h=="function"&&(c.callback=h);else if(p=this.connectionParameters.query_timeout,a=new i(c,h,l),!a.callback){let _,g;d=new this._Promise((u,y)=>{_=u,g=y}).catch(u=>{throw Error.captureStackTrace(u),u}),a.callback=(u,y)=>u?g(u):_(y)}return p&&(v=a.callback,m=setTimeout(()=>{var _=new Error("Query read timeout");process.nextTick(()=>{a.handleError(_,this.connection)}),v(_),a.callback=()=>{};var g=this._queryQueue.indexOf(a);g>-1&&this._queryQueue.splice(g,1),this._pulseQueryQueue()},p),a.callback=(_,g)=>{clearTimeout(m),v(_,g)}),this._queryable?this._ending?(a.native=this.native,process.nextTick(()=>{a.handleError(new Error("Client was closed and is not queryable"))}),d):(this._queryQueue.push(a),this._pulseQueryQueue(),d):(a.native=this.native,process.nextTick(()=>{a.handleError(new Error("Client has encountered a connection error and is not queryable"))}),d)},o.prototype.end=function(c){var h=this;this._ending=!0,this._connected||this.once("connect",this.end.bind(this,c));var l;return c||(l=new this._Promise(function(a,d){c=p=>p?d(p):a()})),this.native.end(function(){h._errorAllQueries(new Error("Connection terminated")),process.nextTick(()=>{h.emit("end"),c&&c()})}),l},o.prototype._hasActiveQuery=function(){return this._activeQuery&&this._activeQuery.state!=="error"&&this._activeQuery.state!=="end"},o.prototype._pulseQueryQueue=function(c){if(this._connected&&!this._hasActiveQuery()){var h=this._queryQueue.shift();if(!h){c||this.emit("drain");return}this._activeQuery=h,h.submit(this);var l=this;h.once("_done",function(){l._pulseQueryQueue()})}},o.prototype.cancel=function(c){this._activeQuery===c?this.native.cancel(function(){}):this._queryQueue.indexOf(c)!==-1&&this._queryQueue.splice(this._queryQueue.indexOf(c),1)},o.prototype.ref=function(){},o.prototype.unref=function(){},o.prototype.setTypeParser=function(c,h,l){return this._types.setTypeParser(c,h,l)},o.prototype.getTypeParser=function(c,h){return this._types.getTypeParser(c,h)},Se.exports}var be,ot;function ut(){return ot||(ot=1,be=Is()),be}var ht;function Ct(){return ht||(ht=1,function(s){var e={},t=Ps,r=K,n=St,i=xs();const{DatabaseError:o}=Ae,{escapeIdentifier:c,escapeLiteral:h}=V,l=d=>class extends i{constructor(m){super(m,d)}};var a=function(d){this.defaults=r,this.Client=d,this.Query=this.Client.Query,this.Pool=l(this.Client),this._pools=[],this.Connection=n,this.types=z(),this.DatabaseError=o,this.escapeIdentifier=c,this.escapeLiteral=h};typeof e.NODE_PG_FORCE_NATIVE<"u"?s.exports=new a(ut()):(s.exports=new a(t),Object.defineProperty(s.exports,"native",{configurable:!0,enumerable:!1,get(){var d=null;try{d=new a(ut())}catch(p){if(p.code!=="MODULE_NOT_FOUND")throw p}return Object.defineProperty(s.exports,"native",{value:d}),d}}))}(se)),se.exports}var ks=Ct();const Ns=Tt({__proto__:null},[ks]);export{Ns as i};
