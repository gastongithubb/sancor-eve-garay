import{g as xr,B as Ne,X as ps,Y as ms,f as Rr,j as I,R as Cr,T as Tr,L as Ir}from"./generateCategoricalChart.BeRvqKRj.js";import{r as Te}from"./index.DJO9vBfz.js";class q extends Error{code;rawCode;constructor(e,s,r,n){s!==void 0&&(e=`${s}: ${e}`),super(e,{cause:n}),this.code=s,this.rawCode=r,this.name="LibsqlError"}}function Nr(t){const e=Ar.exec(t);if(e===null)throw new q("The URL is not in a valid format","URL_INVALID");const s=e.groups,r=s.scheme,n=s.authority!==void 0?Lr(s.authority):void 0,i=ie(s.path),o=s.query!==void 0?Er(s.query):void 0,a=s.fragment!==void 0?ie(s.fragment):void 0;return{scheme:r,authority:n,path:i,query:o,fragment:a}}const Ar=(()=>{const t="(?<scheme>[A-Za-z][A-Za-z.+-]*)",e="(?<authority>[^/?#]*)",s="(?<path>[^?#]*)",r="(?<query>[^#]*)",n="(?<fragment>.*)";return new RegExp(`^${t}:(//${e})?${s}(\\?${r})?(#${n})?$`,"su")})();function Lr(t){const e=$r.exec(t);if(e===null)throw new q("The authority part of the URL is not in a valid format","URL_INVALID");const s=e.groups,r=ie(s.host_br??s.host),n=s.port?parseInt(s.port,10):void 0,i=s.username!==void 0?{username:ie(s.username),password:s.password!==void 0?ie(s.password):void 0}:void 0;return{host:r,port:n,userinfo:i}}const $r=new RegExp("^((?<username>[^:]*)(:(?<password>.*))?@)?((?<host>[^:\\[\\]]*)|(\\[(?<host_br>[^\\[\\]]*)\\]))(:(?<port>[0-9]*))?$","su");function Er(t){const e=t.split("&"),s=[];for(const r of e){if(r==="")continue;let n,i;const o=r.indexOf("=");o<0?(n=r,i=""):(n=r.substring(0,o),i=r.substring(o+1)),s.push({key:ie(n.replaceAll("+"," ")),value:ie(i.replaceAll("+"," "))})}return{pairs:s}}function ie(t){try{return decodeURIComponent(t)}catch(e){throw e instanceof URIError?new q(`URL component has invalid percent encoding: ${e}`,"URL_INVALID",void 0,e):e}}function ht(t,e,s){if(e===void 0)throw new q(`URL with scheme ${JSON.stringify(t+":")} requires authority (the "//" part)`,"URL_INVALID");const r=`${t}:`,n=vr(e.host),i=Or(e.port),a=`//${Qr(e.userinfo)}${n}${i}`;let l=s.split("/").map(encodeURIComponent).join("/");return l!==""&&!l.startsWith("/")&&(l="/"+l),new URL(`${r}${a}${l}`)}function vr(t){return t.includes(":")?`[${encodeURI(t)}]`:encodeURI(t)}function Or(t){return t!==void 0?`:${t}`:""}function Qr(t){if(t===void 0)return"";const e=encodeURIComponent(t.username),s=t.password!==void 0?`:${encodeURIComponent(t.password)}`:"";return`${e}${s}@`}const ys="3.7.7",Br=ys,qe=typeof Buffer=="function",Wt=typeof TextDecoder=="function"?new TextDecoder:void 0,Gt=typeof TextEncoder=="function"?new TextEncoder:void 0,Pr="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",Ae=Array.prototype.slice.call(Pr),ke=(t=>{let e={};return t.forEach((s,r)=>e[s]=r),e})(Ae),Ur=/^(?:[A-Za-z\d+\/]{4})*?(?:[A-Za-z\d+\/]{2}(?:==)?|[A-Za-z\d+\/]{3}=?)?$/,B=String.fromCharCode.bind(String),Yt=typeof Uint8Array.from=="function"?Uint8Array.from.bind(Uint8Array):t=>new Uint8Array(Array.prototype.slice.call(t,0)),bs=t=>t.replace(/=/g,"").replace(/[+\/]/g,e=>e=="+"?"-":"_"),ws=t=>t.replace(/[^A-Za-z0-9\+\/]/g,""),gs=t=>{let e,s,r,n,i="";const o=t.length%3;for(let a=0;a<t.length;){if((s=t.charCodeAt(a++))>255||(r=t.charCodeAt(a++))>255||(n=t.charCodeAt(a++))>255)throw new TypeError("invalid character found");e=s<<16|r<<8|n,i+=Ae[e>>18&63]+Ae[e>>12&63]+Ae[e>>6&63]+Ae[e&63]}return o?i.slice(0,o-3)+"===".substring(o):i},It=typeof btoa=="function"?t=>btoa(t):qe?t=>Buffer.from(t,"binary").toString("base64"):gs,dt=qe?t=>Buffer.from(t).toString("base64"):t=>{let s=[];for(let r=0,n=t.length;r<n;r+=4096)s.push(B.apply(null,t.subarray(r,r+4096)));return It(s.join(""))},Ve=(t,e=!1)=>e?bs(dt(t)):dt(t),jr=t=>{if(t.length<2){var e=t.charCodeAt(0);return e<128?t:e<2048?B(192|e>>>6)+B(128|e&63):B(224|e>>>12&15)+B(128|e>>>6&63)+B(128|e&63)}else{var e=65536+(t.charCodeAt(0)-55296)*1024+(t.charCodeAt(1)-56320);return B(240|e>>>18&7)+B(128|e>>>12&63)+B(128|e>>>6&63)+B(128|e&63)}},kr=/[\uD800-\uDBFF][\uDC00-\uDFFFF]|[^\x00-\x7F]/g,Ss=t=>t.replace(kr,jr),Zt=qe?t=>Buffer.from(t,"utf8").toString("base64"):Gt?t=>dt(Gt.encode(t)):t=>It(Ss(t)),me=(t,e=!1)=>e?bs(Zt(t)):Zt(t),Xt=t=>me(t,!0),Dr=/[\xC0-\xDF][\x80-\xBF]|[\xE0-\xEF][\x80-\xBF]{2}|[\xF0-\xF7][\x80-\xBF]{3}/g,Mr=t=>{switch(t.length){case 4:var e=(7&t.charCodeAt(0))<<18|(63&t.charCodeAt(1))<<12|(63&t.charCodeAt(2))<<6|63&t.charCodeAt(3),s=e-65536;return B((s>>>10)+55296)+B((s&1023)+56320);case 3:return B((15&t.charCodeAt(0))<<12|(63&t.charCodeAt(1))<<6|63&t.charCodeAt(2));default:return B((31&t.charCodeAt(0))<<6|63&t.charCodeAt(1))}},qs=t=>t.replace(Dr,Mr),_s=t=>{if(t=t.replace(/\s+/g,""),!Ur.test(t))throw new TypeError("malformed base64.");t+="==".slice(2-(t.length&3));let e,s="",r,n;for(let i=0;i<t.length;)e=ke[t.charAt(i++)]<<18|ke[t.charAt(i++)]<<12|(r=ke[t.charAt(i++)])<<6|(n=ke[t.charAt(i++)]),s+=r===64?B(e>>16&255):n===64?B(e>>16&255,e>>8&255):B(e>>16&255,e>>8&255,e&255);return s},Nt=typeof atob=="function"?t=>atob(ws(t)):qe?t=>Buffer.from(t,"base64").toString("binary"):_s,xs=qe?t=>Yt(Buffer.from(t,"base64")):t=>Yt(Nt(t).split("").map(e=>e.charCodeAt(0))),Rs=t=>xs(Cs(t)),Fr=qe?t=>Buffer.from(t,"base64").toString("utf8"):Wt?t=>Wt.decode(xs(t)):t=>qs(Nt(t)),Cs=t=>ws(t.replace(/[-_]/g,e=>e=="-"?"+":"/")),ft=t=>Fr(Cs(t)),Vr=t=>{if(typeof t!="string")return!1;const e=t.replace(/\s+/g,"").replace(/={0,2}$/,"");return!/[^\s0-9a-zA-Z\+/]/.test(e)||!/[^\s0-9a-zA-Z\-_]/.test(e)},Ts=t=>({value:t,enumerable:!1,writable:!0,configurable:!0}),Is=function(){const t=(e,s)=>Object.defineProperty(String.prototype,e,Ts(s));t("fromBase64",function(){return ft(this)}),t("toBase64",function(e){return me(this,e)}),t("toBase64URI",function(){return me(this,!0)}),t("toBase64URL",function(){return me(this,!0)}),t("toUint8Array",function(){return Rs(this)})},Ns=function(){const t=(e,s)=>Object.defineProperty(Uint8Array.prototype,e,Ts(s));t("toBase64",function(e){return Ve(this,e)}),t("toBase64URI",function(){return Ve(this,!0)}),t("toBase64URL",function(){return Ve(this,!0)})},zr=()=>{Is(),Ns()},At={version:ys,VERSION:Br,atob:Nt,atobPolyfill:_s,btoa:It,btoaPolyfill:gs,fromBase64:ft,toBase64:me,encode:me,encodeURI:Xt,encodeURL:Xt,utob:Ss,btou:qs,decode:ft,isValid:Vr,fromUint8Array:Ve,toUint8Array:Rs,extendString:Is,extendUint8Array:Ns,extendBuiltins:zr},ve="https://github.com/libsql/libsql-client-ts#supported-urls";function pt(t){if(t==="write")return"BEGIN IMMEDIATE";if(t==="read")return"BEGIN TRANSACTION READONLY";if(t==="deferred")return"BEGIN DEFERRED";throw RangeError('Unknown transaction mode, supported values are "write", "read" and "deferred"')}class Kr{columns;columnTypes;rows;rowsAffected;lastInsertRowid;constructor(e,s,r,n,i){this.columns=e,this.columnTypes=s,this.rows=r,this.rowsAffected=n,this.lastInsertRowid=i}toJSON(){return{columns:this.columns,columnTypes:this.columnTypes,rows:this.rows.map(Jr),rowsAffected:this.rowsAffected,lastInsertRowid:this.lastInsertRowid!==void 0?""+this.lastInsertRowid:null}}}function Jr(t){return Array.prototype.map.call(t,Hr)}function Hr(t){return typeof t=="bigint"?""+t:t instanceof ArrayBuffer?At.fromUint8Array(new Uint8Array(t)):t}function Wr(t,e){if(typeof t!="object")throw new TypeError(`Expected client configuration as object, got ${typeof t}`);let s=t.tls,r=t.authToken,n=t.encryptionKey,i=t.syncUrl,o=t.syncInterval;const a=""+(t.intMode??"number");if(a!=="number"&&a!=="bigint"&&a!=="string")throw new TypeError(`Invalid value for intMode, expected "number", "bigint" or "string",             got ${JSON.stringify(a)}`);if(t.url===":memory:")return{path:":memory:",scheme:"file",syncUrl:i,syncInterval:o,intMode:a,fetch:t.fetch,tls:!1,authToken:void 0,encryptionKey:void 0,authority:void 0};const l=Nr(t.url);for(const{key:p,value:b}of l.query?.pairs??[])if(p==="authToken")r=b||void 0;else if(p==="tls")if(b==="0")s=!1;else if(b==="1")s=!0;else throw new q(`Unknown value for the "tls" query argument: ${JSON.stringify(b)}. Supported values are "0" and "1"`,"URL_INVALID");else throw new q(`Unknown URL query parameter ${JSON.stringify(p)}`,"URL_PARAM_NOT_SUPPORTED");const c=l.scheme.toLowerCase();let h;if(c==="libsql")if(s===!1){if(l.authority?.port===void 0)throw new q('A "libsql:" URL with ?tls=0 must specify an explicit port',"URL_INVALID");h="http"}else h="https";else if(c==="http"||c==="ws")h=c,s??=!1;else if(c==="https"||c==="wss"||c==="file")h=c;else throw new q(`The client supports only "libsql:", "wss:", "ws:", "https:", "http:" and "file:" URLs, got ${JSON.stringify(l.scheme+":")}. For more information, please read ${ve}`,"URL_SCHEME_NOT_SUPPORTED");if(l.fragment!==void 0)throw new q(`URL fragments are not supported: ${JSON.stringify("#"+l.fragment)}`,"URL_INVALID");return{scheme:h,tls:s??!0,authority:l.authority,path:l.path,authToken:r,encryptionKey:n,syncUrl:i,syncInterval:o,intMode:a,fetch:t.fetch}}let de;typeof WebSocket<"u"?de=WebSocket:typeof global<"u"?de=global.WebSocket:typeof window<"u"?de=window.WebSocket:typeof self<"u"&&(de=self.WebSocket);class As{constructor(){this.intMode="number"}intMode}class T extends Error{constructor(e){super(e),this.name="ClientError"}}class w extends T{constructor(e){super(e),this.name="ProtoError"}}class Ls extends T{code;proto;constructor(e,s){super(e),this.name="ResponseError",this.code=s.code,this.proto=s,this.stack=void 0}}class K extends T{constructor(e,s){s!==void 0?(super(`${e}: ${s}`),this.cause=s):super(e),this.name="ClosedError"}}class $s extends T{constructor(e){super(e),this.name="WebSocketUnsupportedError"}}class mt extends T{constructor(e){super(e),this.name="WebSocketError"}}class Es extends T{status;constructor(e,s){super(e),this.status=s,this.name="HttpServerError"}}class be extends T{constructor(e){super(e),this.name="ProtocolVersionError"}}class se extends T{constructor(e){super(e),this.name="InternalError"}}class _e extends T{constructor(e){super(e),this.name="MisuseError"}}function H(t){if(typeof t=="string")return t;throw xe(t,"string")}function W(t){if(t!=null){if(typeof t=="string")return t;throw xe(t,"string or null")}}function oe(t){if(typeof t=="number")return t;throw xe(t,"number")}function Oe(t){if(typeof t=="boolean")return t;throw xe(t,"boolean")}function Ke(t){if(Array.isArray(t))return t;throw xe(t,"array")}function U(t){if(t!==null&&typeof t=="object"&&!Array.isArray(t))return t;throw xe(t,"object")}function re(t,e){return Ke(t).map(s=>e(U(s)))}function xe(t,e){if(t===void 0)return new w(`Expected ${e}, but the property was missing`);let s=typeof t;return t===null?s="null":Array.isArray(t)&&(s="array"),new w(`Expected ${e}, received ${s}`)}function Lt(t,e){return e(U(t))}class Gr{#e;#t;constructor(e){this.#e=e,this.#t=!1}begin(){this.#e.push("{"),this.#t=!0}end(){this.#e.push("}"),this.#t=!1}#s(e){this.#t?(this.#e.push('"'),this.#t=!1):this.#e.push(',"'),this.#e.push(e),this.#e.push('":')}string(e,s){this.#s(e),this.#e.push(JSON.stringify(s))}stringRaw(e,s){this.#s(e),this.#e.push('"'),this.#e.push(s),this.#e.push('"')}number(e,s){this.#s(e),this.#e.push(""+s)}boolean(e,s){this.#s(e),this.#e.push(s?"true":"false")}object(e,s,r){this.#s(e),this.begin(),r(this,s),this.end()}arrayObjects(e,s,r){this.#s(e),this.#e.push("[");for(let n=0;n<s.length;++n)n!==0&&this.#e.push(","),this.begin(),r(this,s[n]),this.end();this.#e.push("]")}}function vs(t,e){const s=[],r=new Gr(s);return r.begin(),e(r,t),r.end(),s.join("")}const $e=0,yt=1,bt=2,Yr=5;class Zr{#e;#t;#s;constructor(e){this.#e=e,this.#t=new DataView(e.buffer,e.byteOffset,e.byteLength),this.#s=0}varint(){let e=0;for(let s=0;;s+=7){const r=this.#e[this.#s++];if(e|=(r&127)<<s,!(r&128))break}return e}varintBig(){let e=0n;for(let s=0n;;s+=7n){const r=this.#e[this.#s++];if(e|=BigInt(r&127)<<s,!(r&128))break}return e}bytes(e){const s=new Uint8Array(this.#e.buffer,this.#e.byteOffset+this.#s,e);return this.#s+=e,s}double(){const e=this.#t.getFloat64(this.#s,!0);return this.#s+=8,e}skipVarint(){for(;this.#e[this.#s++]&128;);}skip(e){this.#s+=e}eof(){return this.#s>=this.#e.byteLength}}class Xr{#e;#t;constructor(e){this.#e=e,this.#t=-1}setup(e){this.#t=e}#s(e){if(this.#t!==e)throw new w(`Expected wire type ${e}, got ${this.#t}`);this.#t=-1}bytes(){this.#s(bt);const e=this.#e.varint();return this.#e.bytes(e)}string(){return new TextDecoder().decode(this.bytes())}message(e){return Xe(this.bytes(),e)}int32(){return this.#s($e),this.#e.varint()}uint32(){return this.int32()}bool(){return this.int32()!==0}uint64(){return this.#s($e),this.#e.varintBig()}sint64(){const e=this.uint64();return e>>1n^-(e&1n)}double(){return this.#s(yt),this.#e.double()}maybeSkip(){if(!(this.#t<0)){if(this.#t===$e)this.#e.skipVarint();else if(this.#t===yt)this.#e.skip(8);else if(this.#t===bt){const e=this.#e.varint();this.#e.skip(e)}else if(this.#t===Yr)this.#e.skip(4);else throw new w(`Unexpected wire type ${this.#t}`);this.#t=-1}}}function Xe(t,e){const s=new Zr(t),r=new Xr(s);let n=e.default();for(;!s.eof();){const i=s.varint(),o=i>>3,a=i&7;r.setup(a);const l=e[o];if(l!==void 0){const c=l(r,n);c!==void 0&&(n=c)}r.maybeSkip()}return n}class $t{#e;#t;#s;#r;constructor(){this.#e=new ArrayBuffer(256),this.#t=new Uint8Array(this.#e),this.#s=new DataView(this.#e),this.#r=0}#i(e){if(this.#r+e<=this.#e.byteLength)return;let s=this.#e.byteLength;for(;s<this.#r+e;)s*=2;const r=new ArrayBuffer(s),n=new Uint8Array(r),i=new DataView(r);n.set(new Uint8Array(this.#e,0,this.#r)),this.#e=r,this.#t=n,this.#s=i}#n(e){this.#i(5),e=0|e;do{let s=e&127;e>>>=7,s|=e?128:0,this.#t[this.#r++]=s}while(e)}#o(e){this.#i(10),e=e&0xffffffffffffffffn;do{let s=Number(e&0x7fn);e>>=7n,s|=e?128:0,this.#t[this.#r++]=s}while(e)}#a(e,s){this.#n(e<<3|s)}bytes(e,s){this.#a(e,bt),this.#n(s.byteLength),this.#i(s.byteLength),this.#t.set(s,this.#r),this.#r+=s.byteLength}string(e,s){this.bytes(e,new TextEncoder().encode(s))}message(e,s,r){const n=new $t;r(n,s),this.bytes(e,n.data())}int32(e,s){this.#a(e,$e),this.#n(s)}uint32(e,s){this.int32(e,s)}bool(e,s){this.int32(e,s?1:0)}sint64(e,s){this.#a(e,$e),this.#o(s<<1n^s>>63n)}double(e,s){this.#a(e,yt),this.#i(8),this.#s.setFloat64(this.#r,s,!0),this.#r+=8}data(){return new Uint8Array(this.#e,0,this.#r)}}function Os(t,e){const s=new $t;return e(s,t),s.data()}class Le{#e;#t;constructor(){this.#e=new Set,this.#t=new Set}alloc(){for(const s of this.#t)return this.#t.delete(s),this.#e.add(s),this.#e.has(this.#e.size-1)||this.#t.add(this.#e.size-1),s;const e=this.#e.size;return this.#e.add(e),e}free(e){if(!this.#e.delete(e))throw new se("Freeing an id that is not allocated");this.#t.delete(this.#e.size),e<this.#e.size&&this.#t.add(e)}}function N(t,e){throw new se(e)}function Ee(t){if(t===null)return null;if(typeof t=="string")return t;if(typeof t=="number"){if(!Number.isFinite(t))throw new RangeError("Only finite numbers (not Infinity or NaN) can be passed as arguments");return t}else if(typeof t=="bigint"){if(t<en||t>tn)throw new RangeError("This bigint value is too large to be represented as a 64-bit integer and passed as argument");return t}else{if(typeof t=="boolean")return t?1n:0n;if(t instanceof ArrayBuffer)return new Uint8Array(t);if(t instanceof Uint8Array)return t;if(t instanceof Date)return+t.valueOf();if(typeof t=="object")return""+t.toString();throw new TypeError("Unsupported type of value")}}const en=-9223372036854775808n,tn=9223372036854775807n;function Qs(t,e){if(t===null)return null;if(typeof t=="number")return t;if(typeof t=="string")return t;if(typeof t=="bigint")if(e==="number"){const s=Number(t);if(!Number.isSafeInteger(s))throw new RangeError("Received integer which is too large to be safely represented as a JavaScript number");return s}else{if(e==="bigint")return t;if(e==="string")return""+t;throw new _e("Invalid value for IntMode")}else{if(t instanceof Uint8Array)return t.slice().buffer;throw t===void 0?new w("Received unrecognized type of Value"):N(t,"Impossible type of Value")}}function Be(t){return{affectedRowCount:t.affectedRowCount,lastInsertRowid:t.lastInsertRowid,columnNames:t.cols.map(e=>e.name),columnDecltypes:t.cols.map(e=>e.decltype)}}function Bs(t,e){const s=Be(t),r=t.rows.map(n=>js(s.columnNames,n,e));return{...s,rows:r}}function Ps(t,e){const s=Be(t);let r;return t.rows.length>0&&(r=js(s.columnNames,t.rows[0],e)),{...s,row:r}}function Us(t,e){const s=Be(t);let r;return t.rows.length>0&&s.columnNames.length>0&&(r=Qs(t.rows[0][0],e)),{...s,value:r}}function js(t,e,s){const r={};Object.defineProperty(r,"length",{value:e.length});for(let n=0;n<e.length;++n){const i=Qs(e[n],s);Object.defineProperty(r,n,{value:i});const o=t[n];o!==void 0&&!Object.hasOwn(r,o)&&Object.defineProperty(r,o,{value:i,enumerable:!0})}return r}function we(t){return new Ls(t.message,t)}class Et{#e;#t;#s;constructor(e,s){this.#e=e,this.#t=s,this.#s=void 0}_getSqlId(e){if(this.#e!==e)throw new _e("Attempted to use SQL text opened with other object");if(this.#s!==void 0)throw new K("SQL text is closed",this.#s);return this.#t}close(){this._setClosed(new T("SQL text was manually closed"))}_setClosed(e){this.#s===void 0&&(this.#s=e,this.#e._closeSql(this.#t))}get closed(){return this.#s!==void 0}}function wt(t,e){return e instanceof Et?{sqlId:e._getSqlId(t)}:{sql:""+e}}class Je{#e;#t;constructor(){this.#e=[],this.#t=[]}get length(){return this.#e.length+this.#t.length}push(e){this.#e.push(e)}shift(){return this.#t.length===0&&this.#e.length>0&&(this.#t=this.#e.reverse(),this.#e=[]),this.#t.pop()}first(){return this.#t.length!==0?this.#t[this.#t.length-1]:this.#e[0]}}let gt=class{sql;_args;_namedArgs;constructor(e){this.sql=e,this._args=[],this._namedArgs=new Map}bindIndexes(e){this._args.length=0;for(const s of e)this._args.push(Ee(s));return this}bindIndex(e,s){if(e!==(e|0)||e<=0)throw new RangeError("Index of a positional argument must be positive integer");for(;this._args.length<e;)this._args.push(null);return this._args[e-1]=Ee(s),this}bindName(e,s){return this._namedArgs.set(e,Ee(s)),this}unbindAll(){return this._args.length=0,this._namedArgs.clear(),this}};function ks(t,e,s){let r,n=[],i=[];if(e instanceof gt){r=e.sql,n=e._args;for(const[l,c]of e._namedArgs.entries())i.push({name:l,value:c})}else Array.isArray(e)?(r=e[0],Array.isArray(e[1])?n=e[1].map(l=>Ee(l)):i=Object.entries(e[1]).map(([l,c])=>({name:l,value:Ee(c)}))):r=e;const{sql:o,sqlId:a}=wt(t,r);return{sql:o,sqlId:a,args:n,namedArgs:i,wantRows:s}}let sn=class{_stream;#e;_steps;#t;constructor(e,s){this._stream=e,this.#e=s,this._steps=[],this.#t=!1}step(){return new on(this)}execute(){if(this.#t)throw new _e("This batch has already been executed");this.#t=!0;const e={steps:this._steps.map(s=>s.proto)};return this.#e?nn(this._stream,this._steps,e):rn(this._stream,this._steps,e)}};function rn(t,e,s){return t._batch(s).then(r=>{for(let n=0;n<e.length;++n){const i=r.stepResults.get(n),o=r.stepErrors.get(n);e[n].callback(i,o)}})}async function nn(t,e,s){const r=await t._openCursor(s);try{let n=0,i,o=[];for(;;){const a=await r.next();if(a===void 0)break;if(a.type==="step_begin"){if(a.step<n||a.step>=e.length)throw new w("Server produced StepBeginEntry for unexpected step");if(i!==void 0)throw new w("Server produced StepBeginEntry before terminating previous step");for(let l=n;l<a.step;++l)e[l].callback(void 0,void 0);n=a.step+1,i=a,o=[]}else if(a.type==="step_end"){if(i===void 0)throw new w("Server produced StepEndEntry but no step is active");const l={cols:i.cols,rows:o,affectedRowCount:a.affectedRowCount,lastInsertRowid:a.lastInsertRowid};e[i.step].callback(l,void 0),i=void 0,o=[]}else if(a.type==="step_error"){if(i===void 0){if(a.step>=e.length)throw new w("Server produced StepErrorEntry for unexpected step");for(let l=n;l<a.step;++l)e[l].callback(void 0,void 0)}else{if(a.step!==i.step)throw new w("Server produced StepErrorEntry for unexpected step");i=void 0,o=[]}e[a.step].callback(void 0,a.error),n=a.step+1}else if(a.type==="row"){if(i===void 0)throw new w("Server produced RowEntry but no step is active");o.push(a.row)}else throw a.type==="error"?we(a.error):a.type==="none"?new w("Server produced unrecognized CursorEntry"):N(a,"Impossible CursorEntry")}if(i!==void 0)throw new w("Server closed Cursor before terminating active step");for(let a=n;a<e.length;++a)e[a].callback(void 0,void 0)}finally{r.close()}}let on=class{_batch;#e;_index;constructor(e){this._batch=e,this.#e=[],this._index=void 0}condition(e){return this.#e.push(e._proto),this}query(e){return this.#t(e,!0,Bs)}queryRow(e){return this.#t(e,!0,Ps)}queryValue(e){return this.#t(e,!0,Us)}run(e){return this.#t(e,!1,Be)}#t(e,s,r){if(this._index!==void 0)throw new _e("This BatchStep has already been added to the batch");const n=ks(this._batch._stream._sqlOwner(),e,s);let i;this.#e.length===0?i=void 0:this.#e.length===1?i=this.#e[0]:i={type:"and",conds:this.#e.slice()};const o={stmt:n,condition:i};return new Promise((a,l)=>{const c=(h,p)=>{h!==void 0&&p!==void 0?l(new w("Server returned both result and error")):p!==void 0?l(we(p)):a(h!==void 0?r(h,this._batch._stream.intMode):void 0)};this._index=this._batch._steps.length,this._batch._steps.push({proto:o,callback:c})})}},D=class ne{_batch;_proto;constructor(e,s){this._batch=e,this._proto=s}static ok(e){return new ne(e._batch,{type:"ok",step:es(e)})}static error(e){return new ne(e._batch,{type:"error",step:es(e)})}static not(e){return new ne(e._batch,{type:"not",cond:e._proto})}static and(e,s){for(const r of s)ts(e,r);return new ne(e,{type:"and",conds:s.map(r=>r._proto)})}static or(e,s){for(const r of s)ts(e,r);return new ne(e,{type:"or",conds:s.map(r=>r._proto)})}static isAutocommit(e){return e._stream.client()._ensureVersion(3,"BatchCond.isAutocommit()"),new ne(e,{type:"is_autocommit"})}};function es(t){if(t._index===void 0)throw new _e("Cannot add a condition referencing a step that has not been added to the batch");return t._index}function ts(t,e){if(e._batch!==t)throw new _e("Cannot mix BatchCond objects for different Batch objects")}function an(t){return{paramNames:t.params.map(e=>e.name),columns:t.cols,isExplain:t.isExplain,isReadonly:t.isReadonly}}class Ds{constructor(e){this.intMode=e}query(e){return this.#e(e,!0,Bs)}queryRow(e){return this.#e(e,!0,Ps)}queryValue(e){return this.#e(e,!0,Us)}run(e){return this.#e(e,!1,Be)}#e(e,s,r){const n=ks(this._sqlOwner(),e,s);return this._execute(n).then(i=>r(i,this.intMode))}batch(e=!1){return new sn(this,e)}describe(e){const s=wt(this._sqlOwner(),e);return this._describe(s).then(an)}sequence(e){const s=wt(this._sqlOwner(),e);return this._sequence(s)}intMode}class Ms{}const ln=1e3,un=10;class cn extends Ms{#e;#t;#s;#r;#i;#n;#o;constructor(e,s,r){super(),this.#e=e,this.#t=s,this.#s=r,this.#r=new Je,this.#i=new Je,this.#n=void 0,this.#o=!1}async next(){for(;;){if(this.#n!==void 0)throw new K("Cursor is closed",this.#n);for(;!this.#o&&this.#i.length<un;)this.#i.push(this.#a());const e=this.#r.shift();if(this.#o||e!==void 0)return e;await this.#i.shift().then(s=>{if(s!==void 0){for(const r of s.entries)this.#r.push(r);this.#o||=s.done}})}}#a(){return this.#t._sendCursorRequest(this,{type:"fetch_cursor",cursorId:this.#s,maxCount:ln}).then(e=>e,e=>{this._setClosed(e)})}_setClosed(e){this.#n===void 0&&(this.#n=e,this.#t._sendCursorRequest(this,{type:"close_cursor",cursorId:this.#s}).catch(()=>{}),this.#t._cursorClosed(this))}close(){this._setClosed(new T("Cursor was manually closed"))}get closed(){return this.#n!==void 0}}class vt extends Ds{#e;#t;#s;#r;#i;#n;static open(e){const s=e._streamIdAlloc.alloc(),r=new vt(e,s),n=()=>{},i=a=>r.#u(a),o={type:"open_stream",streamId:s};return e._sendRequest(o,{responseCallback:n,errorCallback:i}),r}constructor(e,s){super(e.intMode),this.#e=e,this.#t=s,this.#s=new Je,this.#r=void 0,this.#i=!1,this.#n=void 0}client(){return this.#e}_sqlOwner(){return this.#e}_execute(e){return this.#o({type:"execute",streamId:this.#t,stmt:e}).then(s=>s.result)}_batch(e){return this.#o({type:"batch",streamId:this.#t,batch:e}).then(s=>s.result)}_describe(e){return this.#e._ensureVersion(2,"describe()"),this.#o({type:"describe",streamId:this.#t,sql:e.sql,sqlId:e.sqlId}).then(s=>s.result)}_sequence(e){return this.#e._ensureVersion(2,"sequence()"),this.#o({type:"sequence",streamId:this.#t,sql:e.sql,sqlId:e.sqlId}).then(s=>{})}getAutocommit(){return this.#e._ensureVersion(3,"getAutocommit()"),this.#o({type:"get_autocommit",streamId:this.#t}).then(e=>e.isAutocommit)}#o(e){return new Promise((s,r)=>{this.#a({type:"request",request:e,responseCallback:s,errorCallback:r})})}_openCursor(e){return this.#e._ensureVersion(3,"cursor"),new Promise((s,r)=>{this.#a({type:"cursor",batch:e,cursorCallback:s,errorCallback:r})})}_sendCursorRequest(e,s){if(e!==this.#r)throw new se("Cursor not associated with the stream attempted to execute a request");return new Promise((r,n)=>{this.#n!==void 0?n(new K("Stream is closed",this.#n)):this.#e._sendRequest(s,{responseCallback:r,errorCallback:n})})}_cursorClosed(e){if(e!==this.#r)throw new se("Cursor was closed, but it was not associated with the stream");this.#r=void 0,this.#l()}#a(e){this.#n!==void 0?e.errorCallback(new K("Stream is closed",this.#n)):this.#i?e.errorCallback(new K("Stream is closing",void 0)):(this.#s.push(e),this.#l())}#l(){for(;;){const e=this.#s.first();if(e===void 0&&this.#r===void 0&&this.#i){this.#u(new T("Stream was gracefully closed"));break}else if(e?.type==="request"&&this.#r===void 0){const{request:s,responseCallback:r,errorCallback:n}=e;this.#s.shift(),this.#e._sendRequest(s,{responseCallback:r,errorCallback:n})}else if(e?.type==="cursor"&&this.#r===void 0){const{batch:s,cursorCallback:r}=e;this.#s.shift();const n=this.#e._cursorIdAlloc.alloc(),i=new cn(this.#e,this,n),o={type:"open_cursor",streamId:this.#t,cursorId:n,batch:s},a=()=>{},l=c=>i._setClosed(c);this.#e._sendRequest(o,{responseCallback:a,errorCallback:l}),this.#r=i,r(i)}else break}}#u(e){if(this.#n!==void 0)return;for(this.#n=e,this.#r!==void 0&&this.#r._setClosed(e);;){const i=this.#s.shift();if(i!==void 0)i.errorCallback(e);else break}const s={type:"close_stream",streamId:this.#t},r=()=>this.#e._streamIdAlloc.free(this.#t),n=()=>{};this.#e._sendRequest(s,{responseCallback:r,errorCallback:n})}close(){this.#u(new T("Stream was manually closed"))}closeGracefully(){this.#i=!0,this.#l()}get closed(){return this.#n!==void 0||this.#i}}function Ot(t,e){e.sql!==void 0&&t.string("sql",e.sql),e.sqlId!==void 0&&t.number("sql_id",e.sqlId),t.arrayObjects("args",e.args,Fs),t.arrayObjects("named_args",e.namedArgs,hn),t.boolean("want_rows",e.wantRows)}function hn(t,e){t.string("name",e.name),t.object("value",e.value,Fs)}function He(t,e){t.arrayObjects("steps",e.steps,dn)}function dn(t,e){e.condition!==void 0&&t.object("condition",e.condition,St),t.object("stmt",e.stmt,Ot)}function St(t,e){if(t.stringRaw("type",e.type),e.type==="ok"||e.type==="error")t.number("step",e.step);else if(e.type==="not")t.object("cond",e.cond,St);else if(e.type==="and"||e.type==="or")t.arrayObjects("conds",e.conds,St);else if(e.type!=="is_autocommit")throw N(e,"Impossible type of BatchCond")}function Fs(t,e){if(e===null)t.stringRaw("type","null");else if(typeof e=="bigint")t.stringRaw("type","integer"),t.stringRaw("value",""+e);else if(typeof e=="number")t.stringRaw("type","float"),t.number("value",e);else if(typeof e=="string")t.stringRaw("type","text"),t.string("value",e);else if(e instanceof Uint8Array)t.stringRaw("type","blob"),t.stringRaw("base64",At.fromUint8Array(e));else if(e!==void 0)throw N(e,"Impossible type of Value")}function fn(t,e){if(t.stringRaw("type",e.type),e.type==="hello")e.jwt!==void 0&&t.string("jwt",e.jwt);else if(e.type==="request")t.number("request_id",e.requestId),t.object("request",e.request,pn);else throw N(e,"Impossible type of ClientMsg")}function pn(t,e){if(t.stringRaw("type",e.type),e.type==="open_stream")t.number("stream_id",e.streamId);else if(e.type==="close_stream")t.number("stream_id",e.streamId);else if(e.type==="execute")t.number("stream_id",e.streamId),t.object("stmt",e.stmt,Ot);else if(e.type==="batch")t.number("stream_id",e.streamId),t.object("batch",e.batch,He);else if(e.type==="open_cursor")t.number("stream_id",e.streamId),t.number("cursor_id",e.cursorId),t.object("batch",e.batch,He);else if(e.type==="close_cursor")t.number("cursor_id",e.cursorId);else if(e.type==="fetch_cursor")t.number("cursor_id",e.cursorId),t.number("max_count",e.maxCount);else if(e.type==="sequence")t.number("stream_id",e.streamId),e.sql!==void 0&&t.string("sql",e.sql),e.sqlId!==void 0&&t.number("sql_id",e.sqlId);else if(e.type==="describe")t.number("stream_id",e.streamId),e.sql!==void 0&&t.string("sql",e.sql),e.sqlId!==void 0&&t.number("sql_id",e.sqlId);else if(e.type==="store_sql")t.number("sql_id",e.sqlId),t.string("sql",e.sql);else if(e.type==="close_sql")t.number("sql_id",e.sqlId);else if(e.type==="get_autocommit")t.number("stream_id",e.streamId);else throw N(e,"Impossible type of Request")}function Qt(t,e){e.sql!==void 0&&t.string(1,e.sql),e.sqlId!==void 0&&t.int32(2,e.sqlId);for(const s of e.args)t.message(3,s,Vs);for(const s of e.namedArgs)t.message(4,s,mn);t.bool(5,e.wantRows)}function mn(t,e){t.string(1,e.name),t.message(2,e.value,Vs)}function et(t,e){for(const s of e.steps)t.message(1,s,yn)}function yn(t,e){e.condition!==void 0&&t.message(1,e.condition,Bt),t.message(2,e.stmt,Qt)}function Bt(t,e){if(e.type==="ok")t.uint32(1,e.step);else if(e.type==="error")t.uint32(2,e.step);else if(e.type==="not")t.message(3,e.cond,Bt);else if(e.type==="and")t.message(4,e.conds,ss);else if(e.type==="or")t.message(5,e.conds,ss);else if(e.type==="is_autocommit")t.message(6,void 0,zs);else throw N(e,"Impossible type of BatchCond")}function ss(t,e){for(const s of e)t.message(1,s,Bt)}function Vs(t,e){if(e===null)t.message(1,void 0,zs);else if(typeof e=="bigint")t.sint64(2,e);else if(typeof e=="number")t.double(3,e);else if(typeof e=="string")t.string(4,e);else if(e instanceof Uint8Array)t.bytes(5,e);else if(e!==void 0)throw N(e,"Impossible type of Value")}function zs(t,e){}function bn(t,e){if(e.type==="hello")t.message(1,e,wn);else if(e.type==="request")t.message(2,e,gn);else throw N(e,"Impossible type of ClientMsg")}function wn(t,e){e.jwt!==void 0&&t.string(1,e.jwt)}function gn(t,e){t.int32(1,e.requestId);const s=e.request;if(s.type==="open_stream")t.message(2,s,Sn);else if(s.type==="close_stream")t.message(3,s,qn);else if(s.type==="execute")t.message(4,s,_n);else if(s.type==="batch")t.message(5,s,xn);else if(s.type==="open_cursor")t.message(6,s,Rn);else if(s.type==="close_cursor")t.message(7,s,Cn);else if(s.type==="fetch_cursor")t.message(8,s,Tn);else if(s.type==="sequence")t.message(9,s,In);else if(s.type==="describe")t.message(10,s,Nn);else if(s.type==="store_sql")t.message(11,s,An);else if(s.type==="close_sql")t.message(12,s,Ln);else if(s.type==="get_autocommit")t.message(13,s,$n);else throw N(s,"Impossible type of Request")}function Sn(t,e){t.int32(1,e.streamId)}function qn(t,e){t.int32(1,e.streamId)}function _n(t,e){t.int32(1,e.streamId),t.message(2,e.stmt,Qt)}function xn(t,e){t.int32(1,e.streamId),t.message(2,e.batch,et)}function Rn(t,e){t.int32(1,e.streamId),t.int32(2,e.cursorId),t.message(3,e.batch,et)}function Cn(t,e){t.int32(1,e.cursorId)}function Tn(t,e){t.int32(1,e.cursorId),t.uint32(2,e.maxCount)}function In(t,e){t.int32(1,e.streamId),e.sql!==void 0&&t.string(2,e.sql),e.sqlId!==void 0&&t.int32(3,e.sqlId)}function Nn(t,e){t.int32(1,e.streamId),e.sql!==void 0&&t.string(2,e.sql),e.sqlId!==void 0&&t.int32(3,e.sqlId)}function An(t,e){t.int32(1,e.sqlId),t.string(2,e.sql)}function Ln(t,e){t.int32(1,e.sqlId)}function $n(t,e){t.int32(1,e.streamId)}function ge(t){const e=H(t.message),s=W(t.code);return{message:e,code:s}}function Pt(t){const e=re(t.cols,Ks),s=Ke(t.rows).map(o=>re(o,Gs)),r=oe(t.affected_row_count),n=W(t.last_insert_rowid),i=n!==void 0?BigInt(n):void 0;return{cols:e,rows:s,affectedRowCount:r,lastInsertRowid:i}}function Ks(t){const e=W(t.name),s=W(t.decltype);return{name:e,decltype:s}}function Js(t){const e=new Map;Ke(t.step_results).forEach((r,n)=>{r!==null&&e.set(n,Pt(U(r)))});const s=new Map;return Ke(t.step_errors).forEach((r,n)=>{r!==null&&s.set(n,ge(U(r)))}),{stepResults:e,stepErrors:s}}function Hs(t){const e=H(t.type);if(e==="step_begin"){const s=oe(t.step),r=re(t.cols,Ks);return{type:"step_begin",step:s,cols:r}}else if(e==="step_end"){const s=oe(t.affected_row_count),r=W(t.last_insert_rowid),n=r!==void 0?BigInt(r):void 0;return{type:"step_end",affectedRowCount:s,lastInsertRowid:n}}else if(e==="step_error"){const s=oe(t.step),r=ge(U(t.error));return{type:"step_error",step:s,error:r}}else{if(e==="row")return{type:"row",row:re(t.row,Gs)};if(e==="error")return{type:"error",error:ge(U(t.error))};throw new w("Unexpected type of CursorEntry")}}function Ws(t){const e=re(t.params,En),s=re(t.cols,vn),r=Oe(t.is_explain),n=Oe(t.is_readonly);return{params:e,cols:s,isExplain:r,isReadonly:n}}function En(t){return{name:W(t.name)}}function vn(t){const e=H(t.name),s=W(t.decltype);return{name:e,decltype:s}}function Gs(t){const e=H(t.type);if(e==="null")return null;if(e==="integer"){const s=H(t.value);return BigInt(s)}else{if(e==="float")return oe(t.value);if(e==="text")return H(t.value);if(e==="blob")return At.toUint8Array(H(t.base64));throw new w("Unexpected type of Value")}}function On(t){const e=H(t.type);if(e==="hello_ok")return{type:"hello_ok"};if(e==="hello_error")return{type:"hello_error",error:ge(U(t.error))};if(e==="response_ok"){const s=oe(t.request_id),r=Qn(U(t.response));return{type:"response_ok",requestId:s,response:r}}else if(e==="response_error"){const s=oe(t.request_id),r=ge(U(t.error));return{type:"response_error",requestId:s,error:r}}else throw new w("Unexpected type of ServerMsg")}function Qn(t){const e=H(t.type);if(e==="open_stream")return{type:"open_stream"};if(e==="close_stream")return{type:"close_stream"};if(e==="execute")return{type:"execute",result:Pt(U(t.result))};if(e==="batch")return{type:"batch",result:Js(U(t.result))};if(e==="open_cursor")return{type:"open_cursor"};if(e==="close_cursor")return{type:"close_cursor"};if(e==="fetch_cursor"){const s=re(t.entries,Hs),r=Oe(t.done);return{type:"fetch_cursor",entries:s,done:r}}else{if(e==="sequence")return{type:"sequence"};if(e==="describe")return{type:"describe",result:Ws(U(t.result))};if(e==="store_sql")return{type:"store_sql"};if(e==="close_sql")return{type:"close_sql"};if(e==="get_autocommit")return{type:"get_autocommit",isAutocommit:Oe(t.is_autocommit)};throw new w("Unexpected type of Response")}}const G={default(){return{message:"",code:void 0}},1(t,e){e.message=t.string()},2(t,e){e.code=t.string()}},Se={default(){return{cols:[],rows:[],affectedRowCount:0,lastInsertRowid:void 0}},1(t,e){e.cols.push(t.message(Ys))},2(t,e){e.rows.push(t.message(Zs))},3(t,e){e.affectedRowCount=Number(t.uint64())},4(t,e){e.lastInsertRowid=t.sint64()}},Ys={default(){return{name:void 0,decltype:void 0}},1(t,e){e.name=t.string()},2(t,e){e.decltype=t.string()}},Zs={default(){return[]},1(t,e){e.push(t.message(Fn))}},We={default(){return{stepResults:new Map,stepErrors:new Map}},1(t,e){const[s,r]=t.message(Bn);e.stepResults.set(s,r)},2(t,e){const[s,r]=t.message(Pn);e.stepErrors.set(s,r)}},Bn={default(){return[0,Se.default()]},1(t,e){e[0]=t.uint32()},2(t,e){e[1]=t.message(Se)}},Pn={default(){return[0,G.default()]},1(t,e){e[0]=t.uint32()},2(t,e){e[1]=t.message(G)}},Xs={default(){return{type:"none"}},1(t){return t.message(Un)},2(t){return t.message(jn)},3(t){return t.message(kn)},4(t){return{type:"row",row:t.message(Zs)}},5(t){return{type:"error",error:t.message(G)}}},Un={default(){return{type:"step_begin",step:0,cols:[]}},1(t,e){e.step=t.uint32()},2(t,e){e.cols.push(t.message(Ys))}},jn={default(){return{type:"step_end",affectedRowCount:0,lastInsertRowid:void 0}},1(t,e){e.affectedRowCount=t.uint32()},2(t,e){e.lastInsertRowid=t.uint64()}},kn={default(){return{type:"step_error",step:0,error:G.default()}},1(t,e){e.step=t.uint32()},2(t,e){e.error=t.message(G)}},Ge={default(){return{params:[],cols:[],isExplain:!1,isReadonly:!1}},1(t,e){e.params.push(t.message(Dn))},2(t,e){e.cols.push(t.message(Mn))},3(t,e){e.isExplain=t.bool()},4(t,e){e.isReadonly=t.bool()}},Dn={default(){return{name:void 0}},1(t,e){e.name=t.string()}},Mn={default(){return{name:"",decltype:void 0}},1(t,e){e.name=t.string()},2(t,e){e.decltype=t.string()}},Fn={default(){},1(t){return null},2(t){return t.sint64()},3(t){return t.double()},4(t){return t.string()},5(t){return t.bytes()}},Vn={default(){return{type:"none"}},1(t){return{type:"hello_ok"}},2(t){return t.message(zn)},3(t){return t.message(Jn)},4(t){return t.message(Kn)}},zn={default(){return{type:"hello_error",error:G.default()}},1(t,e){e.error=t.message(G)}},Kn={default(){return{type:"response_error",requestId:0,error:G.default()}},1(t,e){e.requestId=t.int32()},2(t,e){e.error=t.message(G)}},Jn={default(){return{type:"response_ok",requestId:0,response:{type:"none"}}},1(t,e){e.requestId=t.int32()},2(t,e){e.response={type:"open_stream"}},3(t,e){e.response={type:"close_stream"}},4(t,e){e.response=t.message(Hn)},5(t,e){e.response=t.message(Wn)},6(t,e){e.response={type:"open_cursor"}},7(t,e){e.response={type:"close_cursor"}},8(t,e){e.response=t.message(Gn)},9(t,e){e.response={type:"sequence"}},10(t,e){e.response=t.message(Yn)},11(t,e){e.response={type:"store_sql"}},12(t,e){e.response={type:"close_sql"}},13(t,e){e.response=t.message(Zn)}},Hn={default(){return{type:"execute",result:Se.default()}},1(t,e){e.result=t.message(Se)}},Wn={default(){return{type:"batch",result:We.default()}},1(t,e){e.result=t.message(We)}},Gn={default(){return{type:"fetch_cursor",entries:[],done:!1}},1(t,e){e.entries.push(t.message(Xs))},2(t,e){e.done=t.bool()}},Yn={default(){return{type:"describe",result:Ge.default()}},1(t,e){e.result=t.message(Ge)}},Zn={default(){return{type:"get_autocommit",isAutocommit:!1}},1(t,e){e.isAutocommit=t.bool()}},Xn=new Map([["hrana2",{version:2,encoding:"json"}],["hrana1",{version:1,encoding:"json"}]]),er=new Map([["hrana3-protobuf",{version:3,encoding:"protobuf"}],["hrana3",{version:3,encoding:"json"}],["hrana2",{version:2,encoding:"json"}],["hrana1",{version:1,encoding:"json"}]]);let ei=class extends As{#e;#t;#s;#r;#i;#n;#o;#a;#l;_streamIdAlloc;_cursorIdAlloc;#u;constructor(e,s){super(),this.#e=e,this.#t=[],this.#s=!1,this.#r=void 0,this.#i=!1,this.#n=void 0,this.#o=!1,this.#a=new Map,this.#l=new Le,this._streamIdAlloc=new Le,this._cursorIdAlloc=new Le,this.#u=new Le,this.#e.binaryType="arraybuffer",this.#e.addEventListener("open",()=>this.#p()),this.#e.addEventListener("close",r=>this.#f(r)),this.#e.addEventListener("error",r=>this.#m(r)),this.#e.addEventListener("message",r=>this.#b(r)),this.#h({type:"hello",jwt:s})}#h(e){if(this.#r!==void 0)throw new se("Trying to send a message on a closed client");if(this.#s)this.#d(e);else{const s=()=>this.#d(e),r=()=>{};this.#t.push({openCallback:s,errorCallback:r})}}#p(){const e=this.#e.protocol;if(e===void 0){this.#c(new T("The `WebSocket.protocol` property is undefined. This most likely means that the WebSocket implementation provided by the environment is broken. If you are using Miniflare 2, please update to Miniflare 3, which fixes this problem."));return}else if(e==="")this.#n={version:1,encoding:"json"};else if(this.#n=er.get(e),this.#n===void 0){this.#c(new w(`Unrecognized WebSocket subprotocol: ${JSON.stringify(e)}`));return}for(const s of this.#t)s.openCallback();this.#t.length=0,this.#s=!0}#d(e){const s=this.#n.encoding;if(s==="json"){const r=vs(e,fn);this.#e.send(r)}else if(s==="protobuf"){const r=Os(e,bn);this.#e.send(r)}else throw N(s,"Impossible encoding")}getVersion(){return new Promise((e,s)=>{if(this.#o=!0,this.#r!==void 0)s(this.#r);else if(this.#s)e(this.#n.version);else{const r=()=>e(this.#n.version);this.#t.push({openCallback:r,errorCallback:s})}})}_ensureVersion(e,s){if(this.#n===void 0||!this.#o)throw new be(`${s} is supported only on protocol version ${e} and higher, but the version supported by the WebSocket server is not yet known. Use Client.getVersion() to wait until the version is available.`);if(this.#n.version<e)throw new be(`${s} is supported on protocol version ${e} and higher, but the WebSocket server only supports version ${this.#n.version}`)}_sendRequest(e,s){if(this.#r!==void 0){s.errorCallback(new K("Client is closed",this.#r));return}const r=this.#l.alloc();this.#a.set(r,{...s,type:e.type}),this.#h({type:"request",requestId:r,request:e})}#m(e){const r=e.message??"WebSocket was closed due to an error";this.#c(new mt(r))}#f(e){let s=`WebSocket was closed with code ${e.code}`;e.reason&&(s+=`: ${e.reason}`),this.#c(new mt(s))}#c(e){if(this.#r===void 0){this.#r=e;for(const s of this.#t)s.errorCallback(e);this.#t.length=0;for(const[s,r]of this.#a.entries())r.errorCallback(e),this.#l.free(s);this.#a.clear(),this.#e.close()}}#b(e){if(this.#r===void 0)try{let s;const r=this.#n.encoding;if(r==="json"){if(typeof e.data!="string"){this.#e.close(3003,"Only text messages are accepted with JSON encoding"),this.#c(new w("Received non-text message from server with JSON encoding"));return}s=Lt(JSON.parse(e.data),On)}else if(r==="protobuf"){if(!(e.data instanceof ArrayBuffer)){this.#e.close(3003,"Only binary messages are accepted with Protobuf encoding"),this.#c(new w("Received non-binary message from server with Protobuf encoding"));return}s=Xe(new Uint8Array(e.data),Vn)}else throw N(r,"Impossible encoding");this.#y(s)}catch(s){this.#e.close(3007,"Could not handle message"),this.#c(s)}}#y(e){if(e.type==="none")throw new w("Received an unrecognized ServerMsg");if(e.type==="hello_ok"||e.type==="hello_error"){if(this.#i)throw new w("Received a duplicated hello response");if(this.#i=!0,e.type==="hello_error")throw we(e.error);return}else if(!this.#i)throw new w("Received a non-hello message before a hello response");if(e.type==="response_ok"){const s=e.requestId,r=this.#a.get(s);if(this.#a.delete(s),r===void 0)throw new w("Received unexpected OK response");this.#l.free(s);try{if(r.type!==e.response.type)throw console.dir({responseState:r,msg:e}),new w("Received unexpected type of response");r.responseCallback(e.response)}catch(n){throw r.errorCallback(n),n}}else if(e.type==="response_error"){const s=e.requestId,r=this.#a.get(s);if(this.#a.delete(s),r===void 0)throw new w("Received unexpected error response");this.#l.free(s),r.errorCallback(we(e.error))}else throw N(e,"Impossible ServerMsg type")}openStream(){return vt.open(this)}storeSql(e){this._ensureVersion(2,"storeSql()");const s=this.#u.alloc(),r=new Et(this,s),n=()=>{},i=a=>r._setClosed(a),o={type:"store_sql",sqlId:s,sql:e};return this._sendRequest(o,{responseCallback:n,errorCallback:i}),r}_closeSql(e){if(this.#r!==void 0)return;const s=()=>this.#u.free(e),r=i=>this.#c(i),n={type:"close_sql",sqlId:e};this._sendRequest(n,{responseCallback:s,errorCallback:r})}close(){this.#c(new T("Client was manually closed"))}get closed(){return this.#r!==void 0}};const ti=fetch,tr=Request,si=Headers;let fe;if(typeof queueMicrotask<"u")fe=queueMicrotask;else{const t=Promise.resolve();fe=e=>{t.then(e)}}class ri{#e;#t;#s;constructor(e){this.#e=new Uint8Array(new ArrayBuffer(e)),this.#t=0,this.#s=0}get length(){return this.#s-this.#t}data(){return this.#e.slice(this.#t,this.#s)}push(e){this.#r(e.byteLength),this.#e.set(e,this.#s),this.#s+=e.byteLength}#r(e){if(this.#s+e<=this.#e.byteLength)return;const s=this.#s-this.#t;if(s+e<=this.#e.byteLength&&2*this.#s>=this.#e.byteLength)this.#e.copyWithin(0,this.#t,this.#s);else{let r=this.#e.byteLength;do r*=2;while(s+e>r);const n=new Uint8Array(new ArrayBuffer(r));n.set(this.#e.slice(this.#t,this.#s),0),this.#e=n}this.#s=s,this.#t=0}shift(e){this.#t+=e}}function ni(t){const e=W(t.baton),s=W(t.base_url),r=re(t.results,ii);return{baton:e,baseUrl:s,results:r}}function ii(t){const e=H(t.type);if(e==="ok")return{type:"ok",response:oi(U(t.response))};if(e==="error")return{type:"error",error:ge(U(t.error))};throw new w("Unexpected type of StreamResult")}function oi(t){const e=H(t.type);if(e==="close")return{type:"close"};if(e==="execute")return{type:"execute",result:Pt(U(t.result))};if(e==="batch")return{type:"batch",result:Js(U(t.result))};if(e==="sequence")return{type:"sequence"};if(e==="describe")return{type:"describe",result:Ws(U(t.result))};if(e==="store_sql")return{type:"store_sql"};if(e==="close_sql")return{type:"close_sql"};if(e==="get_autocommit")return{type:"get_autocommit",isAutocommit:Oe(t.is_autocommit)};throw new w("Unexpected type of StreamResponse")}function ai(t){const e=W(t.baton),s=W(t.base_url);return{baton:e,baseUrl:s}}const li={default(){return{baton:void 0,baseUrl:void 0,results:[]}},1(t,e){e.baton=t.string()},2(t,e){e.baseUrl=t.string()},3(t,e){e.results.push(t.message(ui))}},ui={default(){return{type:"none"}},1(t){return{type:"ok",response:t.message(ci)}},2(t){return{type:"error",error:t.message(G)}}},ci={default(){return{type:"none"}},1(t){return{type:"close"}},2(t){return t.message(hi)},3(t){return t.message(di)},4(t){return{type:"sequence"}},5(t){return t.message(fi)},6(t){return{type:"store_sql"}},7(t){return{type:"close_sql"}},8(t){return t.message(pi)}},hi={default(){return{type:"execute",result:Se.default()}},1(t,e){e.result=t.message(Se)}},di={default(){return{type:"batch",result:We.default()}},1(t,e){e.result=t.message(We)}},fi={default(){return{type:"describe",result:Ge.default()}},1(t,e){e.result=t.message(Ge)}},pi={default(){return{type:"get_autocommit",isAutocommit:!1}},1(t,e){e.isAutocommit=t.bool()}},mi={default(){return{baton:void 0,baseUrl:void 0}},1(t,e){e.baton=t.string()},2(t,e){e.baseUrl=t.string()}};class yi extends Ms{#e;#t;#s;#r;#i;#n;constructor(e,s){super(),this.#e=e,this.#t=s,this.#s=void 0,this.#r=new ri(16*1024),this.#i=void 0,this.#n=!1}async open(e){if(e.body===null)throw new w("No response body for cursor request");this.#s=e.body.getReader();const s=await this.#o(ai,mi);if(s===void 0)throw new w("Empty response to cursor request");return s}next(){return this.#o(Hs,Xs)}close(){this._setClosed(new T("Cursor was manually closed"))}_setClosed(e){this.#i===void 0&&(this.#i=e,this.#e._cursorClosed(this),this.#s!==void 0&&this.#s.cancel())}get closed(){return this.#i!==void 0}async#o(e,s){for(;;){if(this.#n)return;if(this.#i!==void 0)throw new K("Cursor is closed",this.#i);if(this.#t==="json"){const i=this.#a();if(i!==void 0){const o=new TextDecoder().decode(i),a=JSON.parse(o);return Lt(a,e)}}else if(this.#t==="protobuf"){const i=this.#l();if(i!==void 0)return Xe(i,s)}else throw N(this.#t,"Impossible encoding");if(this.#s===void 0)throw new se("Attempted to read from HTTP cursor before it was opened");const{value:r,done:n}=await this.#s.read();if(n&&this.#r.length===0)this.#n=!0;else{if(n)throw new w("Unexpected end of cursor stream");this.#r.push(r)}}}#a(){const e=this.#r.data(),r=e.indexOf(10);if(r<0)return;const n=e.slice(0,r);return this.#r.shift(r+1),n}#l(){const e=this.#r.data();let s=0,r=0;for(;;){if(r>=e.byteLength)return;const i=e[r];if(s|=(i&127)<<7*r,r+=1,!(i&128))break}if(e.byteLength<r+s)return;const n=e.slice(r,r+s);return this.#r.shift(r+s),n}}function bi(t,e){e.baton!==void 0&&t.string("baton",e.baton),t.arrayObjects("requests",e.requests,wi)}function wi(t,e){if(t.stringRaw("type",e.type),e.type!=="close"){if(e.type==="execute")t.object("stmt",e.stmt,Ot);else if(e.type==="batch")t.object("batch",e.batch,He);else if(e.type==="sequence")e.sql!==void 0&&t.string("sql",e.sql),e.sqlId!==void 0&&t.number("sql_id",e.sqlId);else if(e.type==="describe")e.sql!==void 0&&t.string("sql",e.sql),e.sqlId!==void 0&&t.number("sql_id",e.sqlId);else if(e.type==="store_sql")t.number("sql_id",e.sqlId),t.string("sql",e.sql);else if(e.type==="close_sql")t.number("sql_id",e.sqlId);else if(e.type!=="get_autocommit")throw N(e,"Impossible type of StreamRequest")}}function gi(t,e){e.baton!==void 0&&t.string("baton",e.baton),t.object("batch",e.batch,He)}function Si(t,e){e.baton!==void 0&&t.string(1,e.baton);for(const s of e.requests)t.message(2,s,qi)}function qi(t,e){if(e.type==="close")t.message(1,e,_i);else if(e.type==="execute")t.message(2,e,xi);else if(e.type==="batch")t.message(3,e,Ri);else if(e.type==="sequence")t.message(4,e,Ci);else if(e.type==="describe")t.message(5,e,Ti);else if(e.type==="store_sql")t.message(6,e,Ii);else if(e.type==="close_sql")t.message(7,e,Ni);else if(e.type==="get_autocommit")t.message(8,e,Ai);else throw N(e,"Impossible type of StreamRequest")}function _i(t,e){}function xi(t,e){t.message(1,e.stmt,Qt)}function Ri(t,e){t.message(1,e.batch,et)}function Ci(t,e){e.sql!==void 0&&t.string(1,e.sql),e.sqlId!==void 0&&t.int32(2,e.sqlId)}function Ti(t,e){e.sql!==void 0&&t.string(1,e.sql),e.sqlId!==void 0&&t.int32(2,e.sqlId)}function Ii(t,e){t.int32(1,e.sqlId),t.string(2,e.sql)}function Ni(t,e){t.int32(1,e.sqlId)}function Ai(t,e){}function Li(t,e){e.baton!==void 0&&t.string(1,e.baton),t.message(2,e.batch,et)}class $i extends Ds{#e;#t;#s;#r;#i;#n;#o;#a;#l;#u;#h;#p;constructor(e,s,r,n){super(e.intMode),this.#e=e,this.#t=s.toString(),this.#s=r,this.#r=n,this.#i=void 0,this.#n=new Je,this.#o=!1,this.#l=!1,this.#u=!1,this.#h=void 0,this.#p=new Le}client(){return this.#e}_sqlOwner(){return this}storeSql(e){const s=this.#p.alloc();return this.#d({type:"store_sql",sqlId:s,sql:e}).then(()=>{},r=>this._setClosed(r)),new Et(this,s)}_closeSql(e){this.#h===void 0&&this.#d({type:"close_sql",sqlId:e}).then(()=>this.#p.free(e),s=>this._setClosed(s))}_execute(e){return this.#d({type:"execute",stmt:e}).then(s=>s.result)}_batch(e){return this.#d({type:"batch",batch:e}).then(s=>s.result)}_describe(e){return this.#d({type:"describe",sql:e.sql,sqlId:e.sqlId}).then(s=>s.result)}_sequence(e){return this.#d({type:"sequence",sql:e.sql,sqlId:e.sqlId}).then(s=>{})}getAutocommit(){return this.#e._ensureVersion(3,"getAutocommit()"),this.#d({type:"get_autocommit"}).then(e=>e.isAutocommit)}#d(e){return new Promise((s,r)=>{this.#m({type:"pipeline",request:e,responseCallback:s,errorCallback:r})})}_openCursor(e){return new Promise((s,r)=>{this.#m({type:"cursor",batch:e,cursorCallback:s,errorCallback:r})})}_cursorClosed(e){if(e!==this.#a)throw new se("Cursor was closed, but it was not associated with the stream");this.#a=void 0,fe(()=>this.#f())}close(){this._setClosed(new T("Stream was manually closed"))}closeGracefully(){this.#l=!0,fe(()=>this.#f())}get closed(){return this.#h!==void 0||this.#l}_setClosed(e){if(this.#h===void 0){for(this.#h=e,this.#a!==void 0&&this.#a._setClosed(e),this.#e._streamClosed(this);;){const s=this.#n.shift();if(s!==void 0)s.errorCallback(e);else break}(this.#i!==void 0||this.#o)&&!this.#u&&(this.#n.push({type:"pipeline",request:{type:"close"},responseCallback:()=>{},errorCallback:()=>{}}),this.#u=!0,fe(()=>this.#f()))}}#m(e){if(this.#h!==void 0)throw new K("Stream is closed",this.#h);if(this.#l)throw new K("Stream is closing",void 0);this.#n.push(e),fe(()=>this.#f())}#f(){if(this.#o||this.#a!==void 0)return;if(this.#l&&this.#n.length===0){this._setClosed(new T("Stream was gracefully closed"));return}const e=this.#e._endpoint;if(e===void 0){this.#e._endpointPromise.then(()=>this.#f(),r=>this._setClosed(r));return}const s=this.#n.shift();if(s!==void 0)if(s.type==="pipeline"){const r=[s];for(;;){const n=this.#n.first();if(n!==void 0&&n.type==="pipeline")r.push(n),this.#n.shift();else if(n===void 0&&this.#l&&!this.#u){r.push({type:"pipeline",request:{type:"close"},responseCallback:()=>{},errorCallback:()=>{}}),this.#u=!0;break}else break}this.#c(e,r)}else if(s.type==="cursor")this.#b(e,s);else throw N(s,"Impossible type of QueueEntry")}#c(e,s){this.#y(()=>this.#g(s,e),r=>vi(r,e.encoding),r=>r.baton,r=>r.baseUrl,r=>Ei(s,r),r=>s.forEach(n=>n.errorCallback(r)))}#b(e,s){const r=new yi(this,e.encoding);this.#a=r,this.#y(()=>this.#S(s,e),n=>r.open(n),n=>n.baton,n=>n.baseUrl,n=>s.cursorCallback(r),n=>s.errorCallback(n))}#y(e,s,r,n,i,o){let a;try{const l=e(),c=this.#r;a=c(l)}catch(l){a=Promise.reject(l)}this.#o=!0,a.then(l=>l.ok?s(l):Oi(l).then(c=>{throw c})).then(l=>{this.#i=r(l),this.#t=n(l)??this.#t,i(l)}).catch(l=>{this._setClosed(l),o(l)}).finally(()=>{this.#o=!1,this.#f()})}#g(e,s){return this.#w(new URL(s.pipelinePath,this.#t),{baton:this.#i,requests:e.map(r=>r.request)},s.encoding,bi,Si)}#S(e,s){if(s.cursorPath===void 0)throw new be(`Cursors are supported only on protocol version 3 and higher, but the HTTP server only supports version ${s.version}.`);return this.#w(new URL(s.cursorPath,this.#t),{baton:this.#i,batch:e.batch},s.encoding,gi,Li)}#w(e,s,r,n,i){let o,a;if(r==="json")o=vs(s,n),a="application/json";else if(r==="protobuf")o=Os(s,i),a="application/x-protobuf";else throw N(r,"Impossible encoding");const l=new si;return l.set("content-type",a),this.#s!==void 0&&l.set("authorization",`Bearer ${this.#s}`),new tr(e.toString(),{method:"POST",headers:l,body:o})}}function Ei(t,e){if(e.results.length!==t.length)throw new w("Server returned unexpected number of pipeline results");for(let s=0;s<t.length;++s){const r=e.results[s],n=t[s];if(r.type==="ok"){if(r.response.type!==n.request.type)throw new w("Received unexpected type of response");n.responseCallback(r.response)}else if(r.type==="error")n.errorCallback(we(r.error));else throw r.type==="none"?new w("Received unrecognized type of StreamResult"):N(r,"Received impossible type of StreamResult")}}async function vi(t,e){if(e==="json"){const s=await t.json();return Lt(s,ni)}else if(e==="protobuf"){const s=await t.arrayBuffer();return Xe(new Uint8Array(s),li)}else throw N(e,"Impossible encoding")}async function Oi(t){const e=t.headers.get("content-type")??"text/plain";if(e==="application/json"){const r=await t.json();if("message"in r)return we(r)}let s=`Server returned HTTP status ${t.status}`;if(e==="text/plain"){const r=(await t.text()).trim();r!==""&&(s+=`: ${r}`)}return t.status===404&&(s+=". It seems that the libsql server is outdated, please try updating the database."),new Es(s,t.status)}const Qi=[{versionPath:"v3-protobuf",pipelinePath:"v3-protobuf/pipeline",cursorPath:"v3-protobuf/cursor",version:3,encoding:"protobuf"}],qt={versionPath:"v2",pipelinePath:"v2/pipeline",cursorPath:void 0,version:2,encoding:"json"};let Bi=class extends As{#e;#t;#s;#r;#i;_endpointPromise;_endpoint;constructor(e,s,r,n=2){super(),this.#e=e,this.#t=s,this.#s=r??ti,this.#r=void 0,this.#i=new Set,n==3?(this._endpointPromise=Pi(this.#s,this.#e),this._endpointPromise.then(i=>this._endpoint=i,i=>this.#n(i))):(this._endpointPromise=Promise.resolve(qt),this._endpointPromise.then(i=>this._endpoint=i,i=>this.#n(i)))}async getVersion(){return this._endpoint!==void 0?this._endpoint.version:(await this._endpointPromise).version}_ensureVersion(e,s){if(!(e<=qt.version)){if(this._endpoint===void 0)throw new be(`${s} is supported only on protocol version ${e} and higher, but the version supported by the HTTP server is not yet known. Use Client.getVersion() to wait until the version is available.`);if(this._endpoint.version<e)throw new be(`${s} is supported only on protocol version ${e} and higher, but the HTTP server only supports version ${this._endpoint.version}.`)}}openStream(){if(this.#r!==void 0)throw new K("Client is closed",this.#r);const e=new $i(this,this.#e,this.#t,this.#s);return this.#i.add(e),e}_streamClosed(e){this.#i.delete(e)}close(){this.#n(new T("Client was manually closed"))}get closed(){return this.#r!==void 0}#n(e){if(this.#r===void 0){this.#r=e;for(const s of Array.from(this.#i))s._setClosed(new K("Client was closed",e))}}};async function Pi(t,e){const s=t;for(const r of Qi){const n=new URL(r.versionPath,e),i=new tr(n.toString(),{method:"GET"}),o=await s(i);if(await o.arrayBuffer(),o.ok)return r}return qt}function sr(t,e,s=2){if(typeof de>"u")throw new $s("WebSockets are not supported in this environment");var r=void 0;s==3?r=Array.from(er.keys()):r=Array.from(Xn.keys());const n=new de(t,r);return new ei(n,e)}function Ui(t,e,s,r=2){return new Bi(t instanceof URL?t:new URL(t),e,s,r)}class rr{#e;#t;#s;constructor(e,s){this.#e=e,this.#t=s,this.#s=void 0}execute(e){return this.batch([e]).then(s=>s[0])}async batch(e){const s=this._getStream();if(s.closed)throw new q("Cannot execute statements because the transaction is closed","TRANSACTION_CLOSED");try{const r=e.map(Qe);let n;if(this.#s===void 0){this._getSqlCache().apply(r);const o=s.batch(this.#t>=3),a=o.step(),l=a.run(pt(this.#e));let c=a;n=r.map(h=>{const p=o.step().condition(D.ok(c));this.#t>=3&&p.condition(D.not(D.isAutocommit(o)));const b=p.query(h);return b.catch(()=>{}),c=p,b}),this.#s=o.execute().then(()=>l).then(()=>{});try{await this.#s}catch(h){throw this.close(),h}}else{this.#t<3&&await this.#s,this._getSqlCache().apply(r);const o=s.batch(this.#t>=3);let a;n=r.map(l=>{const c=o.step();a!==void 0&&c.condition(D.ok(a)),this.#t>=3&&c.condition(D.not(D.isAutocommit(o)));const h=c.query(l);return h.catch(()=>{}),a=c,h}),await o.execute()}const i=[];for(const o of n){const a=await o;if(a===void 0)throw new q("Statement in a transaction was not executed, probably because the transaction has been rolled back","TRANSACTION_CLOSED");i.push(tt(a))}return i}catch(r){throw O(r)}}async executeMultiple(e){const s=this._getStream();if(s.closed)throw new q("Cannot execute statements because the transaction is closed","TRANSACTION_CLOSED");try{if(this.#s===void 0){this.#s=s.run(pt(this.#e)).then(()=>{});try{await this.#s}catch(r){throw this.close(),r}}else await this.#s;await s.sequence(e)}catch(r){throw O(r)}}async rollback(){try{const e=this._getStream();if(e.closed||this.#s===void 0)return;const s=e.run("ROLLBACK").catch(r=>{throw O(r)});e.closeGracefully(),await s}catch(e){throw O(e)}finally{this.close()}}async commit(){try{const e=this._getStream();if(e.closed)throw new q("Cannot commit the transaction because it is already closed","TRANSACTION_CLOSED");if(this.#s!==void 0)await this.#s;else return;const s=e.run("COMMIT").catch(r=>{throw O(r)});e.closeGracefully(),await s}catch(e){throw O(e)}finally{this.close()}}}async function nr(t,e,s,r){const n=s.step(),i=n.run(pt(t));let o=n;const a=r.map(b=>{const _=s.step().condition(D.ok(o));e>=3&&_.condition(D.not(D.isAutocommit(s)));const x=_.query(b);return o=_,x}),l=s.step().condition(D.ok(o));e>=3&&l.condition(D.not(D.isAutocommit(s)));const c=l.run("COMMIT");s.step().condition(D.not(D.ok(l))).run("ROLLBACK").catch(b=>{}),await s.execute();const p=[];await i;for(const b of a){const _=await b;if(_===void 0)throw new q("Statement in a batch was not executed, probably because the transaction has been rolled back","TRANSACTION_CLOSED");p.push(tt(_))}return await c,p}function Qe(t){if(typeof t=="string")return new gt(t);const e=new gt(t.sql);if(Array.isArray(t.args))e.bindIndexes(t.args);else for(const[s,r]of Object.entries(t.args))e.bindName(s,r);return e}function tt(t){const e=t.columnNames.map(o=>o??""),s=t.columnDecltypes.map(o=>o??""),r=t.rows,n=t.affectedRowCount,i=t.lastInsertRowid!==void 0?t.lastInsertRowid:void 0;return new Kr(e,s,r,n,i)}function O(t){if(t instanceof T){const e=ir(t);return new q(t.message,e,void 0,t)}return t}function ir(t){return t instanceof Ls&&t.code!==void 0?t.code:t instanceof w?"HRANA_PROTO_ERROR":t instanceof K?t.cause instanceof T?ir(t.cause):"HRANA_CLOSED_ERROR":t instanceof mt?"HRANA_WEBSOCKET_ERROR":t instanceof Es?"SERVER_ERROR":t instanceof be?"PROTOCOL_VERSION_ERROR":t instanceof se?"INTERNAL_ERROR":"UNKNOWN"}class Ut{#e;#t;capacity;constructor(e,s){this.#e=e,this.#t=new ji,this.capacity=s}apply(e){if(this.capacity<=0)return;const s=new Set;for(const r of e){if(typeof r.sql!="string")continue;const n=r.sql;let i=this.#t.get(n);if(i===void 0){for(;this.#t.size+1>this.capacity;){const[o,a]=this.#t.peekLru();if(s.has(a))break;a.close(),this.#t.delete(o)}this.#t.size+1<=this.capacity&&(i=this.#e.storeSql(n),this.#t.set(n,i))}i!==void 0&&(r.sql=i,s.add(i))}}}class ji{#e;constructor(){this.#e=new Map}get(e){const s=this.#e.get(e);return s!==void 0&&(this.#e.delete(e),this.#e.set(e,s)),s}set(e,s){this.#e.set(e,s)}peekLru(){for(const e of this.#e.entries())return e}delete(e){this.#e.delete(e)}get size(){return this.#e.size}}function ki(t){if(t.scheme!=="wss"&&t.scheme!=="ws")throw new q(`The WebSocket client supports only "libsql:", "wss:" and "ws:" URLs, got ${JSON.stringify(t.scheme+":")}. For more information, please read ${ve}`,"URL_SCHEME_NOT_SUPPORTED");if(t.encryptionKey!==void 0)throw new q("Encryption key is not supported by the remote client.","ENCRYPTION_KEY_NOT_SUPPORTED");if(t.scheme==="ws"&&t.tls)throw new q('A "ws:" URL cannot opt into TLS by using ?tls=1',"URL_INVALID");if(t.scheme==="wss"&&!t.tls)throw new q('A "wss:" URL cannot opt out of TLS by using ?tls=0',"URL_INVALID");const e=ht(t.scheme,t.authority,t.path);let s;try{s=sr(e,t.authToken)}catch(r){if(r instanceof $s){const n=t.scheme==="wss"?"https":"http",i=ht(n,t.authority,t.path);throw new q(`This environment does not support WebSockets, please switch to the HTTP client by using a "${n}:" URL (${JSON.stringify(i)}). For more information, please read ${ve}`,"WEBSOCKETS_NOT_SUPPORTED")}throw O(r)}return new Fi(s,e,t.authToken,t.intMode)}const Di=60*1e3,Mi=100;class Fi{#e;#t;#s;#r;#i;closed;protocol;constructor(e,s,r,n){this.#e=s,this.#t=r,this.#s=n,this.#r=this.#o(e),this.#i=void 0,this.closed=!1,this.protocol="ws"}async execute(e){const s=await this.#n();try{const r=Qe(e);s.conn.sqlCache.apply([r]);const n=s.stream.query(r);return s.stream.closeGracefully(),tt(await n)}catch(r){throw O(r)}finally{this._closeStream(s)}}async batch(e,s="deferred"){const r=await this.#n();try{const n=e.map(Qe),i=await r.conn.client.getVersion();r.conn.sqlCache.apply(n);const o=r.stream.batch(i>=3);return await nr(s,i,o,n)}catch(n){throw O(n)}finally{this._closeStream(r)}}async transaction(e="write"){const s=await this.#n();try{const r=await s.conn.client.getVersion();return new Vi(this,s,e,r)}catch(r){throw this._closeStream(s),O(r)}}async executeMultiple(e){const s=await this.#n();try{const r=s.stream.sequence(e);s.stream.closeGracefully(),await r}catch(r){throw O(r)}finally{this._closeStream(s)}}sync(){return Promise.resolve()}async#n(){if(this.closed)throw new q("The client is closed","CLIENT_CLOSED");if(new Date().valueOf()-this.#r.openTime.valueOf()>Di&&this.#i===void 0){const n=this.#o();this.#i=n,n.client.getVersion().then(i=>{this.#r!==n&&this.#r.streamStates.size===0&&this.#r.client.close(),this.#r=n,this.#i=void 0},i=>{this.#i=void 0})}if(this.#r.client.closed)try{this.#i!==void 0?this.#r=this.#i:this.#r=this.#o()}catch(n){throw O(n)}const r=this.#r;try{r.useSqlCache===void 0&&(r.useSqlCache=await r.client.getVersion()>=2,r.useSqlCache&&(r.sqlCache.capacity=Mi));const n=r.client.openStream();n.intMode=this.#s;const i={conn:r,stream:n};return r.streamStates.add(i),i}catch(n){throw O(n)}}#o(e){try{return e??=sr(this.#e,this.#t),{client:e,useSqlCache:void 0,sqlCache:new Ut(e,0),openTime:new Date,streamStates:new Set}}catch(s){throw O(s)}}_closeStream(e){e.stream.close();const s=e.conn;s.streamStates.delete(e),s.streamStates.size===0&&s!==this.#r&&s.client.close()}close(){this.#r.client.close(),this.closed=!0}}class Vi extends rr{#e;#t;constructor(e,s,r,n){super(r,n),this.#e=e,this.#t=s}_getStream(){return this.#t.stream}_getSqlCache(){return this.#t.conn.sqlCache}close(){this.#e._closeStream(this.#t)}get closed(){return this.#t.stream.closed}}function zi(t){if(t.scheme!=="https"&&t.scheme!=="http")throw new q(`The HTTP client supports only "libsql:", "https:" and "http:" URLs, got ${JSON.stringify(t.scheme+":")}. For more information, please read ${ve}`,"URL_SCHEME_NOT_SUPPORTED");if(t.encryptionKey!==void 0)throw new q("Encryption key is not supported by the remote client.","ENCRYPTION_KEY_NOT_SUPPORTED");if(t.scheme==="http"&&t.tls)throw new q('A "http:" URL cannot opt into TLS by using ?tls=1',"URL_INVALID");if(t.scheme==="https"&&!t.tls)throw new q('A "https:" URL cannot opt out of TLS by using ?tls=0',"URL_INVALID");const e=ht(t.scheme,t.authority,t.path);return new Ki(e,t.authToken,t.intMode,t.fetch)}const or=30;class Ki{#e;protocol;constructor(e,s,r,n){this.#e=Ui(e,s,n),this.#e.intMode=r,this.protocol="http"}async execute(e){try{const s=Qe(e);let r;const n=this.#e.openStream();try{r=n.query(s)}finally{n.closeGracefully()}return tt(await r)}catch(s){throw O(s)}}async batch(e,s="deferred"){try{const r=e.map(Qe),n=await this.#e.getVersion();let i;const o=this.#e.openStream();try{new Ut(o,or).apply(r);const l=o.batch(!1);i=nr(s,n,l,r)}finally{o.closeGracefully()}return await i}catch(r){throw O(r)}}async transaction(e="write"){try{const s=await this.#e.getVersion();return new Ji(this.#e.openStream(),e,s)}catch(s){throw O(s)}}async executeMultiple(e){try{let s;const r=this.#e.openStream();try{s=r.sequence(e)}finally{r.closeGracefully()}await s}catch(s){throw O(s)}}sync(){throw new q("sync not supported in http mode","SYNC_NOT_SUPPORTED")}close(){this.#e.close()}get closed(){return this.#e.closed}}class Ji extends rr{#e;#t;constructor(e,s,r){super(s,r),this.#e=e,this.#t=new Ut(e,or)}_getStream(){return this.#e}_getSqlCache(){return this.#t}close(){this.#e.close()}get closed(){return this.#e.closed}}function Hi(t){return Wi(Wr(t))}function Wi(t){if(t.scheme==="ws"||t.scheme==="wss")return ki(t);if(t.scheme==="http"||t.scheme==="https")return zi(t);throw new q(`The client that uses Web standard APIs supports only "libsql:", "wss:", "ws:", "https:" and "http:" URLs, got ${JSON.stringify(t.scheme+":")}. For more information, please read ${ve}`,"URL_SCHEME_NOT_SUPPORTED")}const Gi="libsql://metrics-nps-gastongithubb.turso.io",Yi="eyJhbGciOiJFZERTQSIsInR5cCI6IkpXVCJ9.eyJpYXQiOjE3MjA0MjIzMzEsImlkIjoiYjI2MjM2YmUtYWExYS00YzY4LTk2MDktZDg3NDNhZGUxODViIn0.eVKyqlI0gQL5-3784YWx1Y1ahydflRAxG-KSbUrtFAD6dE05O8sUW93pGj_wcpNMDw3C22tcvDc2bw1F8zYEAw",Zi=Hi({url:Gi,authToken:Yi}),f=Symbol.for("drizzle:entityKind");function d(t,e){if(!t||typeof t!="object")return!1;if(t instanceof e)return!0;if(!Object.prototype.hasOwnProperty.call(e,f))throw new Error(`Class "${e.name??"<unknown>"}" doesn't look like a Drizzle entity. If this is incorrect and the class is provided by Drizzle, please report this as a bug.`);let s=t.constructor;if(s)for(;s;){if(f in s&&s[f]===e[f])return!0;s=Object.getPrototypeOf(s)}return!1}class Xi{static[f]="ConsoleLogWriter";write(e){console.log(e)}}class eo{static[f]="DefaultLogger";writer;constructor(e){this.writer=e?.writer??new Xi}logQuery(e,s){const r=s.map(i=>{try{return JSON.stringify(i)}catch{return String(i)}}),n=r.length?` -- params: [${r.join(", ")}]`:"";this.writer.write(`Query: ${e}${n}`)}}class to{static[f]="NoopLogger";logQuery(){}}const ze=Symbol.for("drizzle:Name"),at=Symbol.for("drizzle:Schema"),rs=Symbol.for("drizzle:Columns"),lt=Symbol.for("drizzle:OriginalName"),ut=Symbol.for("drizzle:BaseName"),ns=Symbol.for("drizzle:IsAlias"),is=Symbol.for("drizzle:ExtraConfigBuilder"),ar=Symbol.for("drizzle:IsDrizzleTable");class m{static[f]="Table";static Symbol={Name:ze,Schema:at,OriginalName:lt,Columns:rs,BaseName:ut,IsAlias:ns,ExtraConfigBuilder:is};[ze];[lt];[at];[rs];[ut];[ns]=!1;[is]=void 0;[ar]=!0;constructor(e,s,r){this[ze]=this[lt]=e,this[at]=s,this[ut]=r}}function so(t){return typeof t=="object"&&t!==null&&ar in t}function pe(t){return t[ze]}class Q{constructor(e,s){this.table=e,this.config=s,this.name=s.name,this.notNull=s.notNull,this.default=s.default,this.defaultFn=s.defaultFn,this.hasDefault=s.hasDefault,this.primary=s.primaryKey,this.isUnique=s.isUnique,this.uniqueName=s.uniqueName,this.uniqueType=s.uniqueType,this.dataType=s.dataType,this.columnType=s.columnType}static[f]="Column";name;primary;notNull;default;defaultFn;hasDefault;isUnique;uniqueName;uniqueType;dataType;columnType;enumValues=void 0;config;mapFromDriverValue(e){return e}mapToDriverValue(e){return e}}const os=Symbol.for("drizzle:PgInlineForeignKeys");class ro extends m{static[f]="PgTable";static Symbol=Object.assign({},m.Symbol,{InlineForeignKeys:os});[os]=[];[m.Symbol.ExtraConfigBuilder]=void 0}class no{static[f]="PgPrimaryKeyBuilder";columns;name;constructor(e,s){this.columns=e,this.name=s}build(e){return new io(e,this.columns,this.name)}}class io{constructor(e,s,r){this.table=e,this.columns=s,this.name=r}static[f]="PgPrimaryKey";columns;name;getName(){return this.name??`${this.table[ro.Symbol.Name]}_${this.columns.map(e=>e.name).join("_")}_pk`}}const k=Symbol.for("drizzle:SubqueryConfig");class Y{static[f]="Subquery";[k];constructor(e,s,r,n=!1){this[k]={sql:e,selection:s,alias:r,isWith:n}}}class lr extends Y{static[f]="WithSubquery"}const oo={startActiveSpan(t,e){return e()}},M=Symbol.for("drizzle:ViewBaseConfig");function ur(t){return typeof t=="object"&&t!==null&&"getSQL"in t&&typeof t.getSQL=="function"}function ao(t){const e={sql:"",params:[]};for(const s of t)e.sql+=s.sql,e.params.push(...s.params),s.typings?.length&&(e.typings||(e.typings=[]),e.typings.push(...s.typings));return e}class P{static[f]="StringChunk";value;constructor(e){this.value=Array.isArray(e)?e:[e]}getSQL(){return new y([this])}}class y{constructor(e){this.queryChunks=e}static[f]="SQL";decoder=cr;shouldInlineParams=!1;append(e){return this.queryChunks.push(...e.queryChunks),this}toQuery(e){return oo.startActiveSpan("drizzle.buildSQL",s=>{const r=this.buildQueryFromSourceParams(this.queryChunks,e);return s?.setAttributes({"drizzle.query.text":r.sql,"drizzle.query.params":JSON.stringify(r.params)}),r})}buildQueryFromSourceParams(e,s){const r=Object.assign({},s,{inlineParams:s.inlineParams||this.shouldInlineParams,paramStartIndex:s.paramStartIndex||{value:0}}),{escapeName:n,escapeParam:i,prepareTyping:o,inlineParams:a,paramStartIndex:l}=r;return ao(e.map(c=>{if(d(c,P))return{sql:c.value.join(""),params:[]};if(d(c,_t))return{sql:n(c.value),params:[]};if(c===void 0)return{sql:"",params:[]};if(Array.isArray(c)){const h=[new P("(")];for(const[p,b]of c.entries())h.push(b),p<c.length-1&&h.push(new P(", "));return h.push(new P(")")),this.buildQueryFromSourceParams(h,r)}if(d(c,y))return this.buildQueryFromSourceParams(c.queryChunks,{...r,inlineParams:a||c.shouldInlineParams});if(d(c,m)){const h=c[m.Symbol.Schema],p=c[m.Symbol.Name];return{sql:h===void 0?n(p):n(h)+"."+n(p),params:[]}}if(d(c,Q))return{sql:n(c.table[m.Symbol.Name])+"."+n(c.name),params:[]};if(d(c,Re)){const h=c[M].schema,p=c[M].name;return{sql:h===void 0?n(p):n(h)+"."+n(p),params:[]}}if(d(c,ae)){const h=c.value===null?null:c.encoder.mapToDriverValue(c.value);if(d(h,y))return this.buildQueryFromSourceParams([h],r);if(a)return{sql:this.mapInlineParam(h,r),params:[]};let p;return o!==void 0&&(p=[o(c.encoder)]),{sql:i(l.value++,h),params:[h],typings:p}}return d(c,st)?{sql:i(l.value++,c),params:[c]}:d(c,y.Aliased)&&c.fieldAlias!==void 0?{sql:n(c.fieldAlias),params:[]}:d(c,Y)?c[k].isWith?{sql:n(c[k].alias),params:[]}:this.buildQueryFromSourceParams([new P("("),c[k].sql,new P(") "),new _t(c[k].alias)],r):ur(c)?this.buildQueryFromSourceParams([new P("("),c.getSQL(),new P(")")],r):a?{sql:this.mapInlineParam(c,r),params:[]}:{sql:i(l.value++,c),params:[c]}}))}mapInlineParam(e,{escapeString:s}){if(e===null)return"null";if(typeof e=="number"||typeof e=="boolean")return e.toString();if(typeof e=="string")return s(e);if(typeof e=="object"){const r=e.toString();return s(r==="[object Object]"?JSON.stringify(e):r)}throw new Error("Unexpected param value: "+e)}getSQL(){return this}as(e){return e===void 0?this:new y.Aliased(this,e)}mapWith(e){return this.decoder=typeof e=="function"?{mapFromDriverValue:e}:e,this}inlineParams(){return this.shouldInlineParams=!0,this}}class _t{constructor(e){this.value=e}static[f]="Name";brand;getSQL(){return new y([this])}}function lo(t){return typeof t=="object"&&t!==null&&"mapToDriverValue"in t&&typeof t.mapToDriverValue=="function"}const cr={mapFromDriverValue:t=>t},hr={mapToDriverValue:t=>t};({...cr,...hr});class ae{constructor(e,s=hr){this.value=e,this.encoder=s}static[f]="Param";brand;getSQL(){return new y([this])}}function u(t,...e){const s=[];(e.length>0||t.length>0&&t[0]!=="")&&s.push(new P(t[0]));for(const[r,n]of e.entries())s.push(n,new P(t[r+1]));return new y(s)}(t=>{function e(){return new y([])}t.empty=e;function s(l){return new y(l)}t.fromList=s;function r(l){return new y([new P(l)])}t.raw=r;function n(l,c){const h=[];for(const[p,b]of l.entries())p>0&&c!==void 0&&h.push(c),h.push(b);return new y(h)}t.join=n;function i(l){return new _t(l)}t.identifier=i;function o(l){return new st(l)}t.placeholder=o;function a(l,c){return new ae(l,c)}t.param=a})(u||(u={}));(t=>{class e{constructor(r,n){this.sql=r,this.fieldAlias=n}static[f]="SQL.Aliased";isSelectionField=!1;getSQL(){return this.sql}clone(){return new e(this.sql,this.fieldAlias)}}t.Aliased=e})(y||(y={}));class st{constructor(e){this.name=e}static[f]="Placeholder";getSQL(){return new y([this])}}function De(t,e){return t.map(s=>{if(d(s,st)){if(!(s.name in e))throw new Error(`No value for placeholder "${s.name}" was provided`);return e[s.name]}return s})}class Re{static[f]="View";[M];constructor({name:e,schema:s,selectedFields:r,query:n}){this[M]={name:e,originalName:e,schema:s,selectedFields:r,query:n,isExisting:!n,isAlias:!1}}getSQL(){return new y([this])}}Q.prototype.getSQL=function(){return new y([this])};m.prototype.getSQL=function(){return new y([this])};Y.prototype.getSQL=function(){return new y([this])};function F(t,e){return lo(e)&&!ur(t)&&!d(t,ae)&&!d(t,st)&&!d(t,Q)&&!d(t,m)&&!d(t,Re)?new ae(t,e):t}const dr=(t,e)=>u`${t} = ${F(e,t)}`,uo=(t,e)=>u`${t} <> ${F(e,t)}`;function xt(...t){const e=t.filter(s=>s!==void 0);if(e.length!==0)return e.length===1?new y(e):new y([new P("("),u.join(e,new P(" and ")),new P(")")])}function co(...t){const e=t.filter(s=>s!==void 0);if(e.length!==0)return e.length===1?new y(e):new y([new P("("),u.join(e,new P(" or ")),new P(")")])}function ho(t){return u`not ${t}`}const fo=(t,e)=>u`${t} > ${F(e,t)}`,po=(t,e)=>u`${t} >= ${F(e,t)}`,mo=(t,e)=>u`${t} < ${F(e,t)}`,yo=(t,e)=>u`${t} <= ${F(e,t)}`;function bo(t,e){if(Array.isArray(e)){if(e.length===0)throw new Error("inArray requires at least one value");return u`${t} in ${e.map(s=>F(s,t))}`}return u`${t} in ${F(e,t)}`}function wo(t,e){if(Array.isArray(e)){if(e.length===0)throw new Error("notInArray requires at least one value");return u`${t} not in ${e.map(s=>F(s,t))}`}return u`${t} not in ${F(e,t)}`}function go(t){return u`${t} is null`}function So(t){return u`${t} is not null`}function qo(t){return u`exists ${t}`}function _o(t){return u`not exists ${t}`}function xo(t,e,s){return u`${t} between ${F(e,t)} and ${F(s,t)}`}function Ro(t,e,s){return u`${t} not between ${F(e,t)} and ${F(s,t)}`}function Co(t,e){return u`${t} like ${e}`}function To(t,e){return u`${t} not like ${e}`}function Io(t,e){return u`${t} ilike ${e}`}function No(t,e){return u`${t} not ilike ${e}`}function Ao(t){return u`${t} asc`}function Lo(t){return u`${t} desc`}class fr{constructor(e,s,r){this.sourceTable=e,this.referencedTable=s,this.relationName=r,this.referencedTableName=s[m.Symbol.Name]}static[f]="Relation";referencedTableName;fieldName}class $o{constructor(e,s){this.table=e,this.config=s}static[f]="Relations"}class le extends fr{constructor(e,s,r,n){super(e,s,r?.relationName),this.config=r,this.isNullable=n}static[f]="One";withFieldName(e){const s=new le(this.sourceTable,this.referencedTable,this.config,this.isNullable);return s.fieldName=e,s}}class rt extends fr{constructor(e,s,r){super(e,s,r?.relationName),this.config=r}static[f]="Many";withFieldName(e){const s=new rt(this.sourceTable,this.referencedTable,this.config);return s.fieldName=e,s}}function Eo(){return{and:xt,between:xo,eq:dr,exists:qo,gt:fo,gte:po,ilike:Io,inArray:bo,isNull:go,isNotNull:So,like:Co,lt:mo,lte:yo,ne:uo,not:ho,notBetween:Ro,notExists:_o,notLike:To,notIlike:No,notInArray:wo,or:co,sql:u}}function vo(){return{sql:u,asc:Ao,desc:Lo}}function Oo(t,e){Object.keys(t).length===1&&"default"in t&&!d(t.default,m)&&(t=t.default);const s={},r={},n={};for(const[i,o]of Object.entries(t))if(so(o)){const a=o[m.Symbol.Name],l=r[a];s[a]=i,n[i]={tsName:i,dbName:o[m.Symbol.Name],schema:o[m.Symbol.Schema],columns:o[m.Symbol.Columns],relations:l?.relations??{},primaryKey:l?.primaryKey??[]};for(const h of Object.values(o[m.Symbol.Columns]))h.primary&&n[i].primaryKey.push(h);const c=o[m.Symbol.ExtraConfigBuilder]?.(o);if(c)for(const h of Object.values(c))d(h,no)&&n[i].primaryKey.push(...h.columns)}else if(d(o,$o)){const a=o.table[m.Symbol.Name],l=s[a],c=o.config(e(o.table));let h;for(const[p,b]of Object.entries(c))if(l){const _=n[l];_.relations[p]=b}else a in r||(r[a]={relations:{},primaryKey:h}),r[a].relations[p]=b}return{tables:n,tableNamesMap:s}}function Qo(t){return function(s,r){return new le(t,s,r,r?.fields.reduce((n,i)=>n&&i.notNull,!0)??!1)}}function Bo(t){return function(s,r){return new rt(t,s,r)}}function Po(t,e,s){if(d(s,le)&&s.config)return{fields:s.config.fields,references:s.config.references};const r=e[s.referencedTable[m.Symbol.Name]];if(!r)throw new Error(`Table "${s.referencedTable[m.Symbol.Name]}" not found in schema`);const n=t[r];if(!n)throw new Error(`Table "${r}" not found in schema`);const i=s.sourceTable,o=e[i[m.Symbol.Name]];if(!o)throw new Error(`Table "${i[m.Symbol.Name]}" not found in schema`);const a=[];for(const l of Object.values(n.relations))(s.relationName&&s!==l&&l.relationName===s.relationName||!s.relationName&&l.referencedTable===s.sourceTable)&&a.push(l);if(a.length>1)throw s.relationName?new Error(`There are multiple relations with name "${s.relationName}" in table "${r}"`):new Error(`There are multiple relations between "${r}" and "${s.sourceTable[m.Symbol.Name]}". Please specify relation name`);if(a[0]&&d(a[0],le)&&a[0].config)return{fields:a[0].config.references,references:a[0].config.fields};throw new Error(`There is not enough information to infer relation "${o}.${s.fieldName}"`)}function Uo(t){return{one:Qo(t),many:Bo(t)}}function Rt(t,e,s,r,n=i=>i){const i={};for(const[o,a]of r.entries())if(a.isJson){const l=e.relations[a.tsKey],c=s[o],h=typeof c=="string"?JSON.parse(c):c;i[a.tsKey]=d(l,le)?h&&Rt(t,t[a.relationTableTsKey],h,a.selection,n):h.map(p=>Rt(t,t[a.relationTableTsKey],p,a.selection,n))}else{const l=n(s[o]),c=a.field;let h;d(c,Q)?h=c:d(c,y)?h=c.decoder:h=c.sql.decoder,i[a.tsKey]=l===null?null:h.mapFromDriverValue(l)}return i}class Ye{constructor(e){this.table=e}static[f]="ColumnAliasProxyHandler";get(e,s){return s==="table"?this.table:e[s]}}class jt{constructor(e,s){this.alias=e,this.replaceOriginalName=s}static[f]="TableAliasProxyHandler";get(e,s){if(s===m.Symbol.IsAlias)return!0;if(s===m.Symbol.Name)return this.alias;if(this.replaceOriginalName&&s===m.Symbol.OriginalName)return this.alias;if(s===M)return{...e[M],name:this.alias,isAlias:!0};if(s===m.Symbol.Columns){const n=e[m.Symbol.Columns];if(!n)return n;const i={};return Object.keys(n).map(o=>{i[o]=new Proxy(n[o],new Ye(new Proxy(e,this)))}),i}const r=e[s];return d(r,Q)?new Proxy(r,new Ye(new Proxy(e,this))):r}}function ct(t,e){return new Proxy(t,new jt(e,!1))}function X(t,e){return new Proxy(t,new Ye(new Proxy(t.table,new jt(e,!1))))}function pr(t,e){return new y.Aliased(Ze(t.sql,e),t.fieldAlias)}function Ze(t,e){return u.join(t.queryChunks.map(s=>d(s,Q)?X(s,e):d(s,y)?Ze(s,e):d(s,y.Aliased)?pr(s,e):s))}class J{static[f]="SelectionProxyHandler";config;constructor(e){this.config={...e}}get(e,s){if(s===k)return{...e[k],selection:new Proxy(e[k].selection,this)};if(s===M)return{...e[M],selectedFields:new Proxy(e[M].selectedFields,this)};if(typeof s=="symbol")return e[s];const n=(d(e,Y)?e[k].selection:d(e,Re)?e[M].selectedFields:e)[s];if(d(n,y.Aliased)){if(this.config.sqlAliasedBehavior==="sql"&&!n.isSelectionField)return n.sql;const i=n.clone();return i.isSelectionField=!0,i}if(d(n,y)){if(this.config.sqlBehavior==="sql")return n;throw new Error(`You tried to reference "${s}" field from a subquery, which is a raw SQL field, but it doesn't have an alias declared. Please add an alias to the field using ".as('alias')" method.`)}return d(n,Q)?this.config.alias?new Proxy(n,new Ye(new Proxy(n.table,new jt(this.config.alias,this.config.replaceOriginalName??!1)))):n:typeof n!="object"||n===null?n:new Proxy(n,new J(this.config))}}class ce{static[f]="QueryPromise";[Symbol.toStringTag]="QueryPromise";catch(e){return this.then(void 0,e)}finally(e){return this.then(s=>(e?.(),s),s=>{throw e?.(),s})}then(e,s){return this.execute().then(e,s)}}const Ct=Symbol.for("drizzle:SQLiteInlineForeignKeys");class z extends m{static[f]="SQLiteTable";static Symbol=Object.assign({},m.Symbol,{InlineForeignKeys:Ct});[m.Symbol.Columns];[Ct]=[];[m.Symbol.ExtraConfigBuilder]=void 0}function jo(t,e,s,r,n=t){const i=new z(t,r,n),o=Object.fromEntries(Object.entries(e).map(([l,c])=>{const h=c,p=h.build(i);return i[Ct].push(...h.buildForeignKeys(p,i)),[l,p]})),a=Object.assign(i,o);return a[m.Symbol.Columns]=o,a}const ko=(t,e,s)=>jo(t,e);function as(t,e,s){const r={},n=t.reduce((i,{path:o,field:a},l)=>{let c;d(a,Q)?c=a:d(a,y)?c=a.decoder:c=a.sql.decoder;let h=i;for(const[p,b]of o.entries())if(p<o.length-1)b in h||(h[b]={}),h=h[b];else{const _=e[l],x=h[b]=_===null?null:c.mapFromDriverValue(_);if(s&&d(a,Q)&&o.length===2){const C=o[0];C in r?typeof r[C]=="string"&&r[C]!==pe(a.table)&&(r[C]=!1):r[C]=x===null?pe(a.table):!1}}return i},{});if(s&&Object.keys(r).length>0)for(const[i,o]of Object.entries(r))typeof o=="string"&&!s[o]&&(n[i]=null);return n}function ue(t,e){return Object.entries(t).reduce((s,[r,n])=>{if(typeof r!="string")return s;const i=e?[...e,r]:[r];return d(n,Q)||d(n,y)||d(n,y.Aliased)?s.push({path:i,field:n}):d(n,m)?s.push(...ue(n[m.Symbol.Columns],i)):s.push(...ue(n,i)),s},[])}function mr(t,e){const s=Object.keys(t),r=Object.keys(e);if(s.length!==r.length)return!1;for(const[n,i]of s.entries())if(i!==r[n])return!1;return!0}function yr(t,e){const s=Object.entries(e).filter(([,r])=>r!==void 0).map(([r,n])=>d(n,y)?[r,n]:[r,new ae(n,t[m.Symbol.Columns][r])]);if(s.length===0)throw new Error("No values to set");return Object.fromEntries(s)}function Do(t,e){for(const s of e)for(const r of Object.getOwnPropertyNames(s.prototype))r!=="constructor"&&Object.defineProperty(t.prototype,r,Object.getOwnPropertyDescriptor(s.prototype,r)||Object.create(null))}function Mo(t){return t[m.Symbol.Columns]}function ls(t){return d(t,Y)?t[k].alias:d(t,Re)?t[M].name:d(t,y)?void 0:t[m.Symbol.IsAlias]?t[m.Symbol.Name]:t[m.Symbol.BaseName]}class us extends ce{constructor(e,s,r,n){super(),this.table=e,this.session=s,this.dialect=r,this.config={table:e,withList:n}}static[f]="SQLiteDelete";config;where(e){return this.config.where=e,this}returning(e=this.table[z.Symbol.Columns]){return this.config.returning=ue(e),this}getSQL(){return this.dialect.buildDeleteQuery(this.config)}toSQL(){const{typings:e,...s}=this.dialect.sqlToQuery(this.getSQL());return s}_prepare(e=!0){return this.session[e?"prepareOneTimeQuery":"prepareQuery"](this.dialect.sqlToQuery(this.getSQL()),this.config.returning,this.config.returning?"all":"run")}prepare(){return this._prepare(!1)}run=e=>this._prepare().run(e);all=e=>this._prepare().all(e);get=e=>this._prepare().get(e);values=e=>this._prepare().values(e);async execute(e){return this._prepare().execute(e)}$dynamic(){return this}}class cs{constructor(e,s,r,n){this.table=e,this.session=s,this.dialect=r,this.withList=n}static[f]="SQLiteInsertBuilder";values(e){if(e=Array.isArray(e)?e:[e],e.length===0)throw new Error("values() must be called with at least one value");const s=e.map(r=>{const n={},i=this.table[m.Symbol.Columns];for(const o of Object.keys(r)){const a=r[o];n[o]=d(a,y)?a:new ae(a,i[o])}return n});return new Fo(this.table,s,this.session,this.dialect,this.withList)}}class Fo extends ce{constructor(e,s,r,n,i){super(),this.session=r,this.dialect=n,this.config={table:e,values:s,withList:i}}static[f]="SQLiteInsert";config;returning(e=this.config.table[z.Symbol.Columns]){return this.config.returning=ue(e),this}onConflictDoNothing(e={}){if(e.target===void 0)this.config.onConflict=u`do nothing`;else{const s=Array.isArray(e.target)?u`${e.target}`:u`${[e.target]}`,r=e.where?u` where ${e.where}`:u``;this.config.onConflict=u`${s} do nothing${r}`}return this}onConflictDoUpdate(e){const s=Array.isArray(e.target)?u`${e.target}`:u`${[e.target]}`,r=e.where?u` where ${e.where}`:u``,n=this.dialect.buildUpdateSet(this.config.table,yr(this.config.table,e.set));return this.config.onConflict=u`${s} do update set ${n}${r}`,this}getSQL(){return this.dialect.buildInsertQuery(this.config)}toSQL(){const{typings:e,...s}=this.dialect.sqlToQuery(this.getSQL());return s}_prepare(e=!0){return this.session[e?"prepareOneTimeQuery":"prepareQuery"](this.dialect.sqlToQuery(this.getSQL()),this.config.returning,this.config.returning?"all":"run")}prepare(){return this._prepare(!1)}run=e=>this._prepare().run(e);all=e=>this._prepare().all(e);get=e=>this._prepare().get(e);values=e=>this._prepare().values(e);async execute(){return this.config.returning?this.all():this.run()}$dynamic(){return this}}class kt extends Error{static[f]="DrizzleError";constructor({message:e,cause:s}){super(e),this.name="DrizzleError",this.cause=s}}class Vo extends kt{static[f]="TransactionRollbackError";constructor(){super({message:"Rollback"})}}class zo{static[f]="ColumnBuilder";config;constructor(e,s,r){this.config={name:e,notNull:!1,default:void 0,hasDefault:!1,primaryKey:!1,isUnique:!1,uniqueName:void 0,uniqueType:void 0,dataType:s,columnType:r}}$type(){return this}notNull(){return this.config.notNull=!0,this}default(e){return this.config.default=e,this.config.hasDefault=!0,this}$defaultFn(e){return this.config.defaultFn=e,this.config.hasDefault=!0,this}$default=this.$defaultFn;primaryKey(){return this.config.primaryKey=!0,this.config.notNull=!0,this}}class Ko{static[f]="SQLiteForeignKeyBuilder";reference;_onUpdate;_onDelete;constructor(e,s){this.reference=()=>{const{name:r,columns:n,foreignColumns:i}=e();return{name:r,columns:n,foreignTable:i[0].table,foreignColumns:i}},s&&(this._onUpdate=s.onUpdate,this._onDelete=s.onDelete)}onUpdate(e){return this._onUpdate=e,this}onDelete(e){return this._onDelete=e,this}build(e){return new Jo(e,this)}}class Jo{constructor(e,s){this.table=e,this.reference=s.reference,this.onUpdate=s._onUpdate,this.onDelete=s._onDelete}static[f]="SQLiteForeignKey";reference;onUpdate;onDelete;getName(){const{name:e,columns:s,foreignColumns:r}=this.reference(),n=s.map(a=>a.name),i=r.map(a=>a.name),o=[this.table[z.Symbol.Name],...n,r[0].table[z.Symbol.Name],...i];return e??`${o.join("_")}_fk`}}function Ho(t,e){return`${t[z.Symbol.Name]}_${e.join("_")}_unique`}class Dt extends zo{static[f]="SQLiteColumnBuilder";foreignKeyConfigs=[];references(e,s={}){return this.foreignKeyConfigs.push({ref:e,actions:s}),this}unique(e){return this.config.isUnique=!0,this.config.uniqueName=e,this}buildForeignKeys(e,s){return this.foreignKeyConfigs.map(({ref:r,actions:n})=>((i,o)=>{const a=new Ko(()=>{const l=i();return{columns:[e],foreignColumns:[l]}});return o.onUpdate&&a.onUpdate(o.onUpdate),o.onDelete&&a.onDelete(o.onDelete),a.build(s)})(r,n))}}class ye extends Q{constructor(e,s){s.uniqueName||(s.uniqueName=Ho(e,[s.name])),super(e,s),this.table=e}static[f]="SQLiteColumn"}class Mt extends Dt{static[f]="SQLiteBaseIntegerBuilder";constructor(e,s,r){super(e,s,r),this.config.autoIncrement=!1}primaryKey(e){return e?.autoIncrement&&(this.config.autoIncrement=!0),this.config.hasDefault=!0,super.primaryKey()}}class Ft extends ye{static[f]="SQLiteBaseInteger";autoIncrement=this.config.autoIncrement;getSQLType(){return"integer"}}class Wo extends Mt{static[f]="SQLiteIntegerBuilder";constructor(e){super(e,"number","SQLiteInteger")}build(e){return new Go(e,this.config)}}class Go extends Ft{static[f]="SQLiteInteger"}class Yo extends Mt{static[f]="SQLiteTimestampBuilder";constructor(e,s){super(e,"date","SQLiteTimestamp"),this.config.mode=s}defaultNow(){return this.default(u`(cast((julianday('now') - 2440587.5)*86400000 as integer))`)}build(e){return new Zo(e,this.config)}}class Zo extends Ft{static[f]="SQLiteTimestamp";mode=this.config.mode;mapFromDriverValue(e){return this.config.mode==="timestamp"?new Date(e*1e3):new Date(e)}mapToDriverValue(e){const s=e.getTime();return this.config.mode==="timestamp"?Math.floor(s/1e3):s}}class Xo extends Mt{static[f]="SQLiteBooleanBuilder";constructor(e,s){super(e,"boolean","SQLiteBoolean"),this.config.mode=s}build(e){return new ea(e,this.config)}}class ea extends Ft{static[f]="SQLiteBoolean";mode=this.config.mode;mapFromDriverValue(e){return Number(e)===1}mapToDriverValue(e){return e?1:0}}function Ie(t,e){return e?.mode==="timestamp"||e?.mode==="timestamp_ms"?new Yo(t,e.mode):e?.mode==="boolean"?new Xo(t,e.mode):new Wo(t)}class ta extends Dt{static[f]="SQLiteTextBuilder";constructor(e,s){super(e,"string","SQLiteText"),this.config.enumValues=s.enum,this.config.length=s.length}build(e){return new sa(e,this.config)}}class sa extends ye{static[f]="SQLiteText";enumValues=this.config.enumValues;length=this.config.length;constructor(e,s){super(e,s)}getSQLType(){return`text${this.config.length?`(${this.config.length})`:""}`}}class ra extends Dt{static[f]="SQLiteTextJsonBuilder";constructor(e){super(e,"json","SQLiteTextJson")}build(e){return new na(e,this.config)}}class na extends ye{static[f]="SQLiteTextJson";getSQLType(){return"text"}mapFromDriverValue(e){return JSON.parse(e)}mapToDriverValue(e){return JSON.stringify(e)}}function ia(t,e={}){return e.mode==="json"?new ra(t):new ta(t,e)}class br extends Re{static[f]="SQLiteViewBase"}class wr{static[f]="SQLiteDialect";escapeName(e){return`"${e}"`}escapeParam(e){return"?"}escapeString(e){return`'${e.replace(/'/g,"''")}'`}buildWithCTE(e){if(!e?.length)return;const s=[u`with `];for(const[r,n]of e.entries())s.push(u`${u.identifier(n[k].alias)} as (${n[k].sql})`),r<e.length-1&&s.push(u`, `);return s.push(u` `),u.join(s)}buildDeleteQuery({table:e,where:s,returning:r,withList:n}){const i=this.buildWithCTE(n),o=r?u` returning ${this.buildSelection(r,{isSingleTable:!0})}`:void 0,a=s?u` where ${s}`:void 0;return u`${i}delete from ${e}${a}${o}`}buildUpdateSet(e,s){const r=Object.entries(s),n=r.length;return u.join(r.flatMap(([i,o],a)=>{const l=e[m.Symbol.Columns][i],c=u`${u.identifier(l.name)} = ${o}`;return a<n-1?[c,u.raw(", ")]:[c]}))}buildUpdateQuery({table:e,set:s,where:r,returning:n,withList:i}){const o=this.buildWithCTE(i),a=this.buildUpdateSet(e,s),l=n?u` returning ${this.buildSelection(n,{isSingleTable:!0})}`:void 0,c=r?u` where ${r}`:void 0;return u`${o}update ${e} set ${a}${c}${l}`}buildSelection(e,{isSingleTable:s=!1}={}){const r=e.length,n=e.flatMap(({field:i},o)=>{const a=[];if(d(i,y.Aliased)&&i.isSelectionField)a.push(u.identifier(i.fieldAlias));else if(d(i,y.Aliased)||d(i,y)){const l=d(i,y.Aliased)?i.sql:i;s?a.push(new y(l.queryChunks.map(c=>d(c,Q)?u.identifier(c.name):c))):a.push(l),d(i,y.Aliased)&&a.push(u` as ${u.identifier(i.fieldAlias)}`)}else if(d(i,Q)){const l=i.table[m.Symbol.Name],c=i.name;s?a.push(u.identifier(c)):a.push(u`${u.identifier(l)}.${u.identifier(c)}`)}return o<r-1&&a.push(u`, `),a});return u.join(n)}buildSelectQuery({withList:e,fields:s,fieldsFlat:r,where:n,having:i,table:o,joins:a,orderBy:l,groupBy:c,limit:h,offset:p,distinct:b,setOperators:_}){const x=r??ue(s);for(const j of x)if(d(j.field,Q)&&pe(j.field.table)!==(d(o,Y)?o[k].alias:d(o,br)?o[M].name:d(o,y)?void 0:pe(o))&&!(E=>a?.some(({alias:Z})=>Z===(E[m.Symbol.IsAlias]?pe(E):E[m.Symbol.BaseName])))(j.field.table)){const E=pe(j.field.table);throw new Error(`Your "${j.path.join("->")}" field references a column "${E}"."${j.field.name}", but the table "${E}" is not part of the query! Did you forget to join it?`)}const C=!a||a.length===0,A=this.buildWithCTE(e),L=b?u` distinct`:void 0,$=this.buildSelection(x,{isSingleTable:C}),v=d(o,m)&&o[m.Symbol.OriginalName]!==o[m.Symbol.Name]?u`${u.identifier(o[m.Symbol.OriginalName])} ${u.identifier(o[m.Symbol.Name])}`:o,R=[];if(a)for(const[j,E]of a.entries()){j===0&&R.push(u` `);const Z=E.table;if(d(Z,z)){const ot=Z[z.Symbol.Name],Kt=Z[z.Symbol.Schema],Jt=Z[z.Symbol.OriginalName],Ht=ot===Jt?void 0:E.alias;R.push(u`${u.raw(E.joinType)} join ${Kt?u`${u.identifier(Kt)}.`:void 0}${u.identifier(Jt)}${Ht&&u` ${u.identifier(Ht)}`} on ${E.on}`)}else R.push(u`${u.raw(E.joinType)} join ${Z} on ${E.on}`);j<a.length-1&&R.push(u` `)}const ee=u.join(R),he=n?u` where ${n}`:void 0,g=i?u` having ${i}`:void 0,S=[];if(l)for(const[j,E]of l.entries())S.push(E),j<l.length-1&&S.push(u`, `);const V=[];if(c)for(const[j,E]of c.entries())V.push(E),j<c.length-1&&V.push(u`, `);const Pe=V.length>0?u` group by ${u.join(V)}`:void 0,it=S.length>0?u` order by ${u.join(S)}`:void 0,Ce=h?u` limit ${h}`:void 0,Ue=p?u` offset ${p}`:void 0,je=u`${A}select${L} ${$} from ${v}${ee}${he}${Pe}${g}${it}${Ce}${Ue}`;return _.length>0?this.buildSetOperations(je,_):je}buildSetOperations(e,s){const[r,...n]=s;if(!r)throw new Error("Cannot pass undefined values to any set operator");return n.length===0?this.buildSetOperationQuery({leftSelect:e,setOperator:r}):this.buildSetOperations(this.buildSetOperationQuery({leftSelect:e,setOperator:r}),n)}buildSetOperationQuery({leftSelect:e,setOperator:{type:s,isAll:r,rightSelect:n,limit:i,orderBy:o,offset:a}}){const l=u`${e.getSQL()} `,c=u`${n.getSQL()}`;let h;if(o&&o.length>0){const x=[];for(const C of o)if(d(C,ye))x.push(u.identifier(C.name));else if(d(C,y)){for(let A=0;A<C.queryChunks.length;A++){const L=C.queryChunks[A];d(L,ye)&&(C.queryChunks[A]=u.identifier(L.name))}x.push(u`${C}`)}else x.push(u`${C}`);h=u` order by ${u.join(x,u`, `)}`}const p=i?u` limit ${i}`:void 0,b=u.raw(`${s} ${r?"all ":""}`),_=a?u` offset ${a}`:void 0;return u`${l}${b}${c}${h}${p}${_}`}buildInsertQuery({table:e,values:s,onConflict:r,returning:n,withList:i}){const o=[],a=e[m.Symbol.Columns],l=Object.entries(a),c=l.map(([,x])=>u.identifier(x.name));for(const[x,C]of s.entries()){const A=[];for(const[L,$]of l){const v=C[L];if(v===void 0||d(v,ae)&&v.value===void 0){let R;if($.default!==null&&$.default!==void 0)R=d($.default,y)?$.default:u.param($.default,$);else if($.defaultFn!==void 0){const ee=$.defaultFn();R=d(ee,y)?ee:u.param(ee,$)}else R=u`null`;A.push(R)}else A.push(v)}o.push(A),x<s.length-1&&o.push(u`, `)}const h=this.buildWithCTE(i),p=u.join(o),b=n?u` returning ${this.buildSelection(n,{isSingleTable:!0})}`:void 0,_=r?u` on conflict ${r}`:void 0;return u`${h}insert into ${e} ${c} values ${p}${_}${b}`}sqlToQuery(e){return e.toQuery({escapeName:this.escapeName,escapeParam:this.escapeParam,escapeString:this.escapeString})}buildRelationalQuery({fullSchema:e,schema:s,tableNamesMap:r,table:n,tableConfig:i,queryConfig:o,tableAlias:a,nestedQueryRelation:l,joinOn:c}){let h=[],p,b,_=[],x;const C=[];if(o===!0)h=Object.entries(i.columns).map(([$,v])=>({dbKey:v.name,tsKey:$,field:X(v,a),relationTableTsKey:void 0,isJson:!1,selection:[]}));else{const L=Object.fromEntries(Object.entries(i.columns).map(([g,S])=>[g,X(S,a)]));if(o.where){const g=typeof o.where=="function"?o.where(L,Eo()):o.where;x=g&&Ze(g,a)}const $=[];let v=[];if(o.columns){let g=!1;for(const[S,V]of Object.entries(o.columns))V!==void 0&&S in i.columns&&(!g&&V===!0&&(g=!0),v.push(S));v.length>0&&(v=g?v.filter(S=>o.columns?.[S]===!0):Object.keys(i.columns).filter(S=>!v.includes(S)))}else v=Object.keys(i.columns);for(const g of v){const S=i.columns[g];$.push({tsKey:g,value:S})}let R=[];o.with&&(R=Object.entries(o.with).filter(g=>!!g[1]).map(([g,S])=>({tsKey:g,queryConfig:S,relation:i.relations[g]})));let ee;if(o.extras){ee=typeof o.extras=="function"?o.extras(L,{sql:u}):o.extras;for(const[g,S]of Object.entries(ee))$.push({tsKey:g,value:pr(S,a)})}for(const{tsKey:g,value:S}of $)h.push({dbKey:d(S,y.Aliased)?S.fieldAlias:i.columns[g].name,tsKey:g,field:d(S,Q)?X(S,a):S,relationTableTsKey:void 0,isJson:!1,selection:[]});let he=typeof o.orderBy=="function"?o.orderBy(L,vo()):o.orderBy??[];Array.isArray(he)||(he=[he]),_=he.map(g=>d(g,Q)?X(g,a):Ze(g,a)),p=o.limit,b=o.offset;for(const{tsKey:g,queryConfig:S,relation:V}of R){const Pe=Po(s,r,V),it=V.referencedTable[m.Symbol.Name],Ce=r[it],Ue=`${a}_${g}`,je=xt(...Pe.fields.map((Z,ot)=>dr(X(Pe.references[ot],Ue),X(Z,a)))),j=this.buildRelationalQuery({fullSchema:e,schema:s,tableNamesMap:r,table:e[Ce],tableConfig:s[Ce],queryConfig:d(V,le)?S===!0?{limit:1}:{...S,limit:1}:S,tableAlias:Ue,joinOn:je,nestedQueryRelation:V}),E=u`(${j.sql})`.as(g);h.push({dbKey:g,tsKey:g,field:E,relationTableTsKey:Ce,isJson:!0,selection:j.selection})}}if(h.length===0)throw new kt({message:`No fields selected for table "${i.tsName}" ("${a}"). You need to have at least one item in "columns", "with" or "extras". If you need to select all columns, omit the "columns" key or set it to undefined.`});let A;if(x=xt(c,x),l){let L=u`json_array(${u.join(h.map(({field:R})=>d(R,ye)?u.identifier(R.name):d(R,y.Aliased)?R.sql:R),u`, `)})`;d(l,rt)&&(L=u`coalesce(json_group_array(${L}), json_array())`);const $=[{dbKey:"data",tsKey:"data",field:L.as("data"),isJson:!0,relationTableTsKey:i.tsName,selection:h}];p!==void 0||b!==void 0||_.length>0?(A=this.buildSelectQuery({table:ct(n,a),fields:{},fieldsFlat:[{path:[],field:u.raw("*")}],where:x,limit:p,offset:b,orderBy:_,setOperators:[]}),x=void 0,p=void 0,b=void 0,_=void 0):A=ct(n,a),A=this.buildSelectQuery({table:d(A,z)?A:new Y(A,{},a),fields:{},fieldsFlat:$.map(({field:R})=>({path:[],field:d(R,Q)?X(R,a):R})),joins:C,where:x,limit:p,offset:b,orderBy:_,setOperators:[]})}else A=this.buildSelectQuery({table:ct(n,a),fields:{},fieldsFlat:h.map(({field:L})=>({path:[],field:d(L,Q)?X(L,a):L})),joins:C,where:x,limit:p,offset:b,orderBy:_,setOperators:[]});return{tableTsKey:i.tsName,sql:A,selection:h}}}class oa extends wr{static[f]="SQLiteSyncDialect";migrate(e,s,r){const n=r===void 0||typeof r=="string"?"__drizzle_migrations":r.migrationsTable??"__drizzle_migrations",i=u`
			CREATE TABLE IF NOT EXISTS ${u.identifier(n)} (
				id SERIAL PRIMARY KEY,
				hash text NOT NULL,
				created_at numeric
			)
		`;s.run(i);const a=s.values(u`SELECT id, hash, created_at FROM ${u.identifier(n)} ORDER BY created_at DESC LIMIT 1`)[0]??void 0;s.run(u`BEGIN`);try{for(const l of e)if(!a||Number(a[2])<l.folderMillis){for(const c of l.sql)s.run(u.raw(c));s.run(u`INSERT INTO ${u.identifier(n)} ("hash", "created_at") VALUES(${l.hash}, ${l.folderMillis})`)}s.run(u`COMMIT`)}catch(l){throw s.run(u`ROLLBACK`),l}}}class aa extends wr{static[f]="SQLiteAsyncDialect";async migrate(e,s,r){const n=typeof r=="string"?"__drizzle_migrations":r.migrationsTable??"__drizzle_migrations",i=u`
			CREATE TABLE IF NOT EXISTS ${u.identifier(n)} (
				id SERIAL PRIMARY KEY,
				hash text NOT NULL,
				created_at numeric
			)
		`;await s.run(i);const a=(await s.values(u`SELECT id, hash, created_at FROM ${u.identifier(n)} ORDER BY created_at DESC LIMIT 1`))[0]??void 0;await s.transaction(async l=>{for(const c of e)if(!a||Number(a[2])<c.folderMillis){for(const h of c.sql)await l.run(u.raw(h));await l.run(u`INSERT INTO ${u.identifier(n)} ("hash", "created_at") VALUES(${c.hash}, ${c.folderMillis})`)}})}}class la{static[f]="TypedQueryBuilder";getSelectedFields(){return this._.selectedFields}}class te{static[f]="SQLiteSelectBuilder";fields;session;dialect;withList;distinct;constructor(e){this.fields=e.fields,this.session=e.session,this.dialect=e.dialect,this.withList=e.withList,this.distinct=e.distinct}from(e){const s=!!this.fields;let r;return this.fields?r=this.fields:d(e,Y)?r=Object.fromEntries(Object.keys(e[k].selection).map(n=>[n,e[n]])):d(e,br)?r=e[M].selectedFields:d(e,y)?r={}:r=Mo(e),new gr({table:e,fields:r,isPartialSelect:s,session:this.session,dialect:this.dialect,withList:this.withList,distinct:this.distinct})}}class ua extends la{static[f]="SQLiteSelectQueryBuilder";_;config;joinsNotNullableMap;tableName;isPartialSelect;session;dialect;constructor({table:e,fields:s,isPartialSelect:r,session:n,dialect:i,withList:o,distinct:a}){super(),this.config={withList:o,table:e,fields:{...s},distinct:a,setOperators:[]},this.isPartialSelect=r,this.session=n,this.dialect=i,this._={selectedFields:s},this.tableName=ls(e),this.joinsNotNullableMap=typeof this.tableName=="string"?{[this.tableName]:!0}:{}}createJoin(e){return(s,r)=>{const n=this.tableName,i=ls(s);if(typeof i=="string"&&this.config.joins?.some(o=>o.alias===i))throw new Error(`Alias "${i}" is already used in this query`);if(!this.isPartialSelect&&(Object.keys(this.joinsNotNullableMap).length===1&&typeof n=="string"&&(this.config.fields={[n]:this.config.fields}),typeof i=="string"&&!d(s,y))){const o=d(s,Y)?s[k].selection:d(s,Re)?s[M].selectedFields:s[m.Symbol.Columns];this.config.fields[i]=o}if(typeof r=="function"&&(r=r(new Proxy(this.config.fields,new J({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})))),this.config.joins||(this.config.joins=[]),this.config.joins.push({on:r,table:s,joinType:e,alias:i}),typeof i=="string")switch(e){case"left":{this.joinsNotNullableMap[i]=!1;break}case"right":{this.joinsNotNullableMap=Object.fromEntries(Object.entries(this.joinsNotNullableMap).map(([o])=>[o,!1])),this.joinsNotNullableMap[i]=!0;break}case"inner":{this.joinsNotNullableMap[i]=!0;break}case"full":{this.joinsNotNullableMap=Object.fromEntries(Object.entries(this.joinsNotNullableMap).map(([o])=>[o,!1])),this.joinsNotNullableMap[i]=!1;break}}return this}}leftJoin=this.createJoin("left");rightJoin=this.createJoin("right");innerJoin=this.createJoin("inner");fullJoin=this.createJoin("full");createSetOperator(e,s){return r=>{const n=typeof r=="function"?r(ca()):r;if(!mr(this.getSelectedFields(),n.getSelectedFields()))throw new Error("Set operator error (union / intersect / except): selected fields are not the same or are in a different order");return this.config.setOperators.push({type:e,isAll:s,rightSelect:n}),this}}union=this.createSetOperator("union",!1);unionAll=this.createSetOperator("union",!0);intersect=this.createSetOperator("intersect",!1);except=this.createSetOperator("except",!1);addSetOperators(e){return this.config.setOperators.push(...e),this}where(e){return typeof e=="function"&&(e=e(new Proxy(this.config.fields,new J({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})))),this.config.where=e,this}having(e){return typeof e=="function"&&(e=e(new Proxy(this.config.fields,new J({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})))),this.config.having=e,this}groupBy(...e){if(typeof e[0]=="function"){const s=e[0](new Proxy(this.config.fields,new J({sqlAliasedBehavior:"alias",sqlBehavior:"sql"})));this.config.groupBy=Array.isArray(s)?s:[s]}else this.config.groupBy=e;return this}orderBy(...e){if(typeof e[0]=="function"){const s=e[0](new Proxy(this.config.fields,new J({sqlAliasedBehavior:"alias",sqlBehavior:"sql"}))),r=Array.isArray(s)?s:[s];this.config.setOperators.length>0?this.config.setOperators.at(-1).orderBy=r:this.config.orderBy=r}else{const s=e;this.config.setOperators.length>0?this.config.setOperators.at(-1).orderBy=s:this.config.orderBy=s}return this}limit(e){return this.config.setOperators.length>0?this.config.setOperators.at(-1).limit=e:this.config.limit=e,this}offset(e){return this.config.setOperators.length>0?this.config.setOperators.at(-1).offset=e:this.config.offset=e,this}getSQL(){return this.dialect.buildSelectQuery(this.config)}toSQL(){const{typings:e,...s}=this.dialect.sqlToQuery(this.getSQL());return s}as(e){return new Proxy(new Y(this.getSQL(),this.config.fields,e),new J({alias:e,sqlAliasedBehavior:"alias",sqlBehavior:"error"}))}getSelectedFields(){return new Proxy(this.config.fields,new J({alias:this.tableName,sqlAliasedBehavior:"alias",sqlBehavior:"error"}))}$dynamic(){return this}}class gr extends ua{static[f]="SQLiteSelect";_prepare(e=!0){if(!this.session)throw new Error("Cannot execute a query on a query builder. Please use a database instance instead.");const s=ue(this.config.fields),r=this.session[e?"prepareOneTimeQuery":"prepareQuery"](this.dialect.sqlToQuery(this.getSQL()),s,"all");return r.joinsNotNullableMap=this.joinsNotNullableMap,r}prepare(){return this._prepare(!1)}run=e=>this._prepare().run(e);all=e=>this._prepare().all(e);get=e=>this._prepare().get(e);values=e=>this._prepare().values(e);async execute(){return this.all()}}Do(gr,[ce]);function nt(t,e){return(s,r,...n)=>{const i=[r,...n].map(o=>({type:t,isAll:e,rightSelect:o}));for(const o of i)if(!mr(s.getSelectedFields(),o.rightSelect.getSelectedFields()))throw new Error("Set operator error (union / intersect / except): selected fields are not the same or are in a different order");return s.addSetOperators(i)}}const ca=()=>({union:ha,unionAll:da,intersect:fa,except:pa}),ha=nt("union",!1),da=nt("union",!0),fa=nt("intersect",!1),pa=nt("except",!1);class ma{static[f]="SQLiteQueryBuilder";dialect;$with(e){const s=this;return{as(r){return typeof r=="function"&&(r=r(s)),new Proxy(new lr(r.getSQL(),r.getSelectedFields(),e,!0),new J({alias:e,sqlAliasedBehavior:"alias",sqlBehavior:"error"}))}}}with(...e){const s=this;function r(i){return new te({fields:i??void 0,session:void 0,dialect:s.getDialect(),withList:e})}function n(i){return new te({fields:i??void 0,session:void 0,dialect:s.getDialect(),withList:e,distinct:!0})}return{select:r,selectDistinct:n}}select(e){return new te({fields:e??void 0,session:void 0,dialect:this.getDialect()})}selectDistinct(e){return new te({fields:e??void 0,session:void 0,dialect:this.getDialect(),distinct:!0})}getDialect(){return this.dialect||(this.dialect=new oa),this.dialect}}class hs{constructor(e,s,r,n){this.table=e,this.session=s,this.dialect=r,this.withList=n}static[f]="SQLiteUpdateBuilder";set(e){return new ya(this.table,yr(this.table,e),this.session,this.dialect,this.withList)}}class ya extends ce{constructor(e,s,r,n,i){super(),this.session=r,this.dialect=n,this.config={set:s,table:e,withList:i}}static[f]="SQLiteUpdate";config;where(e){return this.config.where=e,this}returning(e=this.config.table[z.Symbol.Columns]){return this.config.returning=ue(e),this}getSQL(){return this.dialect.buildUpdateQuery(this.config)}toSQL(){const{typings:e,...s}=this.dialect.sqlToQuery(this.getSQL());return s}_prepare(e=!0){return this.session[e?"prepareOneTimeQuery":"prepareQuery"](this.dialect.sqlToQuery(this.getSQL()),this.config.returning,this.config.returning?"all":"run")}prepare(){return this._prepare(!1)}run=e=>this._prepare().run(e);all=e=>this._prepare().all(e);get=e=>this._prepare().get(e);values=e=>this._prepare().values(e);async execute(){return this.config.returning?this.all():this.run()}$dynamic(){return this}}class ba{constructor(e,s,r,n,i,o,a,l){this.mode=e,this.fullSchema=s,this.schema=r,this.tableNamesMap=n,this.table=i,this.tableConfig=o,this.dialect=a,this.session=l}static[f]="SQLiteAsyncRelationalQueryBuilder";findMany(e){return this.mode==="sync"?new ds(this.fullSchema,this.schema,this.tableNamesMap,this.table,this.tableConfig,this.dialect,this.session,e||{},"many"):new Tt(this.fullSchema,this.schema,this.tableNamesMap,this.table,this.tableConfig,this.dialect,this.session,e||{},"many")}findFirst(e){return this.mode==="sync"?new ds(this.fullSchema,this.schema,this.tableNamesMap,this.table,this.tableConfig,this.dialect,this.session,e?{...e,limit:1}:{limit:1},"first"):new Tt(this.fullSchema,this.schema,this.tableNamesMap,this.table,this.tableConfig,this.dialect,this.session,e?{...e,limit:1}:{limit:1},"first")}}class Tt extends ce{constructor(e,s,r,n,i,o,a,l,c){super(),this.fullSchema=e,this.schema=s,this.tableNamesMap=r,this.table=n,this.tableConfig=i,this.dialect=o,this.session=a,this.config=l,this.mode=c}static[f]="SQLiteAsyncRelationalQuery";mode;getSQL(){return this.dialect.buildRelationalQuery({fullSchema:this.fullSchema,schema:this.schema,tableNamesMap:this.tableNamesMap,table:this.table,tableConfig:this.tableConfig,queryConfig:this.config,tableAlias:this.tableConfig.tsName}).sql}_prepare(e=!1){const{query:s,builtQuery:r}=this._toSQL();return this.session[e?"prepareOneTimeQuery":"prepareQuery"](r,void 0,this.mode==="first"?"get":"all",(n,i)=>{const o=n.map(a=>Rt(this.schema,this.tableConfig,a,s.selection,i));return this.mode==="first"?o[0]:o})}prepare(){return this._prepare(!1)}_toSQL(){const e=this.dialect.buildRelationalQuery({fullSchema:this.fullSchema,schema:this.schema,tableNamesMap:this.tableNamesMap,table:this.table,tableConfig:this.tableConfig,queryConfig:this.config,tableAlias:this.tableConfig.tsName}),s=this.dialect.sqlToQuery(e.sql);return{query:e,builtQuery:s}}toSQL(){return this._toSQL().builtQuery}executeRaw(){return this.mode==="first"?this._prepare(!1).get():this._prepare(!1).all()}async execute(){return this.executeRaw()}}class ds extends Tt{static[f]="SQLiteSyncRelationalQuery";sync(){return this.executeRaw()}}class Me extends ce{constructor(e,s,r,n,i){super(),this.execute=e,this.getSQL=s,this.dialect=n,this.mapBatchResult=i,this.config={action:r}}static[f]="SQLiteRaw";config;getQuery(){return{...this.dialect.sqlToQuery(this.getSQL()),method:this.config.action}}mapResult(e,s){return s?this.mapBatchResult(e):e}_prepare(){return this}}class Sr{constructor(e,s,r,n){this.resultKind=e,this.dialect=s,this.session=r,this._=n?{schema:n.schema,tableNamesMap:n.tableNamesMap}:{schema:void 0,tableNamesMap:{}},this.query={};const i=this.query;if(this._.schema)for(const[o,a]of Object.entries(this._.schema))i[o]=new ba(e,n.fullSchema,this._.schema,this._.tableNamesMap,n.fullSchema[o],a,s,r)}static[f]="BaseSQLiteDatabase";query;$with(e){return{as(s){return typeof s=="function"&&(s=s(new ma)),new Proxy(new lr(s.getSQL(),s.getSelectedFields(),e,!0),new J({alias:e,sqlAliasedBehavior:"alias",sqlBehavior:"error"}))}}}with(...e){const s=this;function r(l){return new te({fields:l??void 0,session:s.session,dialect:s.dialect,withList:e})}function n(l){return new te({fields:l??void 0,session:s.session,dialect:s.dialect,withList:e,distinct:!0})}function i(l){return new hs(l,s.session,s.dialect,e)}function o(l){return new cs(l,s.session,s.dialect,e)}function a(l){return new us(l,s.session,s.dialect,e)}return{select:r,selectDistinct:n,update:i,insert:o,delete:a}}select(e){return new te({fields:e??void 0,session:this.session,dialect:this.dialect})}selectDistinct(e){return new te({fields:e??void 0,session:this.session,dialect:this.dialect,distinct:!0})}update(e){return new hs(e,this.session,this.dialect)}insert(e){return new cs(e,this.session,this.dialect)}delete(e){return new us(e,this.session,this.dialect)}run(e){const s=e.getSQL();return this.resultKind==="async"?new Me(async()=>this.session.run(s),()=>s,"run",this.dialect,this.session.extractRawRunValueFromBatchResult.bind(this.session)):this.session.run(s)}all(e){const s=e.getSQL();return this.resultKind==="async"?new Me(async()=>this.session.all(s),()=>s,"all",this.dialect,this.session.extractRawAllValueFromBatchResult.bind(this.session)):this.session.all(s)}get(e){const s=e.getSQL();return this.resultKind==="async"?new Me(async()=>this.session.get(s),()=>s,"get",this.dialect,this.session.extractRawGetValueFromBatchResult.bind(this.session)):this.session.get(s)}values(e){const s=e.getSQL();return this.resultKind==="async"?new Me(async()=>this.session.values(s),()=>s,"values",this.dialect,this.session.extractRawValuesValueFromBatchResult.bind(this.session)):this.session.values(s)}transaction(e,s){return this.session.transaction(e,s)}}class wa extends ce{constructor(e){super(),this.resultCb=e}static[f]="ExecuteResultSync";async execute(){return this.resultCb()}sync(){return this.resultCb()}}class ga{constructor(e,s,r){this.mode=e,this.executeMethod=s,this.query=r}static[f]="PreparedQuery";joinsNotNullableMap;getQuery(){return this.query}mapRunResult(e,s){return e}mapAllResult(e,s){throw new Error("Not implemented")}mapGetResult(e,s){throw new Error("Not implemented")}execute(e){return this.mode==="async"?this[this.executeMethod](e):new wa(()=>this[this.executeMethod](e))}mapResult(e,s){switch(this.executeMethod){case"run":return this.mapRunResult(e,s);case"all":return this.mapAllResult(e,s);case"get":return this.mapGetResult(e,s)}}}class Sa{constructor(e){this.dialect=e}static[f]="SQLiteSession";prepareOneTimeQuery(e,s,r){return this.prepareQuery(e,s,r)}run(e){const s=this.dialect.sqlToQuery(e);try{return this.prepareOneTimeQuery(s,void 0,"run").run()}catch(r){throw new kt({cause:r,message:`Failed to run the query '${s.sql}'`})}}extractRawRunValueFromBatchResult(e){return e}all(e){return this.prepareOneTimeQuery(this.dialect.sqlToQuery(e),void 0,"run").all()}extractRawAllValueFromBatchResult(e){throw new Error("Not implemented")}get(e){return this.prepareOneTimeQuery(this.dialect.sqlToQuery(e),void 0,"run").get()}extractRawGetValueFromBatchResult(e){throw new Error("Not implemented")}values(e){return this.prepareOneTimeQuery(this.dialect.sqlToQuery(e),void 0,"run").values()}extractRawValuesValueFromBatchResult(e){throw new Error("Not implemented")}}class qa extends Sr{constructor(e,s,r,n,i=0){super(e,s,r,n),this.schema=n,this.nestedIndex=i}static[f]="SQLiteTransaction";rollback(){throw new Vo}}class Vt extends Sa{constructor(e,s,r,n,i){super(s),this.client=e,this.schema=r,this.options=n,this.tx=i,this.logger=n.logger??new to}static[f]="LibSQLSession";logger;prepareQuery(e,s,r,n){return new _a(this.client,e,this.logger,s,this.tx,r,n)}async batch(e){const s=[],r=[];for(const i of e){const o=i._prepare(),a=o.getQuery();s.push(o),r.push({sql:a.sql,args:a.params})}return(await this.client.batch(r)).map((i,o)=>s[o].mapResult(i,!0))}async transaction(e,s){const r=await this.client.transaction(),n=new Vt(this.client,this.dialect,this.schema,this.options,r),i=new zt("async",this.dialect,n,this.schema);try{const o=await e(i);return await r.commit(),o}catch(o){throw await r.rollback(),o}}extractRawAllValueFromBatchResult(e){return e.rows}extractRawGetValueFromBatchResult(e){return e.rows[0]}extractRawValuesValueFromBatchResult(e){return e.rows}}class zt extends qa{static[f]="LibSQLTransaction";async transaction(e){const s=`sp${this.nestedIndex}`,r=new zt("async",this.dialect,this.session,this.schema,this.nestedIndex+1);await this.session.run(u.raw(`savepoint ${s}`));try{const n=await e(r);return await this.session.run(u.raw(`release savepoint ${s}`)),n}catch(n){throw await this.session.run(u.raw(`rollback to savepoint ${s}`)),n}}}class _a extends ga{constructor(e,s,r,n,i,o,a){super("async",o,s),this.client=e,this.logger=r,this.fields=n,this.tx=i,this.customResultMapper=a,this.customResultMapper=a,this.fields=n}static[f]="LibSQLPreparedQuery";run(e){const s=De(this.query.params,e??{});this.logger.logQuery(this.query.sql,s);const r={sql:this.query.sql,args:s};return this.tx?this.tx.execute(r):this.client.execute(r)}async all(e){const{fields:s,logger:r,query:n,tx:i,client:o,customResultMapper:a}=this;if(!s&&!a){const c=De(n.params,e??{});r.logQuery(n.sql,c);const h={sql:n.sql,args:c};return(i?i.execute(h):o.execute(h)).then(({rows:p})=>this.mapAllResult(p))}const l=await this.values(e);return this.mapAllResult(l)}mapAllResult(e,s){return s&&(e=e.rows),!this.fields&&!this.customResultMapper?e.map(r=>fs(r)):this.customResultMapper?this.customResultMapper(e,Fe):e.map(r=>as(this.fields,Array.prototype.slice.call(r).map(n=>Fe(n)),this.joinsNotNullableMap))}async get(e){const{fields:s,logger:r,query:n,tx:i,client:o,customResultMapper:a}=this;if(!s&&!a){const c=De(n.params,e??{});r.logQuery(n.sql,c);const h={sql:n.sql,args:c};return(i?i.execute(h):o.execute(h)).then(({rows:p})=>this.mapGetResult(p))}const l=await this.values(e);return this.mapGetResult(l)}mapGetResult(e,s){s&&(e=e.rows);const r=e[0];if(!this.fields&&!this.customResultMapper)return fs(r);if(r)return this.customResultMapper?this.customResultMapper(e,Fe):as(this.fields,Array.prototype.slice.call(r).map(n=>Fe(n)),this.joinsNotNullableMap)}values(e){const s=De(this.query.params,e??{});this.logger.logQuery(this.query.sql,s);const r={sql:this.query.sql,args:s};return(this.tx?this.tx.execute(r):this.client.execute(r)).then(({rows:n})=>n)}}function fs(t){return Object.keys(t).reduce((e,s)=>(Object.prototype.propertyIsEnumerable.call(t,s)&&(e[s]=t[s]),e),{})}function Fe(t){if(typeof ArrayBuffer<"u"&&t instanceof ArrayBuffer){if(typeof Buffer<"u")return t instanceof Buffer?t:Buffer.from(t);if(typeof TextDecoder<"u")return new TextDecoder().decode(t);throw new Error("TextDecoder is not available. Please provide either Buffer or TextDecoder polyfill.")}return t}class xa extends Sr{static[f]="LibSQLDatabase";async batch(e){return this.session.batch(e)}}function Ra(t,e={}){const s=new aa;let r;e.logger===!0?r=new eo:e.logger!==!1&&(r=e.logger);let n;if(e.schema){const o=Oo(e.schema,Uo);n={fullSchema:e.schema,schema:o.tables,tableNamesMap:o.tableNamesMap}}const i=new Vt(t,s,n,{logger:r},void 0);return new xa("async",s,i,n)}const qr=Ra(Zi),_r=ko("users",{id:Ie("id").primaryKey(),name:ia("name").notNull(),responses:Ie("responses").notNull().default(0),nps:Ie("nps").notNull().default(0),csat:Ie("csat").notNull().default(0),rd:Ie("rd").notNull().default(0)});async function Ca(){try{return await qr.select().from(_r).execute()}catch(t){throw console.error("Error al obtener usuarios:",t),new Error(`No se pudieron obtener los usuarios: ${t}`)}}async function Ta(t){try{await qr.update(_r).set(t).where(u`id = ${t.id}`).execute()}catch(e){throw console.error("Error al actualizar usuario:",e),new Error(`No se pudo actualizar el usuario: ${e}`)}}var Ia=xr({chartName:"BarChart",GraphicalChild:Ne,defaultTooltipEventType:"axis",validateTooltipEventTypes:["axis","item"],axisComponents:[{axisType:"xAxis",AxisComp:ps},{axisType:"yAxis",AxisComp:ms}],formatAxisMap:Rr});const Qa=()=>{const[t,e]=Te.useState([]),[s,r]=Te.useState(!0),[n,i]=Te.useState(null),[o,a]=Te.useState("");Te.useEffect(()=>{(async()=>{try{r(!0);const p=await Ca();e(p),i(null)}catch(p){console.error("Error al cargar usuarios:",p),i(`Error al cargar las mtricas: ${p instanceof Error?p.message:String(p)}`)}finally{r(!1)}})()},[]);const l=async h=>{try{const p={...h,responses:h.responses+1};await Ta(p),e(t.map(b=>b.id===h.id?p:b))}catch(p){console.error("Error al actualizar el usuario:",p),i(`Error al actualizar el usuario: ${p instanceof Error?p.message:String(p)}`)}},c=t.filter(h=>h.name.toLowerCase().includes(o.toLowerCase()));return s?I.jsx("div",{children:"Cargando datos de usuarios..."}):n?I.jsxs("div",{children:["Error: ",n]}):t.length===0?I.jsx("div",{children:"No se encontraron datos de usuarios."}):I.jsxs("div",{children:[I.jsx("h1",{children:"Mtricas de Usuarios"}),I.jsx("input",{type:"text",placeholder:"Buscar por nombre...",value:o,onChange:h=>a(h.target.value),style:{marginBottom:"20px",padding:"5px",width:"200px"}}),c.map(h=>I.jsxs("div",{style:{marginBottom:"30px",border:"1px solid #ddd",padding:"15px",borderRadius:"8px"},children:[I.jsx("h2",{children:h.name}),I.jsx(Cr,{width:"100%",height:300,children:I.jsxs(Ia,{data:[h],children:[I.jsx(ps,{dataKey:"name"}),I.jsx(ms,{}),I.jsx(Tr,{}),I.jsx(Ir,{}),I.jsx(Ne,{dataKey:"responses",fill:"#8884d8",name:"Respuestas"}),I.jsx(Ne,{dataKey:"nps",fill:"#82ca9d",name:"NPS"}),I.jsx(Ne,{dataKey:"csat",fill:"#ffc658",name:"CSAT"}),I.jsx(Ne,{dataKey:"rd",fill:"#ff7300",name:"RD"})]})}),I.jsx("div",{style:{marginTop:"10px"},children:I.jsx("button",{onClick:()=>l(h),children:"Incrementar Respuestas"})})]},h.id))]})};export{Qa as default};
