import{j as e}from"./jsx-runtime.CYYqVSlZ.js";import{r as d}from"./index.DJO9vBfz.js";import{g as X,a as G,u as O,b as U}from"./db-users.DZVx0wyj.js";import{L as Y}from"./loader-circle.uG8OBDkd.js";import"./config.CNYlbwcf.js";import"./createLucideIcon.DgMzALqq.js";const h=(...s)=>s.filter(Boolean).join(" "),j=d.forwardRef(({className:s,...t},o)=>e.jsx("table",{ref:o,className:h("w-full caption-bottom text-sm",s),...t}));j.displayName="Table";const y=d.forwardRef(({className:s,...t},o)=>e.jsx("thead",{ref:o,className:h("[&_tr]:border-b",s),...t}));y.displayName="TableHeader";const N=d.forwardRef(({className:s,...t},o)=>e.jsx("tbody",{ref:o,className:h("[&_tr:last-child]:border-0",s),...t}));N.displayName="TableBody";const _=d.forwardRef(({className:s,...t},o)=>e.jsx("tfoot",{ref:o,className:h("bg-primary font-medium text-primary-foreground",s),...t}));_.displayName="TableFooter";const p=d.forwardRef(({className:s,...t},o)=>e.jsx("tr",{ref:o,className:h("border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted",s),...t}));p.displayName="TableRow";const c=d.forwardRef(({className:s,...t},o)=>e.jsx("th",{ref:o,className:h("h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0",s),...t}));c.displayName="TableHead";const m=d.forwardRef(({className:s,...t},o)=>e.jsx("td",{ref:o,className:h("p-4 align-middle [&:has([role=checkbox])]:pr-0",s),...t}));m.displayName="TableCell";const A=d.forwardRef(({className:s,...t},o)=>e.jsx("caption",{ref:o,className:h("mt-4 text-sm text-muted-foreground",s),...t}));A.displayName="TableCaption";const J=["Lunes","Martes","Miércoles","Jueves","Viernes"],f=new Date().getFullYear(),b=new Date().getMonth()+1,Q=()=>{const[s,t]=d.useState([]),[o,T]=d.useState({}),[B,C]=d.useState(!0),[E,L]=d.useState(null),[x,S]=d.useState({}),[g,v]=d.useState([]),[w,I]=d.useState("");d.useEffect(()=>{(async()=>{try{C(!0);const r=await X();t(r);const n={};for(const i of r)n[i.id]=await G(i.id,b,f);T(n)}catch(r){console.error("Error fetching data:",r),L(`Error al cargar los datos: ${r instanceof Error?r.message:String(r)}`)}finally{C(!1)}})()},[]);const R=(a,r)=>{S(n=>({...n,[a]:r}))},k=(a,r,n,i,l)=>{const F={employeeId:a,day:r,week:n,month:b,year:f,startTime:i,endTime:l};v(M=>[...M.filter(u=>u.employeeId!==a||u.day!==r||u.week!==n||u.month!==b||u.year!==f),F])},D=async()=>{try{for(const[a,r]of Object.entries(x))await O(Number(a),r);t(s.map(a=>x[a.id]?{...a,xLite:x[a.id]}:a)),S({}),alert("Cambios en empleados guardados exitosamente")}catch(a){console.error("Error saving employee changes:",a),alert(`Error al guardar los cambios en empleados: ${a instanceof Error?a.message:String(a)}`)}},H=async()=>{try{for(const r of g)console.log("Intentando guardar horario:",r),await U(r),console.log("Horario guardado exitosamente:",r);const a={...o};for(const r of g){a[r.employeeId]||(a[r.employeeId]=[]);const n=a[r.employeeId].findIndex(i=>i.day===r.day&&i.week===r.week&&i.month===r.month&&i.year===r.year);n!==-1?a[r.employeeId][n]={id:a[r.employeeId][n].id,...r}:a[r.employeeId].push({id:0,...r})}T(a),v([]),alert("Cambios en horarios de break guardados exitosamente")}catch(a){console.error("Error detallado al guardar cambios de break:",a),alert(`Error al guardar los cambios en horarios de break: ${a instanceof Error?a.message:String(a)}`)}},$=s.filter(a=>`${a.firstName} ${a.lastName}`.toLowerCase().includes(w.toLowerCase()));return B?e.jsxs("div",{className:"flex flex-col items-center justify-center h-screen",children:[e.jsx(Y,{className:"w-12 h-12 text-blue-500 animate-spin"}),e.jsx("p",{className:"mt-4 text-lg font-semibold text-gray-700",children:"Cargando programacion semanal."})]}):E?e.jsx("div",{className:"flex flex-col items-center justify-center h-screen",children:e.jsx("p",{className:"text-lg font-semibold text-red-600",children:E})}):e.jsxs("div",{className:"container p-4 mx-auto",children:[e.jsx("h2",{className:"mb-4 text-2xl font-bold",children:"Programacion Semanal"}),s.length===0?e.jsx("p",{children:"No hay empleados para mostrar."}):e.jsxs(e.Fragment,{children:[e.jsxs(j,{children:[e.jsx(y,{children:e.jsxs(p,{children:[e.jsx(c,{children:"Apellido y Nombre"}),e.jsx(c,{children:"Email"}),e.jsx(c,{children:"DNI"}),e.jsx(c,{children:"Ingreso"}),e.jsx(c,{children:"Egreso"}),e.jsx(c,{children:"Hs. Trabajo"}),e.jsx(c,{children:"X LITE"})]})}),e.jsx(N,{children:s.map(a=>e.jsxs(p,{children:[e.jsxs(m,{children:[a.lastName," ",a.firstName]}),e.jsx(m,{children:a.email}),e.jsx(m,{children:a.dni}),e.jsx(m,{children:a.entryTime}),e.jsx(m,{children:a.exitTime}),e.jsx(m,{children:a.hoursWorked}),e.jsx(m,{children:e.jsx("input",{type:"text",value:x[a.id]||a.xLite||"",onChange:r=>R(a.id,r.target.value),className:"px-2 py-1 border rounded"})})]},a.id))})]}),e.jsx("button",{onClick:D,className:"px-4 py-2 mt-4 font-bold text-white rounded bg-[#000] hover:bg-black",disabled:Object.keys(x).length===0,children:"Guardar Cambios en Empleados"})]}),e.jsx("h3",{className:"mt-8 mb-4 text-xl font-bold",children:"Horarios de Break"}),e.jsx("div",{className:"mb-4",children:e.jsx("input",{type:"text",placeholder:"Buscar empleado...",value:w,onChange:a=>I(a.target.value),className:"w-full px-2 py-1 border rounded"})}),$.map(a=>e.jsxs("div",{className:"mb-8",children:[e.jsxs("h4",{className:"mb-2 text-lg font-semibold",children:[a.firstName," ",a.lastName]}),e.jsxs(j,{children:[e.jsx(y,{children:e.jsxs(p,{children:[e.jsx(c,{children:"Día"}),e.jsx(c,{children:"Semana 1"}),e.jsx(c,{children:"Semana 2"}),e.jsx(c,{children:"Semana 3"}),e.jsx(c,{children:"Semana 4"}),e.jsx(c,{children:"Semana 5"})]})}),e.jsx(N,{children:J.map(r=>e.jsxs(p,{children:[e.jsx(m,{children:r}),[1,2,3,4,5].map(n=>{const i=g.find(l=>l.employeeId===a.id&&l.day===r&&l.week===n&&l.month===b&&l.year===f)||o[a.id]?.find(l=>l.day===r&&l.week===n&&l.month===b&&l.year===f)||{startTime:"",endTime:""};return e.jsxs(m,{children:[e.jsx("input",{type:"time",value:i.startTime,onChange:l=>k(a.id,r,n,l.target.value,i.endTime),className:"px-2 py-1 mr-2 border rounded"}),e.jsx("input",{type:"time",value:i.endTime,onChange:l=>k(a.id,r,n,i.startTime,l.target.value),className:"px-2 py-1 border rounded"})]},n)})]},r))})]})]},a.id)),e.jsx("button",{onClick:H,className:"px-4 py-2 mt-4 font-bold text-white rounded bg-[#000] hover:bg-black",disabled:g.length===0,children:"Guardar Cambios en Horarios de Break"})]})};export{Q as default};
