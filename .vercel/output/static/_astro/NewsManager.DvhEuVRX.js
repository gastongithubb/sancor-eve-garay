import{j as e}from"./jsx-runtime.CYYqVSlZ.js";import{r as l}from"./index.DJO9vBfz.js";import{c as q,d as T,s as _,i as A,t as h,a as N,b as x}from"./config.GOu8AU1M.js";const P=q({url:N.tursoConnectionUrl,authToken:N.tursoAuthToken}),b=T(P),m=_("news",{id:A("id").primaryKey(),url:h("url").notNull(),title:h("title").notNull(),publishDate:h("publish_date").notNull(),estado:h("estado").notNull().default("vigente"),nueva_columna:h("nueva_columna")});async function $(){try{return await b.select().from(m).all()}catch(a){throw console.error("Error al obtener noticias:",a),a}}async function G(a){try{await b.insert(m).values({...a,nueva_columna:null}).run()}catch(n){throw console.error("Error al añadir noticia:",n),n}}async function I(a){try{await b.delete(m).where(x`id = ${a}`).run()}catch(n){throw console.error("Error al eliminar noticia:",n),n}}async function U(a,n){try{await b.update(m).set(n).where(x`id = ${a}`).run()}catch(i){throw console.error("Error al actualizar noticia:",i),i}}async function B(a,n){try{await b.update(m).set({estado:n}).where(x`id = ${a}`).run()}catch(i){throw console.error(`Error al cambiar el estado de la noticia ${a} a ${n}:`,i),i}}const K=()=>{const[a,n]=l.useState([]),[i,j]=l.useState([]),[p,y]=l.useState(""),[s,g]=l.useState({url:"",title:"",publishDate:"",estado:"vigente"}),[o,d]=l.useState(null),[w,c]=l.useState(null),[z,f]=l.useState(!0);l.useEffect(()=>{u()},[]),l.useEffect(()=>{const r=a.filter(t=>t.title.toLowerCase().includes(p.toLowerCase()));j(r)},[p,a]);const u=async()=>{f(!0);try{const r=await $();n(r)}catch(r){console.error("Error fetching news:",r),c("Error al cargar las noticias. Por favor, intenta de nuevo.")}finally{f(!1)}},v=r=>!r.url.trim()||!r.title.trim()||!r.publishDate.trim()?(c("Todos los campos son obligatorios."),!1):(c(null),!0),E=async r=>{if(r.preventDefault(),!!v(s))try{await G({...s,nueva_columna:null}),u(),g({url:"",title:"",publishDate:"",estado:"vigente"})}catch(t){console.error("Error adding news:",t),c("Error al añadir la noticia. Por favor, intenta de nuevo.")}},k=async r=>{try{await I(r),u()}catch(t){console.error("Error deleting news:",t),c("Error al eliminar la noticia. Por favor, intenta de nuevo.")}},C=async r=>{if(r.preventDefault(),o&&v(o))try{await U(o.id,o),u(),d(null)}catch(t){console.error("Error updating news:",t),c("Error al actualizar la noticia. Por favor, intenta de nuevo.")}},D=async(r,t)=>{try{await B(r,t),u()}catch(L){console.error("Error updating estado:",L),c("Error al actualizar el estado de la noticia. Por favor, intenta de nuevo.")}},S=()=>e.jsx("div",{className:"space-y-4",children:[...Array(3)].map((r,t)=>e.jsxs("div",{className:"p-4 bg-white border rounded-lg shadow-card border-zinc-300",children:[e.jsx("div",{className:"w-3/4 h-6 mb-2 rounded bg-zinc-600 animate-pulse"}),e.jsx("div",{className:"w-full h-5 mb-2 rounded bg-zinc-600 animate-pulse"}),e.jsx("div",{className:"w-1/3 h-5 mb-4 rounded bg-zinc-600 animate-pulse"}),e.jsxs("div",{className:"flex",children:[e.jsx("div",{className:"w-20 mr-2 rounded bg-zinc-600 h-9 animate-pulse"}),e.jsx("div",{className:"w-20 rounded bg-zinc-600 h-9 animate-pulse"})]})]},t))});return e.jsxs("div",{className:"container p-4 mx-auto font-SpaceGrotesk",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h1",{className:"text-2xl font-bold text-black",children:"Gestor de Noticias"}),e.jsxs("div",{className:"relative w-64",children:[e.jsx("input",{type:"text",placeholder:"Buscar por título",value:p,onChange:r=>y(r.target.value),className:"w-full p-2 pl-10 pr-4 border rounded-lg border-zinc-300 focus:outline-none focus:border-lime"}),e.jsx("svg",{className:"absolute w-5 h-5 transform -translate-y-1/2 left-3 top-1/2 text-zinc-400",fill:"none",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})]})]}),w&&e.jsx("div",{className:"p-2 mb-4 text-red-700 bg-red-100 rounded-lg",children:w}),e.jsxs("form",{onSubmit:E,className:"mb-4",children:[e.jsx("input",{type:"text",placeholder:"URL",value:s.url,onChange:r=>g({...s,url:r.target.value}),className:"p-2 mr-2 border rounded-lg border-zinc-600 focus:outline-none focus:border-lime",required:!0}),e.jsx("input",{type:"text",placeholder:"Título",value:s.title,onChange:r=>g({...s,title:r.target.value}),className:"p-2 mr-2 border rounded-lg border-zinc-300 focus:outline-none focus:border-lime",required:!0}),e.jsx("input",{type:"date",value:s.publishDate,onChange:r=>g({...s,publishDate:r.target.value}),className:"p-2 mr-2 border rounded-lg border-zinc-300 focus:outline-none focus:border-lime",required:!0}),e.jsx("button",{type:"submit",className:"p-2 text-white transition duration-300 bg-black rounded-lg hover:bg-lime",children:"Añadir Noticia"})]}),z?S():e.jsx("div",{className:"space-y-4",children:i.map(r=>e.jsxs("div",{className:"relative p-4 bg-white border rounded-lg shadow-card border-zinc-300",children:[e.jsxs("select",{value:r.estado,onChange:t=>D(r.id,t.target.value),className:"absolute p-2 bg-white border rounded-lg shadow-lg top-2 right-2 focus:outline-none",children:[e.jsx("option",{value:"vigente",children:"Vigente"}),e.jsx("option",{value:"actualizada",children:"Actualizada"}),e.jsx("option",{value:"caducada",children:"Caducada"})]}),o&&o.id===r.id?e.jsxs("form",{onSubmit:C,children:[e.jsx("input",{type:"text",value:o.url,onChange:t=>d({...o,url:t.target.value}),className:"p-2 mb-2 mr-2 border rounded-lg border-zinc-300 focus:outline-none focus:border-lime",required:!0}),e.jsx("input",{type:"text",value:o.title,onChange:t=>d({...o,title:t.target.value}),className:"p-2 mb-2 mr-2 border rounded-lg border-zinc-300 focus:outline-none focus:border-lime",required:!0}),e.jsx("input",{type:"date",value:o.publishDate,onChange:t=>d({...o,publishDate:t.target.value}),className:"p-2 mb-2 mr-2 border rounded-lg border-zinc-300 focus:outline-none focus:border-lime",required:!0}),e.jsx("button",{type:"submit",className:"p-2 mr-2 text-white transition duration-300 bg-black rounded-lg hover:bg-lime",children:"Guardar"}),e.jsx("button",{onClick:()=>d(null),className:"p-2 text-white transition duration-300 bg-black rounded-lg hover:bg-lime",children:"Cancelar"})]}):e.jsxs(e.Fragment,{children:[e.jsx("h2",{className:"text-xl font-bold text-black",children:r.title}),e.jsx("a",{href:r.url,target:"_blank",rel:"noopener noreferrer",className:"text-lime hover:underline",children:r.url}),e.jsxs("p",{className:"mt-2 text-zinc-600",children:["Publicado el ",new Date(r.publishDate).toLocaleDateString()]}),e.jsxs("div",{className:"mt-2",children:[e.jsx("span",{className:`inline-block px-2 py-1 text-sm font-semibold rounded ${M(r.estado)} mr-2`,children:F(r.estado)}),e.jsx("button",{onClick:()=>d(r),className:"p-2 text-black transition duration-300 rounded-lg bg-zinc-200 hover:bg-zinc-300",children:"Editar"}),e.jsx("button",{onClick:()=>k(r.id),className:"p-2 ml-2 text-black transition duration-300 rounded-lg bg-red hover:bg-[#e85569]",children:"Eliminar"})]})]})]},r.id))})]})},F=a=>{switch(a){case"vigente":return"Vigente";case"actualizada":return"Actualizada";case"caducada":return"Caducada";default:return""}},M=a=>{switch(a){case"vigente":return"bg-green text-black px-2 py-1 rounded-lg text-lg";case"actualizada":return"bg-yellow text-black px-2 py-1 rounded-lg text-lg";case"caducada":return"bg-red text-black px-2 py-1 rounded-lg text-lg";default:return""}};export{K as default};
